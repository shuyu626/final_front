import{_ as ce}from"./submitButton-Dhxd6foM.js";import{_ as de}from"./inputText-3FF75wsl.js";import{a as p,V as c,_ as ie}from"./breadcrumbs-BP33C3v5.js";import{i as me,n as k,O as pe,o as v,e as ge,w as a,b as e,l as r,a as fe,f as ve,g as o,at as ye,c as h,t as M,F as w,V as _e,p as xe,a5 as Ve,Q as be,C as he,D as Me}from"./index-D2LNHcZy.js";import{c as we,a as d,e as y,u as $e,b as i,V as ke}from"./index.esm-tNqczc4V.js";import{l as _,V as Se,a as Ue,c as Ce}from"./leaflet-src-ClOvuzQN.js";import{_ as Pe}from"./search-Di9jXRzm.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Ae,a as Te}from"./VToolbar-DmtBx4yD.js";import{V as Ee,b as x,a as V}from"./VSelect-bcIupnSw.js";import{V as G,a as $}from"./VContainer-BgWFbPXI.js";import{V as Ie}from"./VTextarea-wiExg8dN.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VMenu-BJJdKV-j.js";import"./ssrBoot-DUxH79Wm.js";const m=S=>(he("data-v-a07bf488"),S=S(),Me(),S),Le={id:"map",ref:"map"},Be={class:"px-6"},Fe=m(()=>r("label",{class:"form-label"},"服務名稱",-1)),Ne=m(()=>r("label",{class:"form-label"},"服務電話",-1)),He=m(()=>r("label",{class:"form-label"},"服務類別",-1)),ze=m(()=>r("label",{class:"form-label"},"服務項目",-1)),Oe=m(()=>r("p",null,"服務對象",-1)),Re=m(()=>r("p",null,"長期照顧",-1)),We=m(()=>r("p",null,"身心障礙",-1)),je=m(()=>r("p",null,"兒童及少年",-1)),De=m(()=>r("p",null,"社會救助",-1)),Ze=m(()=>r("p",null,"婦女",-1)),Ge=m(()=>r("p",null,"其他",-1)),Ke=m(()=>r("label",{class:"form-label"},"服務介紹",-1)),Qe={__name:"createMark",setup(S){const{api:Ye,apiAuth:O}=xe();Ve();const T=me(),K=["資源地圖","新增資源"],Q=["長期照顧","身心障礙","婦女","兒童及少年","心理衛生","保護性服務","社會救助","綜合","其他"],Y=["日照中心","護理之家","居家服務","交通接送","家庭托顧"],J=["身心障礙者服務中心","輔具中心","職業重建中心","小作所","庇護工場"],X=["少年福利服務中心","親子館","課後班"],ee=["經濟補助","待用餐","基金會","社會福利中心"],le=["婦女福利服務中心","新住民家庭服務中心"],ae=k(["長期照顧","身心障礙","婦女","兒童及少年","精神","保護性服務","社會救助","綜合"]),oe=we({name:d().required("服務單位必填"),address:d().required("服務地址必填"),tel:d(),cl:d(),category5:y().of(d()).required("分類必填"),category2:y().of(d()).required("分類必填"),category3:y().of(d()).required("分類必填"),category4:y().of(d()).required("分類必填"),category5:y().of(d()).required("分類必填"),category6:y().of(d()).required("分類必填"),category7:y().of(d()).required("分類必填"),description:d()}),{handleSubmit:te,isSubmitting:se,resetForm:re}=$e({validationSchema:oe,initialValues:{name:"",address:"",tel:"",cl:"",category1:[],category2:[],category3:[],category4:[],category5:[],category6:[],category7:[],description:""}}),U=i("name"),C=i("tel"),E=i("cl"),I=i("category1"),L=i("category2"),B=i("category3"),F=i("category4"),N=i("category5"),H=i("category6"),z=i("category7"),P=i("description"),{value:b,errorMessage:ne}=i("address"),R="AIzaSyAyML8H2ENbc_kzs_ZSI6qYf7CCbBt0dAA";console.log(R);const f=k(null),q=k(null),W=k(null);pe(()=>{f.value=_.map("map").setView([25.049183268037577,121.51342818384893],12),_.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(f.value)});const j=async()=>{if(!b.value){alert("找不到地址~");return}const u=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(b.value)}&key=${R}`;try{const n=(await be.get(u)).data;if(console.log(n),n.results&&n.results.length>0){const s=n.results[0].geometry.location.lat,g=n.results[0].geometry.location.lng;q.value=s,W.value=g,console.log(q.value),console.log(n.results),console.log(s),console.log(g),_.marker([s,g],{icon:D}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${U.value}</h2>
       <h3 style="margin: 2px 0 2px 0;color:gray;">${b.value}</h3>
       <h3 style="margin: 2px 0 2px 0;color:gray;">${C.value}</h3>
  
       <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${P.value}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!1}).openPopup(),Z()}else alert("找不到地址~")}catch(t){console.error("新增地標錯誤:",t),alert("新增地標失敗~")}},ue=te(async u=>{var t,n;try{await j(),console.log(q.value);const s=[...u.category1,...u.category2,...u.category3,...u.category4,...u.category5,...u.category6,...u.category7],g={name:u.name,address:u.address,tel:u.tel,cl:u.cl,categories:s,description:u.description,lat:q.value,lng:W.value};console.log(g),await O.post("landmark/",g),T({text:"新增成功",snackbarProps:{color:"green"}}),f.value.eachLayer(l=>{l instanceof _.Marker&&f.value.removeLayer(l)}),re()}catch(s){console.log(s),T({text:((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),D=_.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/7596/7596723.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),A=k([]),Z=async()=>{var u,t;try{const{data:n}=await O.get("/landmark");A.value.splice(0,A.value.length,...n.result.data),console.log(n),f.value.eachLayer(s=>{s instanceof _.Marker&&f.value.removeLayer(s)}),console.log(A.value),A.value.forEach(s=>{_.marker([s.lat,s.lng],{icon:D}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${s.name}</h2>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.address}</h3>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.tel}</h3>
        <h4 style="margin: 2px 0 2px 0;color:gray;">類別：${s.categories.join(" | ")}</h4>
        <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${s.description}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!1}).addTo(f.value)})}catch(n){console.log(n),T({text:((t=(u=n==null?void 0:n.response)==null?void 0:u.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return Z(),(u,t)=>{const n=ie,s=de,g=ce;return v(),ge(G,null,{default:a(()=>[e(n,{title:K}),r("div",Le,null,512),e(_e,{width:"500px",variant:"outlined",class:"overflow-y-auto"},{default:a(()=>[e(Ae,{color:"secondary bb-1",prominent:""},{default:a(()=>[e(Te,null,{default:a(()=>[fe(" 新增資源 ")]),_:1})]),_:1}),r("div",Be,[e(ke,{onSubmit:ve(o(ue),["prevent"]),disabled:o(se)},{default:a(()=>[e(Pe,{class:"mx-auto my-5",modelValue:o(b),"onUpdate:modelValue":t[0]||(t[0]=l=>ye(b)?b.value=l:null),"error-messages":o(ne),label:"輸入資源地址"},null,8,["modelValue","error-messages"]),e(p,{class:"my-5"},{default:a(()=>[e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:a(()=>[Fe]),_:1}),e(c,{cols:"12",md:"9"},{default:a(()=>[e(s,{modelValue:o(U).value.value,"onUpdate:modelValue":t[1]||(t[1]=l=>o(U).value.value=l),"error-messages":o(U).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:a(()=>[Ne]),_:1}),e(c,{cols:"12",md:"9"},{default:a(()=>[e(s,{modelValue:o(C).value.value,"onUpdate:modelValue":t[2]||(t[2]=l=>o(C).value.value=l),"error-messages":o(C).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:a(()=>[He]),_:1}),e(c,{cols:"12",md:"9",class:"my-auto"},{default:a(()=>[e(Ee,{items:ae.value,label:"服務類別",density:"comfortable",variant:"outlined",modelValue:o(E).value.value,"onUpdate:modelValue":t[3]||(t[3]=l=>o(E).value.value=l),"error-messages":o(E).errorMessage.value,"hide-details":""},null,8,["items","modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"mt-2 text-left ps-6"},{default:a(()=>[ze]),_:1}),e(c,{cols:"12",md:"9"},{default:a(()=>[e(Se,{variant:"accordion"},{default:a(()=>[e(Ue,{title:"選擇類別"},{default:a(()=>[e(Ce,null,{default:a(()=>[e(G,null,{default:a(()=>[e(p,null,{default:a(()=>[e(c,null,{default:a(()=>[Oe,r("div",null,[e(x,{modelValue:o(I).value.value,"onUpdate:modelValue":t[4]||(t[4]=l=>o(I).value.value=l),"error-messages":o(I).errorMessage.value,column:"",multiple:""},{default:a(()=>[(v(),h(w,null,M(Q,l=>e(V,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:a(()=>[e(c,null,{default:a(()=>[Re,r("div",null,[e(x,{modelValue:o(L).value.value,"onUpdate:modelValue":t[5]||(t[5]=l=>o(L).value.value=l),"error-messages":o(L).errorMessage.value,column:"",multiple:""},{default:a(()=>[(v(),h(w,null,M(Y,l=>e(V,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:a(()=>[e(c,null,{default:a(()=>[We,r("div",null,[e(x,{modelValue:o(B).value.value,"onUpdate:modelValue":t[6]||(t[6]=l=>o(B).value.value=l),"error-messages":o(B).errorMessage.value,column:"",multiple:""},{default:a(()=>[(v(),h(w,null,M(J,l=>e(V,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:a(()=>[e(c,null,{default:a(()=>[je,r("div",null,[e(x,{modelValue:o(F).value.value,"onUpdate:modelValue":t[7]||(t[7]=l=>o(F).value.value=l),"error-messages":o(F).errorMessage.value,column:"",multiple:""},{default:a(()=>[(v(),h(w,null,M(X,l=>e(V,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:a(()=>[e(c,null,{default:a(()=>[De,r("div",null,[e(x,{modelValue:o(N).value.value,"onUpdate:modelValue":t[8]||(t[8]=l=>o(N).value.value=l),"error-messages":o(N).errorMessage.value,column:"",multiple:""},{default:a(()=>[(v(),h(w,null,M(ee,l=>e(V,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:a(()=>[e(c,null,{default:a(()=>[Ze,r("div",null,[e(x,{modelValue:o(z).value.value,"onUpdate:modelValue":t[9]||(t[9]=l=>o(z).value.value=l),"error-messages":o(z).errorMessage.value,column:"",multiple:""},{default:a(()=>[(v(),h(w,null,M(le,l=>e(V,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:a(()=>[e(c,null,{default:a(()=>[Ge,e(x,{modelValue:o(H).value.value,"onUpdate:modelValue":t[10]||(t[10]=l=>o(H).value.value=l),"error-messages":o(H).errorMessage.value,column:"",multiple:""},{default:a(()=>[e(V,{value:"其他",text:"其他",filter:"",density:"compact"})]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(c,{cols:"12",md:"3",class:"text-left ps-6"},{default:a(()=>[Ke]),_:1}),e(c,{cols:"12",md:"9"},{default:a(()=>[e(Ie,{style:{"white-space":"pre-line"},variant:"outlined",clearable:"",modelValue:o(P).value.value,"onUpdate:modelValue":t[11]||(t[11]=l=>o(P).value.value=l),"error-messages":o(P).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(p,null,{default:a(()=>[e(c,{class:"text-center"},{default:a(()=>[e(g,{type:"submit",class:"b-1 bg-accent mb-8",onClick:j})]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])])]),_:1})]),_:1})}}},pl=qe(Qe,[["__scopeId","data-v-a07bf488"]]);export{pl as default};
