import{o as f,e as K,m as ce,i as de,n as T,O as ie,w as l,b as e,l as n,a as me,f as pe,g as t,as as ge,c as M,t as w,F as k,V as fe,p as ve,a3 as _e,Q as ye,C as xe,D as Ve}from"./index-B_MsKRGK.js";import{_ as be}from"./inputText-B2kx3wo3.js";import{a as p,V as c,_ as he}from"./breadcrumbs-DtPMZmR7.js";import{c as Me,a as d,e as _,u as we,b as i,V as ke}from"./index.esm-ljndqR0e.js";import{l as y,V as Se,b as $e,d as Pe,a as Ue}from"./leaflet-src-CO3bZzrt.js";import{_ as Ee}from"./search-B_U1lZYu.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Te,a as Ie}from"./VToolbar-Bv0jWWzx.js";import{V as z,a as S}from"./VContainer-w93M8qOh.js";import{a as x,V}from"./VChip-BqWPGbsh.js";import{V as qe}from"./VTextarea-VaueIM27.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VSlideGroup-Ba4bxO7F.js";const Ae={__name:"submitButton",props:{text:{type:String,default:"新增"}},setup(b){return(Q,I)=>(f(),K(ce,{text:b.text,variant:"text",class:"rounded-xl b-1",density:"comfortable",id:"button"},null,8,["text"]))}};var Be={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API:"https://final-back-o7cm.onrender.com"};const m=b=>(xe("data-v-9e6cf30d"),b=b(),Ve(),b),Le={id:"map",ref:"map"},Oe={class:"px-6"},Fe=m(()=>n("label",{class:"form-label"},"服務名稱",-1)),Re=m(()=>n("label",{class:"form-label"},"服務電話",-1)),De=m(()=>n("label",{class:"form-label"},"服務項目",-1)),Ne=m(()=>n("p",null,"服務對象",-1)),He=m(()=>n("p",null,"長期照顧",-1)),We=m(()=>n("p",null,"身心障礙",-1)),Ge=m(()=>n("p",null,"兒童及少年",-1)),je=m(()=>n("p",null,"社會救助",-1)),ze=m(()=>n("p",null,"婦女",-1)),Ke=m(()=>n("p",null,"其他",-1)),Qe=m(()=>n("label",{class:"form-label"},"服務介紹",-1)),Ye={__name:"createMark",setup(b){const{api:Q,apiAuth:I}=ve();_e();const q=de(),Y=["資源地圖","新增資源"],Z=["長期照顧","身心障礙","婦女","兒童及少年","保護性服務"],J=["日照中心","護理之家","居家服務","交通接送","家庭托顧"],X=["身心障礙者服務中心","輔具中心","職業重建中心","小作所","庇護工場"],ee=["少年福利服務中心","親子館","課後班"],ae=["經濟補助","待用餐","基金會","社會福利中心"],le=["婦女福利服務中心","新住民家庭服務中心"],te=Me({name:d().required("服務單位必填"),address:d().required("服務地址必填"),tel:d(),category5:_().of(d()).required("分類必填"),category2:_().of(d()).required("分類必填"),category3:_().of(d()).required("分類必填"),category4:_().of(d()).required("分類必填"),category5:_().of(d()).required("分類必填"),category6:_().of(d()).required("分類必填"),category7:_().of(d()).required("分類必填"),description:d()}),{handleSubmit:oe,isSubmitting:se,resetForm:re}=we({validationSchema:te,initialValues:{name:"",address:"",tel:"",category1:[],category2:[],category3:[],category4:[],category5:[],category6:[],category7:[],description:""}}),$=i("name"),P=i("tel"),A=i("category1"),B=i("category2"),L=i("category3"),O=i("category4"),F=i("category5"),R=i("category6"),D=i("category7"),U=i("description"),{value:h,errorMessage:ne}=i("address"),N=Be.VITE_GOOGLE_MAPS_API_KEY;console.log(N);const v=T(null),E=T(null),H=T(null);ie(()=>{v.value=y.map("map").setView([25.049183268037577,121.51342818384893],12),y.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(v.value)});const W=async()=>{if(!h.value){alert("找不到地址~");return}const u=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(h.value)}&key=${N}`;try{const r=(await ye.get(u)).data;if(console.log(r),r.results&&r.results.length>0){const s=r.results[0].geometry.location.lat,g=r.results[0].geometry.location.lng;E.value=s,H.value=g,console.log(E.value),console.log(r.results),console.log(s),console.log(g),y.marker([s,g],{icon:G}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${$.value}</h2>
       <h3 style="margin: 2px 0 2px 0;color:gray;">${h.value}</h3>
       <h3 style="margin: 2px 0 2px 0;color:gray;">${P.value}</h3>
  
       <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${U.value}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!1}).openPopup(),j()}else alert("找不到地址~")}catch(o){console.error("新增地標錯誤:",o),alert("新增地標失敗~")}},ue=oe(async u=>{var o,r;try{await W(),console.log(E.value);const s=[...u.category1,...u.category2,...u.category3,...u.category4,...u.category5,...u.category6,...u.category7],g={name:u.name,address:u.address,tel:u.tel,categories:s,description:u.description,lat:E.value,lng:H.value};console.log(g),await I.post("landmark/",g),q({text:"新增成功",snackbarProps:{color:"green"}}),v.value.eachLayer(a=>{a instanceof y.Marker&&v.value.removeLayer(a)}),re()}catch(s){console.log(s),q({text:((r=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:r.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),G=y.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/7596/7596723.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),C=T([]),j=async()=>{var u,o;try{const{data:r}=await I.get("/landmark");C.value.splice(0,C.value.length,...r.result.data),console.log(r),v.value.eachLayer(s=>{s instanceof y.Marker&&v.value.removeLayer(s)}),console.log(C.value),C.value.forEach(s=>{y.marker([s.lat,s.lng],{icon:G}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${s.name}</h2>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.address}</h3>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.tel}</h3>
        <h4 style="margin: 2px 0 2px 0;color:gray;">類別：${s.categories.join(" | ")}</h4>
        <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${s.description}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!1}).addTo(v.value)})}catch(r){console.log(r),q({text:((o=(u=r==null?void 0:r.response)==null?void 0:u.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return j(),(u,o)=>{const r=he,s=be,g=Ae;return f(),K(z,null,{default:l(()=>[e(r,{title:Y}),n("div",Le,null,512),e(fe,{width:"500px",variant:"outlined",class:"overflow-y-auto"},{default:l(()=>[e(Te,{color:"secondary bb-1",prominent:""},{default:l(()=>[e(Ie,null,{default:l(()=>[me(" 新增資源 ")]),_:1})]),_:1}),n("div",Oe,[e(ke,{onSubmit:pe(t(ue),["prevent"]),disabled:t(se)},{default:l(()=>[e(Ee,{class:"mx-auto",modelValue:t(h),"onUpdate:modelValue":o[0]||(o[0]=a=>ge(h)?h.value=a:null),"error-messages":t(ne),label:"輸入資源地址"},null,8,["modelValue","error-messages"]),e(p,{class:"my-5"},{default:l(()=>[e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[Fe]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e(s,{modelValue:t($).value.value,"onUpdate:modelValue":o[1]||(o[1]=a=>t($).value.value=a),"error-messages":t($).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[Re]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e(s,{modelValue:t(P).value.value,"onUpdate:modelValue":o[2]||(o[2]=a=>t(P).value.value=a),"error-messages":t(P).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"mt-2 text-left ps-6"},{default:l(()=>[De]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e(Se,{variant:"accordion"},{default:l(()=>[e($e,{title:"選擇類別"},{default:l(()=>[e(Pe,null,{default:l(()=>[e(z,null,{default:l(()=>[e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[Ne,n("div",null,[e(x,{modelValue:t(A).value.value,"onUpdate:modelValue":o[3]||(o[3]=a=>t(A).value.value=a),"error-messages":t(A).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(Z,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[He,n("div",null,[e(x,{modelValue:t(B).value.value,"onUpdate:modelValue":o[4]||(o[4]=a=>t(B).value.value=a),"error-messages":t(B).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(J,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[We,n("div",null,[e(x,{modelValue:t(L).value.value,"onUpdate:modelValue":o[5]||(o[5]=a=>t(L).value.value=a),"error-messages":t(L).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(X,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[Ge,n("div",null,[e(x,{modelValue:t(O).value.value,"onUpdate:modelValue":o[6]||(o[6]=a=>t(O).value.value=a),"error-messages":t(O).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(ee,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[je,n("div",null,[e(x,{modelValue:t(F).value.value,"onUpdate:modelValue":o[7]||(o[7]=a=>t(F).value.value=a),"error-messages":t(F).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(ae,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[ze,n("div",null,[e(x,{modelValue:t(D).value.value,"onUpdate:modelValue":o[8]||(o[8]=a=>t(D).value.value=a),"error-messages":t(D).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(le,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[Ke,e(x,{modelValue:t(R).value.value,"onUpdate:modelValue":o[9]||(o[9]=a=>t(R).value.value=a),"error-messages":t(R).errorMessage.value,column:"",multiple:""},{default:l(()=>[e(V,{value:"其他",text:"其他",filter:"",density:"compact"})]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(c,{cols:"12",md:"3",class:"text-left ps-6"},{default:l(()=>[Qe]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e(qe,{style:{"word-wrap":"break-word"},variant:"outlined",clearable:"",modelValue:t(U).value.value,"onUpdate:modelValue":o[10]||(o[10]=a=>t(U).value.value=a),"error-messages":t(U).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,{class:"text-center"},{default:l(()=>[e(g,{type:"submit",class:"b-1 bg-accent mb-8",onClick:W})]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])])]),_:1}),e(Ue,{color:"info",height:"60px",class:"b-1",app:""})]),_:1})}}},da=Ce(Ye,[["__scopeId","data-v-9e6cf30d"]]);export{da as default};
