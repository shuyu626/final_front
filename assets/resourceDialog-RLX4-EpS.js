import{c as H,a as y,d as J,u as K,b as c,V as L,_ as O}from"./inputText-BKMLUfT3.js";import{n as Q,i as W,p as g,r as X,o as r,c as i,g as s,e as h,w as l,b as a,q as Y,a as v,m as b,t as V,V as Z,s as ee,h as ae,f as te,l as B,k as le,x as se,F as oe,y as re}from"./index-Cy44q8pe.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ie}from"./VTooltip-BvJTsSH4.js";import{V as ue,a as D,b as n}from"./VRow-CGxpYUQV.js";import{V as de}from"./VSelect-DdDgxLNJ.js";const me={key:0,class:"form-label"},ce={key:1,class:"form-label"},pe={class:"form-label"},fe={key:0,class:"form-label"},ye={key:1,class:"form-label"},ge={key:0,class:"form-label"},ve={key:1,class:"form-label"},be={key:0,class:"form-label"},Ve={key:1,class:"form-label"},xe={class:"mx-auto"},_e={__name:"resourceDialog",props:{cardTitle:{type:String,default:"發布需求"},numberTitle:{type:String,default:"需求量"},descriptionTitle:{type:String,default:"需求介紹"},type:{type:String,default:"share"}},emits:["update"],setup(m,{emit:A}){const{mobile:R}=Q(),N=A,{apiAuth:I}=re(),q=W(),P=m,C=["食品","服飾配件","日用品","家具","輔具","教育用品","嬰幼兒用品","電器","休閒用品","其他"],p=g(!1),S=g(null),d=g([]),T=g([]),j=H({name:y().required("物品名稱必填"),quantity:J().min(1,"物品數量不符").required("物品數量必填"),category:y().required("物品分類必填").test("isCategory","商品分類錯誤",o=>C.includes(o)),description:y().required("物資介紹必填"),organizer:y().required("單位名稱必填")}),{handleSubmit:E,isSubmitting:z,resetForm:F}=K({validationSchema:j,initialValues:{name:"",quantity:"0",category:"",description:"",organizer:""}}),x=c("name"),_=c("quantity"),k=c("category"),$=c("description"),w=c("organizer"),M=()=>{F(),p.value=!0},U=()=>{p.value=!1,F(),S.value.deleteFileRecord()},G=E(async o=>{var t,f,u;if(!((t=d.value[0])!=null&&t.error)&&!(d.value.length<1))try{const e=new FormData;e.append("name",o.name),e.append("quantity",o.quantity),e.append("category",o.category),e.append("description",o.description),e.append("organizer",o.organizer),e.append("type",P.type),d.value.length>0&&e.append("image",d.value[0].file),console.log(e),await I.post("/material",e),q({text:"新增成功",snackbarProps:{color:"green"}}),N("update"),U()}catch(e){console.log(e),q({text:((u=(f=e==null?void 0:e.response)==null?void 0:f.data)==null?void 0:u.message)||"發生錯誤",snackbarProps:{color:"red"}})}});return(o,t)=>{const f=X("vue-file-agent"),u=O;return r(),i(oe,null,[s(R)?(r(),h(b,{key:0,onClick:t[0]||(t[0]=e=>M()),class:"bg-info b-1 font-weight-black text-body-1 mt-10 sm-btn",variant:"text",ripple:!1},{default:l(()=>[a(Y,{size:"x-large"},{default:l(()=>[v("mdi-plus")]),_:1}),a(ie,{activator:"parent",location:"top"})]),_:1})):(r(),h(b,{key:1,onClick:t[1]||(t[1]=e=>M()),class:"rounded-lg bg-info b-1 font-weight-black text-body-1 mt-10 lg-btn","prepend-icon":"mdi-plus",variant:"text",ripple:!1},{default:l(()=>[v(V(m.cardTitle),1)]),_:1})),a(se,{"max-width":"600",modelValue:p.value,"onUpdate:modelValue":t[10]||(t[10]=e=>p.value=e)},{default:l(()=>[a(Z,null,{default:l(()=>[a(ue,null,{default:l(()=>[a(ee,{class:"font-weight-black text-center text-h4"},{default:l(()=>[v(V(m.cardTitle),1)]),_:1}),a(ae,null,{default:l(()=>[a(L,{onSubmit:te(s(G),["prevent"]),disabled:s(z)},{default:l(()=>[a(D,null,{default:l(()=>[a(n,null,{default:l(()=>[a(f,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e),"raw-model-value":T.value,"onUpdate:rawModelValue":t[3]||(t[3]=e=>T.value=e),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:S},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1}),a(D,null,{default:l(()=>[a(n,{cols:"4",sm:"3",class:"my-auto text-left ps-6"},{default:l(()=>[o.$vuetify.display.xs?(r(),i("label",me,"物資名")):(r(),i("label",ce,"物資名稱"))]),_:1}),a(n,{cols:"8",sm:"9"},{default:l(()=>[a(u,{modelValue:s(x).value.value,"onUpdate:modelValue":t[4]||(t[4]=e=>s(x).value.value=e),"error-messages":s(x).errorMessage.value,density:o.$vuetify.display.xs?"compact":"comfortable"},null,8,["modelValue","error-messages","density"])]),_:1}),a(n,{cols:"4",sm:"3",class:"my-auto text-left ps-6"},{default:l(()=>[B("label",pe,V(m.numberTitle),1)]),_:1}),a(n,{cols:"8",sm:"9"},{default:l(()=>[a(u,{type:"number",min:"0",modelValue:s(_).value.value,"onUpdate:modelValue":t[5]||(t[5]=e=>s(_).value.value=e),"error-messages":s(_).errorMessage.value,density:o.$vuetify.display.xs?"compact":"comfortable"},null,8,["modelValue","error-messages","density"])]),_:1}),a(n,{cols:"4",sm:"3",class:"my-auto text-left ps-6"},{default:l(()=>[o.$vuetify.display.xs?(r(),i("label",fe,"類別")):(r(),i("label",ye,"物資類別"))]),_:1}),a(n,{cols:"8",sm:"9"},{default:l(()=>[a(de,{modelValue:s(k).value.value,"onUpdate:modelValue":t[6]||(t[6]=e=>s(k).value.value=e),"error-messages":s(k).errorMessage.value,label:"選擇",variant:"outlined",density:o.$vuetify.display.xs?"compact":"comfortable",dense:"",items:C,"hide-details":""},null,8,["modelValue","error-messages","density"])]),_:1}),a(n,{cols:"4",sm:"3",class:"my-auto text-left ps-6"},{default:l(()=>[o.$vuetify.display.xs?(r(),i("label",ge,"介紹")):(r(),i("label",ve,V(m.descriptionTitle),1))]),_:1}),a(n,{cols:"8",sm:"9"},{default:l(()=>[a(u,{modelValue:s($).value.value,"onUpdate:modelValue":t[7]||(t[7]=e=>s($).value.value=e),"error-messages":s($).errorMessage.value,density:o.$vuetify.display.xs?"compact":"comfortable"},null,8,["modelValue","error-messages","density"])]),_:1}),a(n,{cols:"4",sm:"3",class:"my-auto text-left ps-6"},{default:l(()=>[o.$vuetify.display.xs?(r(),i("label",be,"單位名")):(r(),i("label",Ve,"單位名稱"))]),_:1}),a(n,{cols:"8",sm:"9"},{default:l(()=>[a(u,{modelValue:s(w).value.value,"onUpdate:modelValue":t[8]||(t[8]=e=>s(w).value.value=e),"error-messages":s(w).errorMessage.value,density:o.$vuetify.display.xs?"compact":"comfortable"},null,8,["modelValue","error-messages","density"])]),_:1})]),_:1}),a(le,{class:"mt-2"},{default:l(()=>[B("div",xe,[a(b,{variant:"text",class:"rounded-xl b-1 bg-accent",density:"comfortable",type:"submit",loading:s(z)},{default:l(()=>[v("送出")]),_:1},8,["loading"]),a(b,{text:"取消",variant:"text",class:"rounded-xl b-1 bg-info",density:"comfortable",onClick:t[9]||(t[9]=e=>U())})])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Te=ne(_e,[["__scopeId","data-v-70e0cc75"]]);export{Te as _};
