import{_ as le}from"./search-Ch17rswz.js";import{i as te,n as i,O as X,P as Y,o as c,e as g,w as a,l as U,p as oe,q as ne,Q as se,g as N,b as e,v as O,a as k,R as re,m as S,c as $,t as Q,F as L,V as ce,B as D}from"./index-BYCDU5qd.js";import{l as r,V as I,a as j,b as q,c as J}from"./leaflet-src-Bhu5cuqI.js";import"./all.min-B59Hd_Eq.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ae}from"./VContainer-Cm1k3jue.js";import{V as R,a as C}from"./VRow-C1zMKUOG.js";import{V as Z,a as H}from"./VToolbar-YgRAIi1v.js";import{V as W}from"./VSelect-DeFMNacH.js";import{V as ie}from"./VAppBar-DCrNkv4S.js";import{V as de}from"./VNavigationDrawer-iroj-0NY.js";import{V as G}from"./VCheckbox-B34qTswr.js";import"./_commonjsHelpers-8pG71l5X.js";import"./ssrBoot-BT1hUCoP.js";import"./VSlideGroup-TxetrsC9.js";const ue={id:"map",ref:"map"},pe={__name:"leafletMap",props:{searchQuery:{type:String,default:""},selectedCity:{type:String,default:null},selectedArea:{type:String,default:null},selectedSubcategories:{type:Array,default:()=>[]},selectedclient:{type:String,default:null}},setup(B){const w=te(),d=i(null),f=i([]),v=i([]),{api:z}=oe(),n=B,M=()=>{d.value=r.map("map").setView([25.049183268037577,121.51342818384893],12),d.value?(r.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(d.value),d.value.eachLayer(u=>{u instanceof r.Control.Locate&&d.value.removeControl(u)}),r.control.locate({position:"topleft",drawCircle:!0,drawMarker:!0,markerStyle:{color:"black",opacity:.8,weight:.8},locateOptions:{enableHighAccuracy:!0,maxZoom:16},icon:"fa fa-solid fa-crosshairs",onLocationError:function(u){console.error(u.message),w({text:u.message,snackbarProps:{color:"red"}})}}).addTo(d.value)):console.error("Map initialization failed.")},V=async()=>{var u,o;try{const{data:s}=await z.get("/landmark");console.log(s),v.value=s.result.data,E(),console.log(v.value)}catch(s){console.error("Error fetching data:",s),w({text:((o=(u=s==null?void 0:s.response)==null?void 0:u.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red"}})}},h={服務對象:r.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/2377/2377871.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),長期照顧:r.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/12264/12264430.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),身心障礙:r.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/17573/17573294.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),兒童及少年:r.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5759/5759522.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),心理衛生:r.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/4010/4010654.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),婦女:r.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/7457/7457069.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),社會救助:r.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/784/784791.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),綜合:r.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5153/5153858.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),其他:r.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5672/5672993.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]})},E=()=>{if(!d.value)return;f.value.forEach(o=>d.value.removeLayer(o)),f.value=[],v.value.filter(o=>{const s=!n.selectedCity||o.address.includes(n.selectedCity),p=!n.selectedArea||o.address.includes(n.selectedArea),x=!n.searchQuery||o.name.toLowerCase().includes(n.searchQuery.toLowerCase()),b=n.selectedSubcategories.length===0||o.categories.some(_=>n.selectedSubcategories.includes(_));return s&&p&&b&&x}).forEach(o=>{const s=parseFloat(o.lat),p=parseFloat(o.lng),x=o.cl,b=h[x]||h.綜合;if(isFinite(s)&&isFinite(p)){const _=r.marker([s,p],{icon:b}).addTo(d.value).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;color:#1b3f63;">${o.name}</h2>
        <h3 style="margin: 2px 0 2px 0;color:gray;">地址：${o.address}</h3>
        <h3 style="margin: 2px 0 2px 0;color:gray;">電話：${o.tel}</h3>
        <span style="font-size: 1.17em;font-weight: bold;color:gray;">類別：</span><span style="font-size: 1.17em;font-weight: bold;margin: 2px 0 2px 0;color:#7b97a6;">${o.categories.join(" | ")}</span>
        <div><span style="font-size: 1.17em;font-weight: bold;color:gray;">簡介：</span><h4 style="margin: 2px 0 2px 0;color:gray;white-space: pre-line;">${o.description}</h4></div>`);f.value.push(_)}else console.warn(`Invalid coordinates for item: ${JSON.stringify(o)}`)})};return X(()=>[n.searchQuery,n.selectedCity,n.selectedArea,n.selectedSubcategories,n.selectedclient],E),Y(async()=>{M(),await V()}),(u,o)=>(c(),g(ae,null,{default:a(()=>[U("div",ue,null,512)]),_:1}))}},K=ee(pe,[["__scopeId","data-v-c8aa1a74"]]),me={class:"text-right"},fe={id:"filter"},ge={__name:"index",setup(B){const{mobile:w}=ne(),d=i([{name:"服務對象",subcategories:["長期照顧","身心障礙","婦女","兒童及少年","心理衛生","社會救助","綜合","其他"]},{name:"長期照顧",subcategories:["日照中心","護理之家","居家服務","交通接送","家庭托顧"]},{name:"身心障礙",subcategories:["身心障礙者服務中心","輔具中心","職業重建中心","小作所","庇護工場"]},{name:"兒童及少年",subcategories:["少年福利服務中心","親子館","課後班"]},{name:"婦女",subcategories:["婦女福利服務中心","新住民家庭服務中心"]},{name:"社會救助",subcategories:["經濟補助","待用餐","基金會","社會福利中心"]},{name:"其他",subcategories:["其他"]}]),f=i([]),v=i([]),z=i([]),n=i([]),M=i({}),V=i(null),h=i(null),E=["台北市","新北市"],u=async()=>{try{const m=await se.get("https://gist.githubusercontent.com/Wcc723/ac712d2bb5c4e61df99d7c5b7f3746e1/raw/2ebe2f94c3bbbeec254159b7dfe71a007f1696cd/tw-zipcode.json");o(m.data)}catch(m){console.error("Error loading JSON file:",m)}},o=m=>{const l={},A=[];Object.keys(m).forEach(t=>{E.includes(t)&&(A.push(t),l[t]=Object.keys(m[t]))}),z.value=A,M.value=l},s=m=>{console.log("Selected City:",m),n.value=M.value[m]||[],h.value=null};X(V,m=>{s(m)}),Y(()=>{u()});const p=i(""),x=()=>{f.value=[],v.value=[],h.value=[],V.value=[],p.value=""},b=i(!1),_=()=>{b.value=!b.value};return(m,l)=>{const A=le;return c(),g(R,{style:{height:"94vh"}},{default:a(()=>[N(w)?O("",!0):(c(),g(C,{key:0,cols:"12",md:"7",lg:"8",class:"map_col order-2 order-lg-1 order-md-1"},{default:a(()=>[e(K,{searchQuery:p.value,selectedCity:V.value,selectedArea:h.value,selectedSubcategories:f.value,id:"map"},null,8,["searchQuery","selectedCity","selectedArea","selectedSubcategories"])]),_:1})),N(w)?(c(),g(ae,{key:2,class:"pa-0 d-flex flex-column",style:{height:"100%"}},{default:a(()=>[e(ie,null,{default:a(()=>[e(R,{"no-gutters":"",align:"center"},{default:a(()=>[e(C,{cols:"10"},{default:a(()=>[e(A,{modelValue:p.value,"onUpdate:modelValue":l[6]||(l[6]=t=>p.value=t),label:"輸入資源地址",id:"search-xs",class:"ms-2",dense:"",width:"95%"},null,8,["modelValue"])]),_:1}),e(C,{cols:"1",class:"text-center"},{default:a(()=>[e(S,{id:"clear",type:"submit",variant:"plain",class:"rounded-md bb-1 mt-2 bg-grey-lighten-4 d-none d-md-block",density:"comfortable",ripple:!1,height:"40",width:"60",onClick:l[7]||(l[7]=t=>x())},{default:a(()=>[k(" 清空條件 ")]),_:1}),e(S,{icon:"mdi-delete",class:"d-md-none",variant:"text",density:"comfortable",color:"black",onClick:l[8]||(l[8]=t=>x())})]),_:1}),e(C,{cols:"1",class:"text-center"},{default:a(()=>[e(S,{id:"clear",type:"submit",variant:"plain",class:"rounded-md bb-1 mt-2 bg-grey-lighten-4 d-none d-md-block",density:"comfortable",ripple:!1,height:"40",width:"60",onClick:_},{default:a(()=>[k(" 篩選 ")]),_:1}),e(S,{icon:"mdi-filter",class:"d-md-none",variant:"text",density:"comfortable",color:"black",onClick:_})]),_:1})]),_:1})]),_:1}),b.value?(c(),g(de,{key:0,modelValue:b.value,"onUpdate:modelValue":l[11]||(l[11]=t=>b.value=t),temporary:"",width:"100vw",class:"bg-transparent",location:"top"},{default:a(()=>[e(I,{variant:"accordion"},{default:a(()=>[(c(!0),$(L,null,Q(d.value,(t,P)=>(c(),g(j,{key:P,modelValue:v.value,"onUpdate:modelValue":l[10]||(l[10]=y=>v.value=y)},{default:a(()=>[e(q,null,{default:a(()=>[k(D(t.name),1)]),_:2},1024),e(J,null,{default:a(()=>[(c(!0),$(L,null,Q(t.subcategories,(y,T)=>(c(),g(G,{key:T,modelValue:f.value,"onUpdate:modelValue":l[9]||(l[9]=F=>f.value=F),label:y,value:y,"hide-details":""},null,8,["modelValue","label","value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue"]))),128))]),_:1})]),_:1},8,["modelValue"])):O("",!0),e(K,{searchQuery:p.value,selectedCity:V.value,selectedArea:h.value,selectedSubcategories:f.value,id:"map-xs",style:{"flex-grow":"1"}},null,8,["searchQuery","selectedCity","selectedArea","selectedSubcategories"])]),_:1})):(c(),g(C,{key:1,cols:"12",md:"5",lg:"4",class:"map_col order-1 order-lg-2 order-md-2"},{default:a(()=>[e(ce,{class:"find-resource",elevation:"0"},{default:a(()=>[e(Z,{color:"secondary",prominent:"",class:"bb-1 d-none d-md-inline-block"},{default:a(()=>[e(H,null,{default:a(()=>[k(" 服務查詢 ")]),_:1})]),_:1}),e(re,null,{default:a(()=>[U("div",null,[U("div",me,[e(S,{id:"clear",type:"submit",variant:"plain",class:"rounded-md bb-1 mt-2 bg-grey-lighten-4 d-none d-md-block",density:"comfortable",ripple:!1,height:"40",width:"80",onClick:l[0]||(l[0]=t=>x())},{default:a(()=>[k(" 清空條件 ")]),_:1})]),e(A,{class:"my-5","max-width":"1000px",modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=t=>p.value=t),label:"輸入資源地址",id:"search"},null,8,["modelValue"])]),U("div",null,[e(W,{modelValue:V.value,"onUpdate:modelValue":l[2]||(l[2]=t=>V.value=t),items:z.value,"min-width":"145px",label:"縣市",class:"me-3 d-none d-sm-inline-block",style:{width:"48%"},density:"comfortable",variant:"outlined"},null,8,["modelValue","items"]),e(W,{modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=t=>h.value=t),items:n.value,"min-width":"145px",label:"鄉鎮市區",class:"d-none d-sm-inline-block",style:{width:"48%"},density:"comfortable",variant:"outlined"},null,8,["modelValue","items"])]),U("div",fe,[e(Z,{density:"compact",class:"d-none d-md-block"},{default:a(()=>[e(H,{class:"ms-5 text-body-1"},{default:a(()=>[k(" 服務類別 ")]),_:1})]),_:1}),e(I,{variant:"accordion"},{default:a(()=>[(c(!0),$(L,null,Q(d.value,(t,P)=>(c(),g(j,{key:P,modelValue:v.value,"onUpdate:modelValue":l[5]||(l[5]=y=>v.value=y)},{default:a(()=>[e(q,null,{default:a(()=>[k(D(t.name),1)]),_:2},1024),e(J,null,{default:a(()=>[(c(!0),$(L,null,Q(t.subcategories,(y,T)=>(c(),g(G,{key:T,modelValue:f.value,"onUpdate:modelValue":l[4]||(l[4]=F=>f.value=F),label:y,value:y,"hide-details":""},null,8,["modelValue","label","value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue"]))),128))]),_:1})])]),_:1})]),_:1})]),_:1}))]),_:1})}}},Ee=ee(ge,[["__scopeId","data-v-f904995d"]]);export{Ee as default};
