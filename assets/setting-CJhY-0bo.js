import{i as pe,n as r,O as Be,r as re,o as h,c as B,l as n,b as e,w as t,S as _e,y as ye,B as U,a as L,m as ee,V as ie,T as Ve,h as Fe,f as Ue,g as s,k as Re,x as De,F as G,p as ge,D as Se,E as Ce,u as tt,e as me,t as te,j as Oe,a9 as Le,Q as at,P as lt,C as Te,v as Ne,a7 as We}from"./index-DAotSVBs.js";import{c as Me,a as A,u as Ie,b as I,V as qe,f as Ge,e as ve}from"./index.esm-tw-ydve1.js";import{_ as Ee}from"./inputText-U5k-6xhP.js";import{_ as Pe}from"./search-BU1LivuG.js";import{V as ke}from"./eventTable.vue_vue_type_style_index_0_scoped_dd92091b_lang-CjtfpxSl.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as he,a as se}from"./VContainer-DGGr1jMh.js";import{V as O,a as o}from"./VRow-BbB3N1UR.js";import{V as je,b as fe,a as be}from"./VSelect-DBPqF52d.js";import{V as Qe}from"./VTextarea-8-L0_cQG.js";import{_ as st}from"./appButton-BSzXkyvV.js";import{V as Ye,a as Ze}from"./VToolbar-Bz4z7qPG.js";import{_ as ot}from"./submitButton-8mCMexfl.js";import{V as nt,a as rt,c as dt}from"./leaflet-src-gGcrs2yb.js";import{V as ut}from"./VNavigationDrawer-B76AsKgj.js";import{a as it,b as we,c as ct,V as $e}from"./VTabs-pfUr0nTb.js";import{V as Ae}from"./VBreadcrumbs-ClBVwiis.js";import"./_commonjsHelpers-DyTOPYWW.js";import"./ssrBoot-CvjFJ1CD.js";import"./VPagination-CxPqxS_o.js";import"./VSlideGroup-DEnEKjGY.js";const xe=k=>(Se("data-v-dd92091b"),k=k(),Ce(),k),mt={class:"b-1 w-75 mx-auto"},pt=xe(()=>n("h2",{class:"bb-1 bg-accent text-center mx-auto py-1"},"活動管理",-1)),gt={style:{width:"180px"},class:"text-left"},vt={style:{width:"220px"},class:"text-left"},ft={style:{width:"80px"}},bt={style:{width:"350px"},class:"py-2"},yt={style:{width:"80px"}},xt=xe(()=>n("label",{class:"form-label"},"活動名稱：",-1)),_t=xe(()=>n("label",{class:"form-label"},"活動地點：",-1)),Vt=xe(()=>n("label",{class:"form-label"},"活動類別：",-1)),kt=xe(()=>n("label",{class:"form-label"},"活動時間：",-1)),ht=xe(()=>n("label",{class:"form-label"},"主辦單位：",-1)),wt=xe(()=>n("label",{class:"form-label"},"活動介紹：",-1)),$t={class:"mx-auto"},Pt={__name:"eventTable",setup(k){const{api:ce,apiAuth:F}=ge(),_=pe(),Q=r(null),S=r([]),w=r([]),$=r(10),D=r([{key:"createdAt",order:"desc"}]),q=r(1),C=r([]),z=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"活動名稱",align:"center",sortable:!1,key:"title"},{title:"活動地點",align:"center",sortable:!1,key:"address"},{title:"活動類別",align:"center",sortable:!0,key:"category"},{title:"活動時間",align:"center",sortable:!0,key:"date"},{title:"主辦單位",align:"center",sortable:!1,key:"organizer"},{title:"活動介紹",align:"center",sortable:!1,key:"description"},{title:"操作",align:"center",sortable:!1,key:"action"}],T=r(!0),m=r(0),b=r(""),c=async u=>{var a,V,v,i;u&&(q.value=1),T.value=!0;try{const{data:x}=await F.get("/user/event",{params:{page:q.value,itemsPerPage:$.value,sortBy:((a=D.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((V=D.value[0])==null?void 0:V.order)||"desc",search:b.value}});C.value.splice(0,C.value.length,...x.result.data),m.value=x.result.total}catch(x){console.log(x),_({text:((i=(v=x==null?void 0:x.response)==null?void 0:v.data)==null?void 0:i.message)||"發生錯誤",snackbarProps:{color:"red"}})}T.value=!1};c();const g=["兒童","青少年","育兒","長照","精神","照顧","就學","就業","身障","親職教育","早療","紓壓","居住","醫療","司法","社工","其他"],y=r({open:!1,id:""}),P=u=>{y.value.open=!0,y.value.id=u._id,H.value.value=u.title,f.value.value=u.date,M.value.value=u.address,W.value.value=u.category,Z.value.value=u.organizer,J.value.value=u.description},N=()=>{y.value.open=!1,j(),Q.value.deleteFileRecord()},ae=Me({title:A().required("活動標題必填"),date:A().required("活動日期必填"),address:A().required("活動地點必填"),category:A().required("活動分類必填").test("isCategory","商品分類錯誤",u=>g.includes(u)),organizer:A().required("主辦單位必填"),description:A().required("活動介紹必填")}),{handleSubmit:E,isSubmitting:R,resetForm:j}=Ie({validationSchema:ae,initialValues:{title:"",date:"",address:"",category:"",organizer:"",description:""}}),H=I("title"),f=I("date"),M=I("address"),W=I("category"),Z=I("organizer"),J=I("description"),de=E(async u=>{var a,V,v;if(!((a=S.value[0])!=null&&a.error)&&!(S.value.length<1))try{const i=new FormData;i.append("title",u.title),i.append("date",u.date),i.append("address",u.address),i.append("category",u.category),i.append("organizer",u.organizer),i.append("description",u.description),S.value.length>0&&i.append("image",S.value[0].file),await F.patch("/event/"+y.value.id,i),_({text:"新增成功",snackbarProps:{color:"green"}}),N(),c()}catch(i){console.log(i),_({text:((v=(V=i==null?void 0:i.response)==null?void 0:V.data)==null?void 0:v.message)||"發生錯誤",snackbarProps:{color:"red"}})}});Be(b,()=>{c(!0)});const ue=async u=>{var a,V;try{await F.delete(`/event/${u._id}`),_({text:"刪除成功",snackbarProps:{color:"green"}}),c(!0)}catch(v){console.log(v),_({text:((V=(a=v==null?void 0:v.response)==null?void 0:a.data)==null?void 0:V.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return(u,a)=>{const V=Pe,v=re("router-link"),i=re("vue-file-agent"),x=Ee;return h(),B(G,null,[n("div",mt,[pt,e(ke,{"items-per-page":$.value,"onUpdate:itemsPerPage":[a[3]||(a[3]=l=>$.value=l),a[6]||(a[6]=l=>c(!1))],"sort-by":D.value,"onUpdate:sortBy":[a[4]||(a[4]=l=>D.value=l),a[7]||(a[7]=l=>c(!1))],page:q.value,"onUpdate:page":[a[5]||(a[5]=l=>q.value=l),a[8]||(a[8]=l=>c(!1))],items:C.value,headers:z,loading:T.value,"items-length":m.value,search:b.value,hover:"",class:"mb-15 px-8 rounded-lg"},{top:t(()=>[e(V,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=l=>b.value=l),onClickAppend:a[1]||(a[1]=l=>c(!0)),onKeydown:a[2]||(a[2]=_e(l=>c(!0),["enter"])),"max-width":"100%",class:"my-5"},null,8,["modelValue"])]),"item.image":t(({item:l})=>[e(v,{to:"/event/"+l._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ye,{src:l.image,width:"140px","max-height":"160px",class:"my-5"},null,8,["src"])]),_:2},1032,["to"])]),"item.title":t(({item:l})=>[n("td",gt,U(l.title),1)]),"item.address":t(({item:l})=>[n("td",vt,U(l.address),1)]),"item.category":t(({item:l})=>[n("td",ft,U(l.category.join(" , ")),1)]),"item.description":t(({item:l})=>[n("td",bt,U(l.description),1)]),"item.action":t(({item:l})=>[n("td",yt,[L(U(l.action)+" ",1),e(ee,{icon:"mdi-pencil",variant:"text",color:"blue-grey-darken-1",onClick:oe=>P(l)},null,8,["onClick"]),e(ee,{icon:"mdi-delete",variant:"text",color:"red-darken-4",onClick:oe=>ue(l)},null,8,["onClick"])])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),e(De,{"max-width":"700",modelValue:y.value.open,"onUpdate:modelValue":a[18]||(a[18]=l=>y.value.open=l)},{default:t(()=>[e(ie,null,{default:t(()=>[e(he,null,{default:t(()=>[e(Ve,{class:"font-weight-black text-center text-h4"},{default:t(()=>[L("新增活動")]),_:1}),e(Fe,null,{default:t(()=>[e(qe,{onSubmit:Ue(s(de),["prevent"]),disabled:s(R)},{default:t(()=>[e(O,null,{default:t(()=>[e(o,null,{default:t(()=>[e(i,{modelValue:S.value,"onUpdate:modelValue":a[9]||(a[9]=l=>S.value=l),"raw-model-value":w.value,"onUpdate:rawModelValue":a[10]||(a[10]=l=>w.value=l),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:Q},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(o,{cols:"12",md:"3",class:"my-auto text-center"},{default:t(()=>[xt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(x,{modelValue:s(H).value.value,"onUpdate:modelValue":a[11]||(a[11]=l=>s(H).value.value=l),"error-messages":s(H).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-center"},{default:t(()=>[_t]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(x,{modelValue:s(M).value.value,"onUpdate:modelValue":a[12]||(a[12]=l=>s(M).value.value=l),"error-messages":s(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-center"},{default:t(()=>[Vt]),_:1}),e(o,{cols:"12",md:"3"},{default:t(()=>[e(je,{modelValue:s(W).value.value,"onUpdate:modelValue":a[13]||(a[13]=l=>s(W).value.value=l),"error-messages":s(W).errorMessage.value,label:"選擇",variant:"outlined",density:"comfortable",dense:"",width:"140",items:g,"hide-details":""},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"3",class:"my-auto text-center px-0"},{default:t(()=>[kt]),_:1}),e(o,{cols:"3"},{default:t(()=>[e(x,{modelValue:s(f).value.value,"onUpdate:modelValue":a[14]||(a[14]=l=>s(f).value.value=l),"error-messages":s(f).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-center"},{default:t(()=>[ht]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(x,{modelValue:s(Z).value.value,"onUpdate:modelValue":a[15]||(a[15]=l=>s(Z).value.value=l),"error-messages":s(Z).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"text-center"},{default:t(()=>[wt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(Qe,{label:"輸入文字",variant:"outlined",clearable:"","hide-details":"",modelValue:s(J).value.value,"onUpdate:modelValue":a[16]||(a[16]=l=>s(J).value.value=l),"error-messages":s(J).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(Re,null,{default:t(()=>[n("div",$t,[e(ee,{variant:"text",class:"rounded-xl b-1",density:"comfortable",type:"submit",loading:s(R)},{default:t(()=>[L("送出")]),_:1},8,["loading"]),e(ee,{text:"取消",variant:"text",class:"rounded-xl b-1",density:"comfortable",onClick:a[17]||(a[17]=l=>N())})])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Ut=ze(Pt,[["__scopeId","data-v-dd92091b"]]),St={class:"b-1 w-75 mx-auto"},Ct=n("h2",{class:"bg-accent text-center mx-auto bb-1 py-1"},"我要分享",-1),Mt={style:{width:"250px","white-space":"pre-line"},class:"py-2"},It={style:{width:"80px"}},qt=n("label",{class:"form-label"},"物資名稱",-1),zt={class:"form-label"},Tt=n("label",{class:"form-label"},"物資類別",-1),At={class:"form-label"},Bt=n("label",{class:"form-label"},"單位名稱",-1),Ft={class:"mx-auto"},Dt={__name:"shareTable",props:{cardTitle:{type:String,default:"發布需求"},numberTitle:{type:String,default:"需求量"},descriptionTitle:{type:String,default:"需求介紹"},type:{type:String,default:"share"}},setup(k){const{api:ce,apiAuth:F}=ge(),_=pe(),Q=k,S=r(null),w=r([]),$=r([]),D=r(8),q=r([{key:"createdAt",order:"desc"}]),C=r(1),z=r([]),T=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!1,key:"name"},{title:"數量",align:"center",sortable:!1,key:"quantity"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"概況",align:"center",sortable:!1,key:"description"},{title:"單位",align:"center",sortable:!1,key:"organizer"},{title:"操作",align:"center",sortable:!1,key:"action"}],m=r(!0),b=r(0),c=r(""),g=async u=>{var a,V,v,i;u&&(C.value=1),m.value=!0;try{const{data:x}=await F.get("/user/share",{params:{page:C.value,itemsPerPage:D.value,sortBy:((a=q.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((V=q.value[0])==null?void 0:V.order)||"desc",search:c.value}});console.log(x),z.value.splice(0,z.value.length,...x.result.data),b.value=x.result.total}catch(x){console.log(x),_({text:((i=(v=x==null?void 0:x.response)==null?void 0:v.data)==null?void 0:i.message)||"發生錯誤",snackbarProps:{color:"red"}})}m.value=!1};g();const y=["食品","服飾配件","日用品","家具","輔具","教育用品","嬰幼兒用品","電器","休閒用品","其他"],P=r({open:!1,id:""}),N=u=>{P.value.open=!0,P.value.id=u._id,f.value.value=u.name,M.value.value=u.quantity,W.value.value=u.category,Z.value.value=u.description,J.value.value=u.organizer},ae=()=>{P.value.open=!1,H(),S.value.deleteFileRecord()},E=Me({name:A().required("物品名稱必填"),quantity:Ge().min(1,"物品數量不符").required("物品數量必填"),category:A().required("物品分類必填").test("isCategory","商品分類錯誤",u=>y.includes(u)),description:A().required("物資介紹必填"),organizer:A().required("單位名稱必填")}),{handleSubmit:R,isSubmitting:j,resetForm:H}=Ie({validationSchema:E,initialValues:{name:"",quantity:"0",category:"",description:"",organizer:""}}),f=I("name"),M=I("quantity"),W=I("category"),Z=I("description"),J=I("organizer"),de=R(async u=>{var a,V,v;if(!((a=w.value[0])!=null&&a.error)&&!(w.value.length<1))try{const i=new FormData;i.append("name",u.name),i.append("quantity",u.quantity),i.append("category",u.category),i.append("description",u.description),i.append("organizer",u.organizer),i.append("type",Q.type),w.value.length>0&&i.append("image",w.value[0].file),console.log(i),await F.patch("/material/"+P.value.id,i),_({text:"新增成功",snackbarProps:{color:"green"}}),ae(),g()}catch(i){console.log(i),_({text:((v=(V=i==null?void 0:i.response)==null?void 0:V.data)==null?void 0:v.message)||"發生錯誤",snackbarProps:{color:"red"}})}});Be(c,()=>{g(!0)});const ue=async u=>{var a,V;try{await F.delete(`/Material/${u._id}`),_({text:"刪除成功",snackbarProps:{color:"green"}}),g(!0)}catch(v){console.log(v),_({text:((V=(a=v==null?void 0:v.response)==null?void 0:a.data)==null?void 0:V.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return(u,a)=>{const V=Pe,v=re("router-link"),i=re("vue-file-agent"),x=Ee;return h(),B(G,null,[n("div",St,[Ct,e(ke,{"items-per-page":D.value,"onUpdate:itemsPerPage":[a[3]||(a[3]=l=>D.value=l),a[6]||(a[6]=l=>g(!1))],"sort-by":q.value,"onUpdate:sortBy":[a[4]||(a[4]=l=>q.value=l),a[7]||(a[7]=l=>g(!1))],page:C.value,"onUpdate:page":[a[5]||(a[5]=l=>C.value=l),a[8]||(a[8]=l=>g(!1))],items:z.value,headers:T,loading:m.value,"items-length":b.value,search:c.value,hover:"",class:"mb-15 px-8"},{top:t(()=>[e(V,{class:"my-5",modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=l=>c.value=l),onClickAppend:a[1]||(a[1]=l=>g(!0)),onKeydown:a[2]||(a[2]=_e(l=>g(!0),["enter"])),"max-width":"100%"},null,8,["modelValue"])]),"item.image":t(({item:l})=>[e(v,{to:"/material/share/"+l._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ye,{src:l.image,width:"80px","max-height":"100px"},null,8,["src"])]),_:2},1032,["to"])]),"item.description":t(({item:l})=>[n("td",Mt,U(l.description),1)]),"item.action":t(({item:l})=>[n("td",It,[L(U(l.action)+" ",1),e(ee,{icon:"mdi-pencil",variant:"text",color:"blue-grey-darken-1",onClick:oe=>N(l)},null,8,["onClick"]),e(ee,{icon:"mdi-delete",variant:"text",color:"red-darken-4",onClick:oe=>ue(l)},null,8,["onClick"])])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),e(De,{"max-width":"600",modelValue:P.value.open,"onUpdate:modelValue":a[17]||(a[17]=l=>P.value.open=l)},{default:t(()=>[e(ie,null,{default:t(()=>[e(he,null,{default:t(()=>[e(Ve,{class:"font-weight-black text-center text-h4"},{default:t(()=>[L(U(k.cardTitle),1)]),_:1}),e(Fe,null,{default:t(()=>[e(qe,{onSubmit:Ue(s(de),["prevent"]),disabled:s(j)},{default:t(()=>[e(O,null,{default:t(()=>[e(o,null,{default:t(()=>[e(i,{modelValue:w.value,"onUpdate:modelValue":a[9]||(a[9]=l=>w.value=l),"raw-model-value":$.value,"onUpdate:rawModelValue":a[10]||(a[10]=l=>$.value=l),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:S},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[qt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(x,{modelValue:s(f).value.value,"onUpdate:modelValue":a[11]||(a[11]=l=>s(f).value.value=l),"error-messages":s(f).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[n("label",zt,U(k.numberTitle),1)]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(x,{modelValue:s(M).value.value,"onUpdate:modelValue":a[12]||(a[12]=l=>s(M).value.value=l),"error-messages":s(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[Tt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(je,{modelValue:s(W).value.value,"onUpdate:modelValue":a[13]||(a[13]=l=>s(W).value.value=l),"error-messages":s(W).errorMessage.value,label:"選擇",variant:"outlined",density:"comfortable",dense:"",items:y,"hide-details":""},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[n("label",At,U(k.descriptionTitle),1)]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(x,{modelValue:s(Z).value.value,"onUpdate:modelValue":a[14]||(a[14]=l=>s(Z).value.value=l),"error-messages":s(Z).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[Bt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(x,{modelValue:s(J).value.value,"onUpdate:modelValue":a[15]||(a[15]=l=>s(J).value.value=l),"error-messages":s(J).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(Re,null,{default:t(()=>[n("div",Ft,[e(ee,{variant:"text",class:"rounded-xl b-1",density:"comfortable",type:"submit",loading:s(j)},{default:t(()=>[L("送出")]),_:1},8,["loading"]),e(ee,{text:"取消",variant:"text",class:"rounded-xl b-1",density:"comfortable",onClick:a[16]||(a[16]=l=>ae())})])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Et={class:"b-1 w-75 mx-auto"},Lt=n("h2",{class:"bg-accent text-center mx-auto bb-1 py-1"},"我要募資",-1),Rt={style:{width:"250px","white-space":"pre-line"},class:"py-2"},jt={style:{width:"80px"}},Kt=n("label",{class:"form-label"},"物資名稱",-1),Ht={class:"form-label"},Ot=n("label",{class:"form-label"},"物資類別",-1),Nt={class:"form-label"},Wt=n("label",{class:"form-label"},"單位名稱",-1),Gt={class:"mx-auto"},Qt={__name:"findTable",props:{cardTitle:{type:String,default:"發布需求"},numberTitle:{type:String,default:"需求量"},descriptionTitle:{type:String,default:"需求介紹"},type:{type:String,default:"share"}},setup(k){const{api:ce,apiAuth:F}=ge(),_=pe(),Q=k,S=r(null),w=r([]),$=r([]),D=r(8),q=r([{key:"createdAt",order:"desc"}]),C=r(1),z=r([]),T=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!1,key:"name"},{title:"數量",align:"center",sortable:!1,key:"quantity"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"概況",align:"center",sortable:!1,key:"description"},{title:"單位",align:"center",sortable:!1,key:"organizer"},{title:"操作",align:"center",sortable:!1,key:"action"}],m=r(!0),b=r(0),c=r(""),g=async u=>{var a,V,v,i;u&&(C.value=1),m.value=!0;try{const{data:x}=await F.get("/user/find",{params:{page:C.value,itemsPerPage:D.value,sortBy:((a=q.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((V=q.value[0])==null?void 0:V.order)||"desc",search:c.value}});z.value.splice(0,z.value.length,...x.result.data),b.value=x.result.total}catch(x){console.log(x),_({text:((i=(v=x==null?void 0:x.response)==null?void 0:v.data)==null?void 0:i.message)||"發生錯誤",snackbarProps:{color:"red"}})}m.value=!1};g();const y=["食品","服飾配件","日用品","家具","輔具","教育用品","嬰幼兒用品","電器","休閒用品","其他"],P=r({open:!1,id:""}),N=u=>{P.value.open=!0,P.value.id=u._id,f.value.value=u.name,M.value.value=u.quantity,W.value.value=u.category,Z.value.value=u.description,J.value.value=u.organizer},ae=()=>{P.value.open=!1,H(),S.value.deleteFileRecord()},E=Me({name:A().required("物品名稱必填"),quantity:Ge().min(1,"物品數量不符").required("物品數量必填"),category:A().required("物品分類必填").test("isCategory","商品分類錯誤",u=>y.includes(u)),description:A().required("物資介紹必填"),organizer:A().required("單位名稱必填")}),{handleSubmit:R,isSubmitting:j,resetForm:H}=Ie({validationSchema:E,initialValues:{name:"",quantity:"0",category:"",description:"",organizer:""}}),f=I("name"),M=I("quantity"),W=I("category"),Z=I("description"),J=I("organizer"),de=R(async u=>{var a,V,v;if(!((a=w.value[0])!=null&&a.error)&&!(w.value.length<1))try{const i=new FormData;i.append("name",u.name),i.append("quantity",u.quantity),i.append("category",u.category),i.append("description",u.description),i.append("organizer",u.organizer),i.append("type",Q.type),w.value.length>0&&i.append("image",w.value[0].file),console.log(i),await F.patch("/material/"+P.value.id,i),_({text:"新增成功",snackbarProps:{color:"green"}}),g(),ae()}catch(i){console.log(i),_({text:((v=(V=i==null?void 0:i.response)==null?void 0:V.data)==null?void 0:v.message)||"發生錯誤",snackbarProps:{color:"red"}})}});Be(c,()=>{g(!0)});const ue=async u=>{var a,V;try{await F.delete(`/Material/${u._id}`),_({text:"刪除成功",snackbarProps:{color:"green"}}),g(!0)}catch(v){console.log(v),_({text:((V=(a=v==null?void 0:v.response)==null?void 0:a.data)==null?void 0:V.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return(u,a)=>{const V=Pe,v=re("router-link"),i=re("vue-file-agent"),x=Ee;return h(),B(G,null,[n("div",Et,[Lt,e(ke,{"items-per-page":D.value,"onUpdate:itemsPerPage":[a[3]||(a[3]=l=>D.value=l),a[6]||(a[6]=l=>g(!1))],"sort-by":q.value,"onUpdate:sortBy":[a[4]||(a[4]=l=>q.value=l),a[7]||(a[7]=l=>g(!1))],page:C.value,"onUpdate:page":[a[5]||(a[5]=l=>C.value=l),a[8]||(a[8]=l=>g(!1))],items:z.value,headers:T,loading:m.value,"items-length":b.value,search:c.value,hover:"",class:"mb-15 px-8 text-body-1"},{top:t(()=>[e(V,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=l=>c.value=l),onClickAppend:a[1]||(a[1]=l=>g(!0)),onKeydown:a[2]||(a[2]=_e(l=>g(!0),["enter"])),"max-width":"100%",class:"my-5"},null,8,["modelValue"])]),"item.image":t(({item:l})=>[e(v,{to:"/material/find/"+l._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ye,{src:l.image,width:"80px","max-height":"100px"},null,8,["src"])]),_:2},1032,["to"])]),"item.description":t(({item:l})=>[n("td",Rt,U(l.description),1)]),"item.action":t(({item:l})=>[n("td",jt,[L(U(l.action)+" ",1),e(ee,{icon:"mdi-pencil",variant:"text",color:"blue-grey-darken-1",onClick:oe=>N(l)},null,8,["onClick"]),e(ee,{icon:"mdi-delete",variant:"text",color:"red-darken-4",onClick:oe=>ue(l)},null,8,["onClick"])])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),e(De,{"max-width":"600",modelValue:P.value.open,"onUpdate:modelValue":a[17]||(a[17]=l=>P.value.open=l)},{default:t(()=>[e(ie,null,{default:t(()=>[e(he,null,{default:t(()=>[e(Ve,{class:"font-weight-black text-center text-h4"},{default:t(()=>[L(U(k.cardTitle),1)]),_:1}),e(Fe,null,{default:t(()=>[e(qe,{onSubmit:Ue(s(de),["prevent"]),disabled:s(j)},{default:t(()=>[e(O,null,{default:t(()=>[e(o,null,{default:t(()=>[e(i,{modelValue:w.value,"onUpdate:modelValue":a[9]||(a[9]=l=>w.value=l),"raw-model-value":$.value,"onUpdate:rawModelValue":a[10]||(a[10]=l=>$.value=l),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:S},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[Kt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(x,{modelValue:s(f).value.value,"onUpdate:modelValue":a[11]||(a[11]=l=>s(f).value.value=l),"error-messages":s(f).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[n("label",Ht,U(k.numberTitle),1)]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(x,{modelValue:s(M).value.value,"onUpdate:modelValue":a[12]||(a[12]=l=>s(M).value.value=l),"error-messages":s(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[Ot]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(je,{modelValue:s(W).value.value,"onUpdate:modelValue":a[13]||(a[13]=l=>s(W).value.value=l),"error-messages":s(W).errorMessage.value,label:"選擇",variant:"outlined",density:"comfortable",dense:"",items:y,"hide-details":""},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[n("label",Nt,U(k.descriptionTitle),1)]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(x,{modelValue:s(Z).value.value,"onUpdate:modelValue":a[14]||(a[14]=l=>s(Z).value.value=l),"error-messages":s(Z).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[Wt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(x,{modelValue:s(J).value.value,"onUpdate:modelValue":a[15]||(a[15]=l=>s(J).value.value=l),"error-messages":s(J).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(Re,null,{default:t(()=>[n("div",Gt,[e(ee,{variant:"text",class:"rounded-xl b-1",density:"comfortable",type:"submit",loading:s(j)},{default:t(()=>[L("送出")]),_:1},8,["loading"]),e(ee,{text:"取消",variant:"text",class:"rounded-xl b-1",density:"comfortable",onClick:a[16]||(a[16]=l=>ae())})])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Yt=k=>(Se("data-v-ac9944f4"),k=k(),Ce(),k),Zt={id:"profile",class:"b-1 w-50 text-center mx-auto rounded-lg"},Jt={id:"img",style:{width:"170px",height:"170px"},class:"rounded-circle d-flex justify-center align-center bg-grey-lighten-5 mx-auto my-5 b-1"},Xt=Yt(()=>n("div",{id:"upload"},"編輯",-1)),ea={key:0,style:{"font-size":"18px",color:"#616161"},class:"text-h6 font-weight-bold"},ta={style:{"font-size":"18px",color:"#616161"},class:"text-h6"},aa={key:0,style:{"font-size":"18px",color:"#616161"},class:"text-h6"},la={__name:"accountTable",setup(k){const ce=tt(),{apiAuth:F}=ge(),_=pe(),Q=r(null),S=r([]),w=r([]),$=r([]);(async()=>{var E,R;try{const{data:j}=await F.get("/user/profile");$.value=[j.result],$.value[0].password="********",$.value[0].newUsername=$.value[0].username,$.value[0].newPassword="",console.log($.value)}catch(j){_({text:((R=(E=j==null?void 0:j.response)==null?void 0:E.data)==null?void 0:R.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const q=Me({newUsername:A().min(3,"服務單位長度不符").max(20,"服務單位長度不符"),newPassword:A().min(6,"使用者密碼長度不符").max(20,"使用者密碼長度不符")}),{handleSubmit:C,isSubmitting:z}=Ie({validationSchema:q}),{value:T,errorMessage:m}=I("newUsername"),{value:b,errorMessage:c}=I("newPassword"),g=C(async()=>{var E,R;try{const j=$.value[0],H=new FormData;T.value&&T.value!==j.username&&H.append("username",T.value),b.value&&b.value!==""&&H.append("password",b.value),S.value.length!==0&&H.append("image",S.value[0].file);for(let[M,W]of H.entries())console.log(`${M}:`,W);if(H.get("username")===null&&H.get("password")===null&&H.get("image")===null){_({text:"沒有任何變更",snackbarProps:{color:"accent"}});return}console.log(H);const f=await F.patch("/user/change",H);f.data.success?(_({text:"資料修改成功",snackbarProps:{color:"green"}}),ce.push("/")):_({text:f.data.message||"發生錯誤",snackbarProps:{color:"red"}})}catch(j){_({text:((R=(E=j==null?void 0:j.response)==null?void 0:E.data)==null?void 0:R.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),y=E=>{E.isEditing=!E.isEditing},P=E=>{E.isEditing=!1},N=E=>{E.passwordisEditing=!E.passwordisEditing},ae=E=>{E.passwordisEditing=!1};return(E,R)=>{const j=re("vue-file-agent"),H=st;return h(),me(ie,{flat:""},{default:t(()=>[e(qe,{onSubmit:Ue(s(g),["prevent"]),disabled:s(z)},{default:t(()=>[e(Fe,null,{default:t(()=>[n("div",Zt,[e(Ye,{color:"info",class:"mb-10 rounded-t-lg bb-1",prominent:""},{default:t(()=>[e(Ze,{class:"ms-0 font-weight-bold",style:{"font-size":"23px",color:"#616161"}},{default:t(()=>[L("基本資料")]),_:1})]),_:1}),e(j,{id:"account",class:"d-flex justify-center mb-5",accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"上傳大頭照","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},modelValue:S.value,"onUpdate:modelValue":R[0]||(R[0]=f=>S.value=f),"raw-model-value":w.value,"onUpdate:rawModelValue":R[1]||(R[1]=f=>w.value=f),ref_key:"fileAgent",ref:Q},null,8,["modelValue","raw-model-value"]),(h(!0),B(G,null,te($.value,f=>(h(),B(G,{key:f.id},[n("div",Jt,[e(ye,{src:f.avatar,cover:""},null,8,["src"])]),Xt],64))),128)),e(he,null,{default:t(()=>[e(O,{class:"mb-5 px-15 text-left"},{default:t(()=>[e(o,{md:"2"}),e(o,{cols:"12",md:"3",class:"my-auto form-label text-h6",style:{"font-size":"18px"}},{default:t(()=>[L("服務單位")]),_:1}),(h(!0),B(G,null,te($.value,f=>(h(),B(G,{key:f.id},[e(o,{cols:"12",md:"4",class:"my-auto"},{default:t(()=>[f.isEditing?(h(),me(Oe,{key:1,class:"form-label",style:{"font-size":"18px"},variant:"outlined","single-line":"",density:"comfortable",clearable:"",dense:"",modelValue:s(T),"onUpdate:modelValue":R[2]||(R[2]=M=>Le(T)?T.value=M:null),"error-messages":s(m),onKeydown:_e(M=>P(f),["enter"])},null,8,["modelValue","error-messages","onKeydown"])):(h(),B("p",ea,U(f.username),1))]),_:2},1024),e(o,{md:"3",class:"ps-10"},{default:t(()=>[e(ee,{onClick:M=>y(f),icon:"mdi-pencil",variant:"text",color:"blue-grey-darken-1"},null,8,["onClick"])]),_:2},1024)],64))),128)),e(se)]),_:1}),e(O,{class:"mb-5 px-15 text-left"},{default:t(()=>[e(o,{md:"2"}),e(o,{cols:"12",md:"3",class:"my-auto form-label text-h6",style:{"font-size":"18px"}},{default:t(()=>[L("電子信箱")]),_:1}),(h(!0),B(G,null,te($.value,f=>(h(),me(o,{key:f.id,cols:"12",md:"4",class:"my-auto"},{default:t(()=>[n("p",ta,U(f.email),1)]),_:2},1024))),128)),e(se)]),_:1}),e(O,{class:"mb-5 px-15 text-left"},{default:t(()=>[e(o,{md:"2"}),e(o,{cols:"12",md:"3",class:"my-auto form-label text-h6",style:{"font-size":"18px"}},{default:t(()=>[L("密碼")]),_:1}),(h(!0),B(G,null,te($.value,f=>(h(),B(G,{key:f.id},[e(o,{cols:"12",md:"4",class:"my-auto"},{default:t(()=>[f.passwordisEditing?(h(),me(Oe,{key:1,class:"form-label",style:{"font-size":"18px"},variant:"outlined","single-line":"",density:"comfortable",clearable:"",dense:"",modelValue:s(b),"onUpdate:modelValue":R[3]||(R[3]=M=>Le(b)?b.value=M:null),"error-messages":s(c),onKeydown:_e(M=>ae(f),["enter"])},null,8,["modelValue","error-messages","onKeydown"])):(h(),B("p",aa,U(f.password),1))]),_:2},1024),e(o,{md:"3",class:"ps-10"},{default:t(()=>[e(ee,{onClick:M=>N(f),icon:"mdi-pencil",variant:"text",color:"blue-grey-darken-1"},null,8,["onClick"])]),_:2},1024)],64))),128)),e(se)]),_:1}),e(H,{text:"提交",class:"mx-auto bg-accent my-5 text-body-1",width:"80",height:"30"})]),_:1})])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})}}},sa=ze(la,[["__scopeId","data-v-ac9944f4"]]),oa=k=>(Se("data-v-71aa44fe"),k=k(),Ce(),k),na={class:"b-1 w-75 mx-auto my-8"},ra=oa(()=>n("h2",{class:"bb-1 bg-accent text-center mx-auto py-1 mb-5"},"索取者聯絡資訊",-1)),da={__name:"shareReplyTable",setup(k){const{api:ce,apiAuth:F}=ge(),_=pe(),Q=r(8),S=r([{key:"createdAt",order:"desc"}]),w=r(1),$=r([]),D=[{title:"物資",align:"center",sortable:!1,key:"image"},{title:"索取者聯絡資訊",align:"center",sortable:!1,key:"donations"}],q=r(!0),C=r(0),z=async T=>{var m,b,c,g;T&&(w.value=1),q.value=!0;try{const{data:y}=await F.get("/user/share",{params:{page:w.value,itemsPerPage:Q.value,sortBy:((m=S.value[0])==null?void 0:m.key)||"createdAt",sortOrder:((b=S.value[0])==null?void 0:b.order)||"desc"}});console.log(y.result.data);const P=y.result.data.filter(N=>N.donations&&N.donations.length>0);$.value.splice(0,$.value.length,...P),C.value=P.length}catch(y){console.log(y),_({text:((g=(c=y==null?void 0:y.response)==null?void 0:c.data)==null?void 0:g.message)||"發生錯誤",snackbarProps:{color:"red"}})}q.value=!1};return z(),(T,m)=>{const b=re("router-link");return h(),B("div",na,[ra,e(ke,{"items-per-page":Q.value,"onUpdate:itemsPerPage":[m[0]||(m[0]=c=>Q.value=c),m[3]||(m[3]=c=>z(!1))],"sort-by":S.value,"onUpdate:sortBy":[m[1]||(m[1]=c=>S.value=c),m[4]||(m[4]=c=>z(!1))],page:w.value,"onUpdate:page":[m[2]||(m[2]=c=>w.value=c),m[5]||(m[5]=c=>z(!1))],items:$.value,headers:D,loading:q.value,"items-length":C.value,hover:"",class:"mb-15 px-8 rounded-lg"},{"item.image":t(({item:c})=>[e(o,{cols:"12",md:"4",class:"mx-auto",style:{width:"300px"}},{default:t(()=>[e(b,{to:"/material/share/"+c._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ye,{src:c.image,width:"250px","max-height":"200px",class:"my-5"},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024)]),"item.donations":t(({item:c})=>[e(o,null,{default:t(()=>[(h(!0),B(G,null,te(c.donations,(g,y)=>(h(),me(ie,{class:"mb-2",outlined:"",variant:"text",key:y},{default:t(()=>[e(Ve,null,{default:t(()=>[e(O,{"no-gutters":""},{default:t(()=>[e(o,{cols:"3",class:"text-body-1 text-left"},{default:t(()=>[L("數量: "+U(g.quantity),1)]),_:2},1024),e(o,{cols:"5",class:"text-body-1 text-left"},{default:t(()=>[L("服務單位: "+U(g.donator),1)]),_:2},1024),e(o,{cols:"4",class:"text-body-1 text-left"},{default:t(()=>[L("聯絡電話: "+U(g.phone),1)]),_:2},1024)]),_:2},1024),e(se,{class:"100%"})]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length"])])}}},ua=ze(da,[["__scopeId","data-v-71aa44fe"]]),ia=k=>(Se("data-v-8c0c0b4e"),k=k(),Ce(),k),ca={class:"b-1 w-75 mx-auto"},ma=ia(()=>n("h2",{class:"bb-1 bg-accent text-center mx-auto py-1 mb-5"},"捐贈者聯絡資訊",-1)),pa={__name:"findReplyTable",setup(k){const{api:ce,apiAuth:F}=ge(),_=pe(),Q=r(8),S=r([{key:"createdAt",order:"desc"}]),w=r(1),$=r([]),D=[{title:"物資",align:"center",sortable:!1,key:"image"},{title:"捐贈者聯絡資訊",align:"center",sortable:!1,key:"donations"}],q=r(!0),C=r(0),z=async T=>{var m,b,c,g;T&&(w.value=1),q.value=!0;try{const{data:y}=await F.get("/user/find",{params:{page:w.value,itemsPerPage:Q.value,sortBy:((m=S.value[0])==null?void 0:m.key)||"createdAt",sortOrder:((b=S.value[0])==null?void 0:b.order)||"desc"}});console.log(y.result.data);const P=y.result.data.filter(N=>N.donations&&N.donations.length>0);$.value.splice(0,$.value.length,...P),C.value=P.length}catch(y){console.log(y),_({text:((g=(c=y==null?void 0:y.response)==null?void 0:c.data)==null?void 0:g.message)||"發生錯誤",snackbarProps:{color:"red"}})}q.value=!1};return z(),(T,m)=>{const b=re("router-link");return h(),B("div",ca,[ma,e(ke,{"items-per-page":Q.value,"onUpdate:itemsPerPage":[m[0]||(m[0]=c=>Q.value=c),m[3]||(m[3]=c=>z(!1))],"sort-by":S.value,"onUpdate:sortBy":[m[1]||(m[1]=c=>S.value=c),m[4]||(m[4]=c=>z(!1))],page:w.value,"onUpdate:page":[m[2]||(m[2]=c=>w.value=c),m[5]||(m[5]=c=>z(!1))],items:$.value,headers:D,loading:q.value,"items-length":C.value,hover:"",class:"mb-15 px-8 rounded-lg"},{"item.image":t(({item:c})=>[e(o,{cols:"12",md:"4",class:"mx-auto",style:{width:"250px"}},{default:t(()=>[e(b,{to:"/material/find/"+c._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ye,{src:c.image,width:"250px","max-height":"150px",class:"my-5"},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024)]),"item.donations":t(({item:c})=>[e(o,null,{default:t(()=>[(h(!0),B(G,null,te(c.donations,(g,y)=>(h(),me(ie,{class:"mb-2",outlined:"",variant:"text",key:y},{default:t(()=>[e(Ve,null,{default:t(()=>[e(O,{"no-gutters":""},{default:t(()=>[e(o,{cols:"3",class:"text-body-1 text-left"},{default:t(()=>[L("數量: "+U(g.quantity),1)]),_:2},1024),e(o,{cols:"5",class:"text-body-1 text-left"},{default:t(()=>[L("服務單位: "+U(g.donator),1)]),_:2},1024),e(o,{cols:"4",class:"text-body-1 text-left"},{default:t(()=>[L("聯絡電話: "+U(g.phone),1)]),_:2},1024)]),_:2},1024),e(se,{class:"100%"})]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length"])])}}},ga=ze(pa,[["__scopeId","data-v-8c0c0b4e"]]),va={class:"b-1 w-75 mx-auto"},fa=n("h2",{class:"bg-accent text-center mx-auto bb-1 py-1"},"地標管理",-1),ba={style:{width:"240px"}},ya={style:{width:"120px"}},xa={style:{width:"300px"},class:"text-left"},_a={style:{width:"200px"},class:"text-center"},Va={style:{width:"350px"},class:"py-2 text-left"},ka={style:{width:"80px"}},ha={class:"px-6 my-2"},wa=n("label",{class:"form-label"},"服務地址",-1),$a=n("label",{class:"form-label"},"服務名稱",-1),Pa=n("label",{class:"form-label"},"服務電話",-1),Ua=n("label",{class:"form-label"},"服務項目",-1),Sa=n("p",null,"服務對象",-1),Ca=n("p",null,"長期照顧",-1),Ma=n("p",null,"身心障礙",-1),Ia=n("p",null,"兒童及少年",-1),qa=n("p",null,"社會救助",-1),za=n("p",null,"婦女",-1),Ta=n("p",null,"其他",-1),Aa=n("label",{class:"form-label"},"服務介紹",-1),Ba={__name:"landmarkTable",setup(k){const{api:ce,apiAuth:F}=ge(),_=pe(),Q=["長期照顧","身心障礙","婦女","兒童及少年","保護性服務"],S=["日照中心","護理之家","居家服務","交通接送","家庭托顧"],w=["身心障礙者服務中心","輔具中心","職業重建中心","小作所","庇護工場"],$=["少年福利服務中心","親子館","課後班"],D=["經濟補助","待用餐","基金會","社會福利中心"],q=["婦女福利服務中心","新住民家庭服務中心"],C=r(10),z=r([{key:"createdAt",order:"desc"}]),T=r(1),m=r([]),b=[{title:"服務名稱",align:"center",sortable:!1,key:"name"},{title:"地址",align:"center",sortable:!0,key:"address"},{title:"聯絡電話",align:"center",sortable:!1,key:"tel"},{title:"服務項目",align:"center",sortable:!0,key:"categories"},{title:"服務介紹",align:"center",sortable:!1,key:"description"},{title:"操作",align:"center",sortable:!1,key:"action"}],c=r(!0),g=r(0),y=r(""),P=async K=>{var p,X,Y,le;K&&(T.value=1),c.value=!0;try{const{data:ne}=await F.get("/user/landmark",{params:{page:T.value,itemsPerPage:C.value,sortBy:((p=z.value[0])==null?void 0:p.key)||"createdAt",sortOrder:((X=z.value[0])==null?void 0:X.order)||"desc",search:y.value}});console.log(ne),m.value.splice(0,m.value.length,...ne.result.data),g.value=ne.result.total}catch(ne){console.log(ne),_({text:((le=(Y=ne==null?void 0:ne.response)==null?void 0:Y.data)==null?void 0:le.message)||"發生錯誤",snackbarProps:{color:"red"}})}c.value=!1};P();const N=r({open:!1}),ae=K=>{N.value.open=!0,N.value.id=K._id,M.value.value=K.name,W.value.value=K.tel,v.value.value=K.description},E=()=>{N.value.open=!1,f()},R=Me({name:A().required("服務單位必填"),address:A().required("服務地址必填"),tel:A(),category5:ve().of(A()).required("分類必填"),category2:ve().of(A()).required("分類必填"),category3:ve().of(A()).required("分類必填"),category4:ve().of(A()).required("分類必填"),category5:ve().of(A()).required("分類必填"),category6:ve().of(A()).required("分類必填"),category7:ve().of(A()).required("分類必填"),description:A()}),{handleSubmit:j,isSubmitting:H,resetForm:f}=Ie({validationSchema:R,initialValues:{name:"",address:"",tel:"",category1:[],category2:[],category3:[],category4:[],category5:[],category6:[],category7:[],description:""}}),M=I("name"),W=I("tel"),Z=I("category1"),J=I("category2"),de=I("category3"),ue=I("category4"),u=I("category5"),a=I("category6"),V=I("category7"),v=I("description"),{value:i,errorMessage:x}=I("address"),l="AIzaSyAyML8H2ENbc_kzs_ZSI6qYf7CCbBt0dAA";console.log(l);const oe=r(null),Ke=r(null),He=async()=>{if(!i.value){alert("找不到地址~");return}const K=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(i.value)}&key=${l}`;try{const X=(await at.get(K)).data;if(console.log(X),X.results&&X.results.length>0){const Y=X.results[0].geometry.location.lat,le=X.results[0].geometry.location.lng;oe.value=Y,Ke.value=le,console.log(oe.value),console.log(X.results),console.log(Y),console.log(le)}else alert("找不到地址~")}catch(p){console.error("新增地標錯誤:",p),alert("新增地標失敗~")}},Je=j(async K=>{var p,X;try{await He(),console.log(oe.value);const Y=[...K.category1,...K.category2,...K.category3,...K.category4,...K.category5,...K.category6,...K.category7],le={name:K.name,address:K.address,tel:K.tel,categories:Y,description:K.description,lat:oe.value,lng:Ke.value};console.log(le),await F.patch("landmark/"+N.value.id,le),_({text:"修改成功",snackbarProps:{color:"green"}}),E(),f(),P(!0)}catch(Y){console.log(Y),_({text:((X=(p=Y==null?void 0:Y.response)==null?void 0:p.data)==null?void 0:X.message)||"發生錯誤",snackbarProps:{color:"red"}})}});Be(y,()=>{P(!0)});const Xe=async K=>{var p,X;try{await F.delete(`/landmark/${K._id}`),_({text:"刪除成功",snackbarProps:{color:"green"}}),P(!0)}catch(Y){console.log(Y),_({text:((X=(p=Y==null?void 0:Y.response)==null?void 0:p.data)==null?void 0:X.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return(K,p)=>{const X=Pe,Y=Pe,le=Ee,ne=ot;return h(),B(G,null,[n("div",va,[fa,e(ke,{"items-per-page":C.value,"onUpdate:itemsPerPage":[p[3]||(p[3]=d=>C.value=d),p[6]||(p[6]=d=>P(!1))],"sort-by":z.value,"onUpdate:sortBy":[p[4]||(p[4]=d=>z.value=d),p[7]||(p[7]=d=>P(!1))],page:T.value,"onUpdate:page":[p[5]||(p[5]=d=>T.value=d),p[8]||(p[8]=d=>P(!1))],items:m.value,headers:b,loading:c.value,"items-length":g.value,search:y.value,hover:"",class:"mx-auto mb-15 px-8 text-body-1 rounded-lg"},{top:t(()=>[e(X,{class:"my-5",modelValue:y.value,"onUpdate:modelValue":p[0]||(p[0]=d=>y.value=d),onClickAppend:p[1]||(p[1]=d=>P(!0)),onKeydown:p[2]||(p[2]=_e(d=>P(!0),["enter"])),"max-width":"100%"},null,8,["modelValue"])]),"item.name":t(({item:d})=>[n("td",ba,U(d.name),1)]),"item.tel":t(({item:d})=>[n("td",ya,U(d.tel),1)]),"item.address":t(({item:d})=>[n("td",xa,U(d.address),1)]),"item.categories":t(({item:d})=>[n("td",_a,U(d.categories.join(" , ")),1)]),"item.description":t(({item:d})=>[n("td",Va,U(d.description),1)]),"item.action":t(({item:d})=>[n("td",ka,[L(U(d.action)+" ",1),e(ee,{icon:"mdi-pencil",variant:"text",color:"grey-darken-2",onClick:et=>ae(d)},null,8,["onClick"]),e(ee,{icon:"mdi-delete",variant:"text",color:"red-darken-4",onClick:et=>Xe(d)},null,8,["onClick"])])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),e(De,{"max-width":"700",modelValue:N.value.open,"onUpdate:modelValue":p[20]||(p[20]=d=>N.value.open=d)},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ye,{color:"secondary",prominent:"",class:"bb-1",height:"55"},{default:t(()=>[e(Ze,{class:"mt-3 text-center"},{default:t(()=>[L(" 修改地標 ")]),_:1})]),_:1}),n("div",ha,[e(qe,{onSubmit:Ue(s(Je),["prevent"]),disabled:s(H)},{default:t(()=>[e(O,{class:"my-1"},{default:t(()=>[e(o,{cols:"12",md:"3",class:"my-auto text-center ps-6"},{default:t(()=>[wa]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(Y,{modelValue:s(i),"onUpdate:modelValue":p[9]||(p[9]=d=>Le(i)?i.value=d:null),"error-messages":s(x),label:"輸入資源地址","max-width":"1000px"},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-center ps-6"},{default:t(()=>[$a]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(le,{modelValue:s(M).value.value,"onUpdate:modelValue":p[10]||(p[10]=d=>s(M).value.value=d),"error-messages":s(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-center ps-6"},{default:t(()=>[Pa]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(le,{modelValue:s(W).value.value,"onUpdate:modelValue":p[11]||(p[11]=d=>s(W).value.value=d),"error-messages":s(W).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"mt-2 text-center ps-6"},{default:t(()=>[Ua]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(nt,{variant:"accordion"},{default:t(()=>[e(rt,{title:"選擇類別"},{default:t(()=>[e(dt,null,{default:t(()=>[e(he,null,{default:t(()=>[e(O,null,{default:t(()=>[e(o,null,{default:t(()=>[Sa,n("div",null,[e(fe,{modelValue:s(Z).value.value,"onUpdate:modelValue":p[12]||(p[12]=d=>s(Z).value.value=d),"error-messages":s(Z).errorMessage.value,column:"",multiple:""},{default:t(()=>[(h(),B(G,null,te(Q,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(o,null,{default:t(()=>[Ca,n("div",null,[e(fe,{modelValue:s(J).value.value,"onUpdate:modelValue":p[13]||(p[13]=d=>s(J).value.value=d),"error-messages":s(J).errorMessage.value,column:"",multiple:""},{default:t(()=>[(h(),B(G,null,te(S,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(o,null,{default:t(()=>[Ma,n("div",null,[e(fe,{modelValue:s(de).value.value,"onUpdate:modelValue":p[14]||(p[14]=d=>s(de).value.value=d),"error-messages":s(de).errorMessage.value,column:"",multiple:""},{default:t(()=>[(h(),B(G,null,te(w,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(o,null,{default:t(()=>[Ia,n("div",null,[e(fe,{modelValue:s(ue).value.value,"onUpdate:modelValue":p[15]||(p[15]=d=>s(ue).value.value=d),"error-messages":s(ue).errorMessage.value,column:"",multiple:""},{default:t(()=>[(h(),B(G,null,te($,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(o,null,{default:t(()=>[qa,n("div",null,[e(fe,{modelValue:s(u).value.value,"onUpdate:modelValue":p[16]||(p[16]=d=>s(u).value.value=d),"error-messages":s(u).errorMessage.value,column:"",multiple:""},{default:t(()=>[(h(),B(G,null,te(D,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(o,null,{default:t(()=>[za,n("div",null,[e(fe,{modelValue:s(V).value.value,"onUpdate:modelValue":p[17]||(p[17]=d=>s(V).value.value=d),"error-messages":s(V).errorMessage.value,column:"",multiple:""},{default:t(()=>[(h(),B(G,null,te(q,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(o,null,{default:t(()=>[Ta,e(fe,{modelValue:s(a).value.value,"onUpdate:modelValue":p[18]||(p[18]=d=>s(a).value.value=d),"error-messages":s(a).errorMessage.value,column:"",multiple:""},{default:t(()=>[e(be,{value:"其他",text:"其他",filter:"",density:"compact"})]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(o,{cols:"12",md:"3",class:"text-center ps-6"},{default:t(()=>[Aa]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(Qe,{style:{"white-space":"pre-line"},variant:"outlined",clearable:"",modelValue:s(v).value.value,"onUpdate:modelValue":p[19]||(p[19]=d=>s(v).value.value=d),"error-messages":s(v).errorMessage.value,"hide-details":""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(o,{class:"text-center"},{default:t(()=>[e(ne,{text:"修改",type:"submit",class:"b-1 bg-accent mb-8",onClick:He})]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])])]),_:1})]),_:1},8,["modelValue"])],64)}}},Fa=k=>(Se("data-v-f2d6197b"),k=k(),Ce(),k),Da={class:"d-flex flex-row"},Ea={class:"mx-auto mb-5 rounded-lg"},La={class:"mx-auto mb-5 rounded-lg"},Ra={class:"mx-auto mb-5 rounded-lg"},ja=Fa(()=>n("h1",null,"暫無任何活動收藏",-1)),Ka={class:"mx-auto mb-5 rounded-lg"},Ha={__name:"setting",setup(k){const{api:ce,apiAuth:F}=ge(),_=pe();r(null),r([]),r([]);const Q=r([{title:"會員中心",disabled:!1,href:"/setting"},{title:"地標管理",disabled:!0}]),S=r([{title:"會員中心",disabled:!1,href:"/setting"},{title:"貼文管理",disabled:!0}]),w=r([{title:"會員中心",disabled:!1,href:"/setting"},{title:"活動收藏",disabled:!0}]),$=r([{title:"會員中心",disabled:!1,href:"/setting"},{title:"物資管理",disabled:!0}]),D=r("option-1"),q=r("true"),C=r([]),z=async()=>{try{const{data:m}=await F.get("/user/mark");C.value=m.map(b=>({...b,isFavorite:!0}))}catch(m){console.error("Failed to fetch favorite event details:",m)}},T=async m=>{try{await F.patch("/user/mark",{eventId:m}),C.value=C.value.filter(b=>b._id!==m),_({text:"取消收藏",snackbarProps:{color:"info"}})}catch(b){console.error("取消收藏失败",b),_({text:"取消收藏失败",snackbarProps:{color:"red"}})}};return lt(()=>{z()}),(m,b)=>{const c=re("router-link");return h(),B(G,null,[e(ut,{class:"b-1 text-center",width:"250"},{default:t(()=>[e(it,{modelValue:D.value,"onUpdate:modelValue":b[0]||(b[0]=g=>D.value=g),color:"teal-darken-4",direction:"vertical","show-arrows":""},{default:t(()=>[e(we,{"prepend-icon":"mdi-account",text:"基本資料",value:"option-1",height:"100",class:"text-body-1 ms-1"}),e(we,{"prepend-icon":"mdi-lock",text:"地標管理",value:"option-2",height:"100",class:"text-body-1 ms-1"}),e(we,{"prepend-icon":"mdi-access-point",text:"貼文管理",value:"option-3",height:"100",class:"text-body-1 ms-1"}),e(we,{"prepend-icon":"mdi-book-cog",text:"活動收藏",value:"option-4",height:"100",class:"text-body-1 ms-1"}),e(we,{"prepend-icon":"mdi-package-variant-closed-check",text:"物資管理",value:"option-5",height:"100",class:"text-body-1 ms-1"})]),_:1},8,["modelValue"])]),_:1}),e(ie,{class:"h-100"},{default:t(()=>[n("div",Da,[e(he,null,{default:t(()=>[e(ct,{modelValue:D.value,"onUpdate:modelValue":b[1]||(b[1]=g=>D.value=g),class:"my-10"},{default:t(()=>[e($e,{value:"option-1"},{default:t(()=>[e(sa)]),_:1}),e($e,{value:"option-2"},{default:t(()=>[e(Ae,{items:Q.value},{divider:t(()=>[e(Te,{icon:"mdi-chevron-right"})]),_:1},8,["items"]),e(Ba)]),_:1}),e($e,{value:"option-3"},{default:t(()=>[e(Ae,{items:S.value},{divider:t(()=>[e(Te,{icon:"mdi-chevron-right"})]),_:1},8,["items"]),n("div",Ea,[e(Qt)]),n("div",La,[e(Dt)]),n("div",Ra,[e(Ut)])]),_:1}),e($e,{value:"option-4"},{default:t(()=>[e(Ae,{items:w.value},{divider:t(()=>[e(Te,{icon:"mdi-chevron-right"})]),_:1},8,["items"]),(h(!0),B(G,null,te(C.value,g=>(h(),B("div",{class:"w-66 mx-auto rounded-lg my-5",style:{border:"1.2px solid #000"},key:g._id},[e(ie,{variant:"flat",class:"rounded-lg",style:{"background-color":"#f7f2e9"}},{default:t(()=>[e(O,{class:"align-center my-4 ps-8"},{default:t(()=>[e(o,{cols:"3",class:"align-self-start"},{default:t(()=>[e(c,{to:"/event/"+g._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ye,{src:g.image,class:"b-1 rounded-lg",width:"200px",height:"220px",cover:""},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024),e(o,{cols:"7",class:"align-self-start"},{default:t(()=>[e(Ve,{class:"text-h6 font-weight-black"},{default:t(()=>[L(U(g.title),1)]),_:2},1024),e(We,{class:"text-body-1 font-weight-bold"},{default:t(()=>[L(U(g.organizer),1)]),_:2},1024),e(We,{class:"text-body-1 font-weight-bold mt-2"},{default:t(()=>[L(U(g.date),1)]),_:2},1024)]),_:2},1024),e(o,{cols:"2",class:"align-self-start mt-2"},{default:t(()=>[q.value?(h(),me(ee,{key:0,id:"btn",text:"取消收藏","prepend-icon":"mdi-bookmark",variant:"outlined",style:{"background-color":"#F5B4B4"},onClick:y=>T(g._id),class:"font-weight-black",width:"120",height:"35"},null,8,["onClick"])):Ne("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),C.value.length==0?(h(),me(O,{key:0},{default:t(()=>[e(o,{class:"text-center mt-15",style:{color:"#bfbfbf"}},{default:t(()=>[ja]),_:1})]),_:1})):Ne("",!0)]),_:1}),e($e,{value:"option-5"},{default:t(()=>[e(Ae,{items:$.value},{divider:t(()=>[e(Te,{icon:"mdi-chevron-right"})]),_:1},8,["items"]),n("div",Ka,[e(ua),e(ga)])]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})],64)}}},ml=ze(Ha,[["__scopeId","data-v-f2d6197b"]]);export{ml as default};
