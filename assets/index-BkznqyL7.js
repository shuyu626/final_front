import{_ as $}from"./search-CIctQe9t.js";import{i as q,n as M,O as F,P as N,o as x,e as V,w as C,l as I,p as Q,c as E,a as O,b as y,F as Z,Q as W,V as Y,R as J,m as X,t as G,B as K}from"./index-BiURfRMU.js";import{l as w,V as tt,a as et,b as it,c as st}from"./leaflet-src-APpH5z9G.js";import{c as nt}from"./_commonjsHelpers-Cpj98o6Y.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ot}from"./VContainer-Bnc02L_J.js";import{V as rt,a as T}from"./VRow-C924zwMG.js";import{V as A,a as U}from"./VToolbar-BziIFeyX.js";import{V as z}from"./VSelect-Dnp6aSDq.js";import{V as at}from"./VCheckbox-CU7H-gri.js";import"./VMenu-D-jX5neX.js";import"./ssrBoot-D0sBaQ3-.js";var lt={exports:{}};/*!
Copyright (c) 2016 Dominik Moritz

This file is part of the leaflet locate control. It is licensed under the MIT license.
You can find the project at: https://github.com/domoritz/leaflet-locatecontrol
*/(function(S,b){(function(_,p){typeof p<"u"&&p.L?S.exports=_(L):S.exports=_(w),typeof p<"u"&&p.L&&(p.L.Control.Locate=_(L))})(function(_){const p=(i,r,o)=>{o=o.split(" "),o.forEach(function(a){_.DomUtil[i].call(this,r,a)})},v=(i,r)=>p("addClass",i,r),t=(i,r)=>p("removeClass",i,r),e=_.Marker.extend({initialize(i,r){_.Util.setOptions(this,r),this._latlng=i,this.createIcon()},createIcon(){const i=this.options;let r="";i.color!==void 0&&(r+=`stroke:${i.color};`),i.weight!==void 0&&(r+=`stroke-width:${i.weight};`),i.fillColor!==void 0&&(r+=`fill:${i.fillColor};`),i.fillOpacity!==void 0&&(r+=`fill-opacity:${i.fillOpacity};`),i.opacity!==void 0&&(r+=`opacity:${i.opacity};`);const o=this._getIconSVG(i,r);this._locationIcon=_.divIcon({className:o.className,html:o.svg,iconSize:[o.w,o.h]}),this.setIcon(this._locationIcon)},_getIconSVG(i,r){const o=i.radius,a=i.weight,l=o+a,h=l*2;return{className:"leaflet-control-locate-location",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="${h}" height="${h}" version="1.1" viewBox="-${l} -${l} ${h} ${h}"><circle r="`+o+'" style="'+r+'" /></svg>',w:h,h}},setStyle(i){_.Util.setOptions(this,i),this.createIcon()}}),s=e.extend({initialize(i,r,o){_.Util.setOptions(this,o),this._latlng=i,this._heading=r,this.createIcon()},setHeading(i){this._heading=i},_getIconSVG(i,r){const o=i.radius,a=i.width+i.weight,l=(o+i.depth+i.weight)*2,h=`M0,0 l${i.width/2},${i.depth} l-${a},0 z`,u=`transform: rotate(${this._heading}deg)`;return{className:"leaflet-control-locate-heading",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="${a}" height="${l}" version="1.1" viewBox="-${a/2} 0 ${a} ${l}" style="${u}"><path d="`+h+'" style="'+r+'" /></svg>',w:a,h:l}}}),n=_.Control.extend({options:{position:"topleft",layer:void 0,setView:"untilPanOrZoom",keepCurrentZoomLevel:!1,initialZoomLevel:!1,getLocationBounds(i){return i.bounds},flyTo:!1,clickBehavior:{inView:"stop",outOfView:"setView",inViewNotFollowing:"inView"},returnToPrevBounds:!1,cacheLocation:!0,drawCircle:!0,drawMarker:!0,showCompass:!0,markerClass:e,compassClass:s,circleStyle:{className:"leaflet-control-locate-circle",color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:0},markerStyle:{className:"leaflet-control-locate-marker",color:"#fff",fillColor:"#2A93EE",fillOpacity:1,weight:3,opacity:1,radius:9},compassStyle:{fillColor:"#2A93EE",fillOpacity:1,weight:0,color:"#fff",opacity:1,radius:9,width:9,depth:6},followCircleStyle:{},followMarkerStyle:{},followCompassStyle:{},icon:"leaflet-control-locate-location-arrow",iconLoading:"leaflet-control-locate-spinner",iconElementTag:"span",textElementTag:"small",circlePadding:[0,0],metric:!0,createButtonCallback(i,r){const o=_.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",i);o.title=r.strings.title,o.href="#",o.setAttribute("role","button");const a=_.DomUtil.create(r.iconElementTag,r.icon,o);if(r.strings.text!==void 0){const l=_.DomUtil.create(r.textElementTag,"leaflet-locate-text",o);l.textContent=r.strings.text,o.classList.add("leaflet-locate-text-active"),o.parentNode.style.display="flex",r.icon.length>0&&a.classList.add("leaflet-locate-icon")}return{link:o,icon:a}},onLocationError(i,r){alert(i.message)},onLocationOutsideMapBounds(i){i.stop(),alert(i.options.strings.outsideMapBoundsMsg)},showPopup:!0,strings:{title:"Show me where I am",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:1/0,watch:!0,setView:!1}},initialize(i){for(const r in i)typeof this.options[r]=="object"?_.extend(this.options[r],i[r]):this.options[r]=i[r];this.options.followMarkerStyle=_.extend({},this.options.markerStyle,this.options.followMarkerStyle),this.options.followCircleStyle=_.extend({},this.options.circleStyle,this.options.followCircleStyle),this.options.followCompassStyle=_.extend({},this.options.compassStyle,this.options.followCompassStyle)},onAdd(i){const r=_.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control");this._container=r,this._map=i,this._layer=this.options.layer||new _.LayerGroup,this._layer.addTo(i),this._event=void 0,this._compassHeading=null,this._prevBounds=null;const o=this.options.createButtonCallback(r,this.options);return this._link=o.link,this._icon=o.icon,_.DomEvent.on(this._link,"click",function(a){_.DomEvent.stopPropagation(a),_.DomEvent.preventDefault(a),this._onClick()},this).on(this._link,"dblclick",_.DomEvent.stopPropagation),this._resetVariables(),this._map.on("unload",this._unload,this),r},_onClick(){this._justClicked=!0;const i=this._isFollowing();if(this._userPanned=!1,this._userZoomed=!1,this._active&&!this._event)this.stop();else if(this._active){const r=this.options.clickBehavior;let o=r.outOfView;switch(this._map.getBounds().contains(this._event.latlng)&&(o=i?r.inView:r.inViewNotFollowing),r[o]&&(o=r[o]),o){case"setView":this.setView();break;case"stop":this.stop(),this.options.returnToPrevBounds&&(this.options.flyTo?this._map.flyToBounds:this._map.fitBounds).bind(this._map)(this._prevBounds);break}}else this.options.returnToPrevBounds&&(this._prevBounds=this._map.getBounds()),this.start();this._updateContainerStyle()},start(){this._activate(),this._event&&(this._drawMarker(this._map),this.options.setView&&this.setView()),this._updateContainerStyle()},stop(){this._deactivate(),this._cleanClasses(),this._resetVariables(),this._removeMarker()},stopFollowing(){this._userPanned=!0,this._updateContainerStyle(),this._drawMarker()},_activate(){if(!(this._active||!this._map)&&(this._map.locate(this.options.locateOptions),this._map.fire("locateactivate",this),this._active=!0,this._map.on("locationfound",this._onLocationFound,this),this._map.on("locationerror",this._onLocationError,this),this._map.on("dragstart",this._onDrag,this),this._map.on("zoomstart",this._onZoom,this),this._map.on("zoomend",this._onZoomEnd,this),this.options.showCompass)){const i="ondeviceorientationabsolute"in window;if(i||"ondeviceorientation"in window){const r=this,o=function(){_.DomEvent.on(window,i?"deviceorientationabsolute":"deviceorientation",r._onDeviceOrientation,r)};DeviceOrientationEvent&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(a){a==="granted"&&o()}):o()}}},_deactivate(){!this._active||!this._map||(this._map.stopLocate(),this._map.fire("locatedeactivate",this),this._active=!1,this.options.cacheLocation||(this._event=void 0),this._map.off("locationfound",this._onLocationFound,this),this._map.off("locationerror",this._onLocationError,this),this._map.off("dragstart",this._onDrag,this),this._map.off("zoomstart",this._onZoom,this),this._map.off("zoomend",this._onZoomEnd,this),this.options.showCompass&&(this._compassHeading=null,"ondeviceorientationabsolute"in window?_.DomEvent.off(window,"deviceorientationabsolute",this._onDeviceOrientation,this):"ondeviceorientation"in window&&_.DomEvent.off(window,"deviceorientation",this._onDeviceOrientation,this)))},setView(){if(this._drawMarker(),this._isOutsideMapBounds())this._event=void 0,this.options.onLocationOutsideMapBounds(this);else if(this._justClicked&&this.options.initialZoomLevel!==!1){var i=this.options.flyTo?this._map.flyTo:this._map.setView;i.bind(this._map)([this._event.latitude,this._event.longitude],this.options.initialZoomLevel)}else if(this.options.keepCurrentZoomLevel){var i=this.options.flyTo?this._map.flyTo:this._map.panTo;i.bind(this._map)([this._event.latitude,this._event.longitude])}else{var i=this.options.flyTo?this._map.flyToBounds:this._map.fitBounds;this._ignoreEvent=!0,i.bind(this._map)(this.options.getLocationBounds(this._event),{padding:this.options.circlePadding,maxZoom:this.options.initialZoomLevel||this.options.locateOptions.maxZoom}),_.Util.requestAnimFrame(function(){this._ignoreEvent=!1},this)}},_drawCompass(){if(!this._event)return;const i=this._event.latlng;if(this.options.showCompass&&i&&this._compassHeading!==null){const r=this._isFollowing()?this.options.followCompassStyle:this.options.compassStyle;this._compass?(this._compass.setLatLng(i),this._compass.setHeading(this._compassHeading),this._compass.setStyle&&this._compass.setStyle(r)):this._compass=new this.options.compassClass(i,this._compassHeading,r).addTo(this._layer)}this._compass&&(!this.options.showCompass||this._compassHeading===null)&&(this._compass.removeFrom(this._layer),this._compass=null)},_drawMarker(){this._event.accuracy===void 0&&(this._event.accuracy=0);const i=this._event.accuracy,r=this._event.latlng;if(this.options.drawCircle){const u=this._isFollowing()?this.options.followCircleStyle:this.options.circleStyle;this._circle?this._circle.setLatLng(r).setRadius(i).setStyle(u):this._circle=_.circle(r,i,u).addTo(this._layer)}let o,a;if(this.options.metric?(o=i.toFixed(0),a=this.options.strings.metersUnit):(o=(i*3.2808399).toFixed(0),a=this.options.strings.feetUnit),this.options.drawMarker){const u=this._isFollowing()?this.options.followMarkerStyle:this.options.markerStyle;this._marker?(this._marker.setLatLng(r),this._marker.setStyle&&this._marker.setStyle(u)):this._marker=new this.options.markerClass(r,u).addTo(this._layer)}this._drawCompass();const l=this.options.strings.popup;function h(){return typeof l=="string"?_.Util.template(l,{distance:o,unit:a}):typeof l=="function"?l({distance:o,unit:a}):l}this.options.showPopup&&l&&this._marker&&this._marker.bindPopup(h())._popup.setLatLng(r),this.options.showPopup&&l&&this._compass&&this._compass.bindPopup(h())._popup.setLatLng(r)},_removeMarker(){this._layer.clearLayers(),this._marker=void 0,this._circle=void 0},_unload(){this.stop(),this._map&&this._map.off("unload",this._unload,this)},_setCompassHeading(i){!isNaN(parseFloat(i))&&isFinite(i)?(i=Math.round(i),this._compassHeading=i,_.Util.requestAnimFrame(this._drawCompass,this)):this._compassHeading=null},_onCompassNeedsCalibration(){this._setCompassHeading()},_onDeviceOrientation(i){this._active&&(i.webkitCompassHeading?this._setCompassHeading(i.webkitCompassHeading):i.absolute&&i.alpha&&this._setCompassHeading(360-i.alpha))},_onLocationError(i){i.code==3&&this.options.locateOptions.watch||(this.stop(),this.options.onLocationError(i,this))},_onLocationFound(i){if(!(this._event&&this._event.latlng.lat===i.latlng.lat&&this._event.latlng.lng===i.latlng.lng&&this._event.accuracy===i.accuracy)&&this._active){switch(this._event=i,this._drawMarker(),this._updateContainerStyle(),this.options.setView){case"once":this._justClicked&&this.setView();break;case"untilPan":this._userPanned||this.setView();break;case"untilPanOrZoom":!this._userPanned&&!this._userZoomed&&this.setView();break;case"always":this.setView();break}this._justClicked=!1}},_onDrag(){this._event&&!this._ignoreEvent&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_onZoom(){this._event&&!this._ignoreEvent&&(this._userZoomed=!0,this._updateContainerStyle(),this._drawMarker())},_onZoomEnd(){this._event&&this._drawCompass(),this._event&&!this._ignoreEvent&&this._marker&&!this._map.getBounds().pad(-.3).contains(this._marker.getLatLng())&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_isFollowing(){if(!this._active)return!1;if(this.options.setView==="always")return!0;if(this.options.setView==="untilPan")return!this._userPanned;if(this.options.setView==="untilPanOrZoom")return!this._userPanned&&!this._userZoomed},_isOutsideMapBounds(){return this._event===void 0?!1:this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng)},_updateContainerStyle(){this._container&&(this._active&&!this._event?this._setClasses("requesting"):this._isFollowing()?this._setClasses("following"):this._active?this._setClasses("active"):this._cleanClasses())},_setClasses(i){i=="requesting"?(t(this._container,"active following"),v(this._container,"requesting"),t(this._icon,this.options.icon),v(this._icon,this.options.iconLoading)):i=="active"?(t(this._container,"requesting following"),v(this._container,"active"),t(this._icon,this.options.iconLoading),v(this._icon,this.options.icon)):i=="following"&&(t(this._container,"requesting"),v(this._container,"active following"),t(this._icon,this.options.iconLoading),v(this._icon,this.options.icon))},_cleanClasses(){_.DomUtil.removeClass(this._container,"requesting"),_.DomUtil.removeClass(this._container,"active"),_.DomUtil.removeClass(this._container,"following"),t(this._icon,this.options.iconLoading),v(this._icon,this.options.icon)},_resetVariables(){this._active=!1,this._justClicked=!1,this._userPanned=!1,this._userZoomed=!1}});return _.control.locate=i=>new _.Control.Locate(i),n},window)})(lt);var D={exports:{}};(function(S,b){(function(_,p){p(b)})(nt,function(_){var p=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this.fire("layeradd",{layer:t}),this;if(!this._map)return this._needsClustering.push(t),this.fire("layeradd",{layer:t}),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this.fire("layeradd",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,s=this._zoom;if(t.__parent)for(;e.__parent._zoom>=s;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this.fire("layerremove",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push({layer:t,latlng:t._latlng}),this.fire("layerremove",{layer:t}),this):(this._nonPointGroup.removeLayer(t),this.fire("layerremove",{layer:t}),this)},addLayers:function(t,e){if(!L.Util.isArray(t))return this.addLayer(t);var s=this._featureGroup,n=this._nonPointGroup,i=this.options.chunkedLoading,r=this.options.chunkInterval,o=this.options.chunkProgress,a=t.length,l=0,h=!0,u;if(this._map){var f=new Date().getTime(),c=L.bind(function(){var g=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();l<a;l++){if(i&&l%200===0){var k=new Date().getTime()-g;if(k>r)break}if(u=t[l],u instanceof L.LayerGroup){h&&(t=t.slice(),h=!1),this._extractNonGroupLayers(u,t),a=t.length;continue}if(!u.getLatLng){n.addLayer(u),e||this.fire("layeradd",{layer:u});continue}if(!this.hasLayer(u)&&(this._addLayer(u,this._maxZoom),e||this.fire("layeradd",{layer:u}),u.__parent&&u.__parent.getChildCount()===2)){var m=u.__parent.getAllChildMarkers(),B=m[0]===u?m[1]:m[0];s.removeLayer(B)}}o&&o(l,a,new Date().getTime()-f),l===a?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(c,this.options.chunkDelay)},this);c()}else for(var d=this._needsClustering;l<a;l++){if(u=t[l],u instanceof L.LayerGroup){h&&(t=t.slice(),h=!1),this._extractNonGroupLayers(u,t),a=t.length;continue}if(!u.getLatLng){n.addLayer(u);continue}this.hasLayer(u)||d.push(u)}return this},removeLayers:function(t){var e,s,n=t.length,i=this._featureGroup,r=this._nonPointGroup,o=!0;if(!this._map){for(e=0;e<n;e++){if(s=t[e],s instanceof L.LayerGroup){o&&(t=t.slice(),o=!1),this._extractNonGroupLayers(s,t),n=t.length;continue}this._arraySplice(this._needsClustering,s),r.removeLayer(s),this.hasLayer(s)&&this._needsRemoving.push({layer:s,latlng:s._latlng}),this.fire("layerremove",{layer:s})}return this}if(this._unspiderfy){this._unspiderfy();var a=t.slice(),l=n;for(e=0;e<l;e++){if(s=a[e],s instanceof L.LayerGroup){this._extractNonGroupLayers(s,a),l=a.length;continue}this._unspiderfyLayer(s)}}for(e=0;e<n;e++){if(s=t[e],s instanceof L.LayerGroup){o&&(t=t.slice(),o=!1),this._extractNonGroupLayers(s,t),n=t.length;continue}if(!s.__parent){r.removeLayer(s),this.fire("layerremove",{layer:s});continue}this._removeLayer(s,!0,!0),this.fire("layerremove",{layer:s}),i.hasLayer(s)&&(i.removeLayer(s),s.clusterShow&&s.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){t.off(this._childMarkerEventHandlers,this),delete t.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var s=this._needsClustering.slice(),n=this._needsRemoving,i,r,o;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(s),r=s.length-1;r>=0;r--){for(i=!0,o=n.length-1;o>=0;o--)if(n[o].layer===s[r]){i=!1;break}i&&t.call(e,s[r])}this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer(function(s){L.stamp(s)===t&&(e=s)}),e},hasLayer:function(t){if(!t)return!1;var e,s=this._needsClustering;for(e=s.length-1;e>=0;e--)if(s[e]===t)return!0;for(s=this._needsRemoving,e=s.length-1;e>=0;e--)if(s[e].layer===t)return!1;return!!(t.__parent&&t.__parent._group===this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){var s=this._map;typeof e!="function"&&(e=function(){});var n=function(){(s.hasLayer(t)||s.hasLayer(t.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",n,this),this.off("animationend",n,this),s.hasLayer(t)?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",n,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",n,this),this.on("animationend",n,this),t.__parent.zoomToBounds())},onAdd:function(t){this._map=t;var e,s,n;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,s=this._needsRemoving.length;e<s;e++)n=this._needsRemoving[e],n.newlatlng=n.layer._latlng,n.layer._latlng=n.latlng;for(e=0,s=this._needsRemoving.length;e<s;e++)n=this._needsRemoving[e],this._removeLayer(n.layer,!0),n.layer._latlng=n.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),s=this._needsClustering,this._needsClustering=[],this.addLayers(s,!0)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var s=t.length-1;s>=0;s--)if(t[s]===e)return t.splice(s,1),!0},_removeFromGridUnclustered:function(t,e){for(var s=this._map,n=this._gridUnclustered,i=Math.floor(this._map.getMinZoom());e>=i&&n[e].removeObject(t,s.project(t.getLatLng(),e));e--);},_childMarkerDragStart:function(t){t.target.__dragStart=t.target._latlng},_childMarkerMoved:function(t){if(!this._ignoreMove&&!t.target.__dragStart){var e=t.target._popup&&t.target._popup.isOpen();this._moveChild(t.target,t.oldLatLng,t.latlng),e&&t.target.openPopup()}},_moveChild:function(t,e,s){t._latlng=e,this.removeLayer(t),t._latlng=s,this.addLayer(t)},_childMarkerDragEnd:function(t){var e=t.target.__dragStart;delete t.target.__dragStart,e&&this._moveChild(t.target,e,t.target._latlng)},_removeLayer:function(t,e,s){var n=this._gridClusters,i=this._gridUnclustered,r=this._featureGroup,o=this._map,a=Math.floor(this._map.getMinZoom());e&&this._removeFromGridUnclustered(t,this._maxZoom);var l=t.__parent,h=l._markers,u;for(this._arraySplice(h,t);l&&(l._childCount--,l._boundsNeedUpdate=!0,!(l._zoom<a));)e&&l._childCount<=1?(u=l._markers[0]===t?l._markers[1]:l._markers[0],n[l._zoom].removeObject(l,o.project(l._cLatLng,l._zoom)),i[l._zoom].addObject(u,o.project(u.getLatLng(),l._zoom)),this._arraySplice(l.__parent._childClusters,l),l.__parent._markers.push(u),u.__parent=l.__parent,l._icon&&(r.removeLayer(l),s||r.addLayer(u))):l._iconNeedsUpdate=!0,l=l.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,s){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,s)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),s=" marker-cluster-";return e<10?s+="small":e<100?s+="medium":s+="large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+s,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,s=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick,i=this.options.spiderfyOnEveryZoom;(e||n||i)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),s&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){var e=t.layer,s=e;if(!(t.type==="clusterkeypress"&&t.originalEvent&&t.originalEvent.keyCode!==13)){for(;s._childClusters.length===1;)s=s._childClusters[0];s._zoom===this._maxZoom&&s._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),this.options.spiderfyOnEveryZoom&&e.spiderfy(),t.originalEvent&&t.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,s=this.options.zoomToBoundsOnClick,n=this.options.spiderfyOnEveryZoom,i=this._map;(t||s||n)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),i.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=Math.ceil(this._map.getMaxZoom()),e=Math.floor(this._map.getMinZoom()),s=this.options.maxClusterRadius,n=s;typeof s!="function"&&(n=function(){return s}),this.options.disableClusteringAtZoom!==null&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var i=t;i>=e;i--)this._gridClusters[i]=new L.DistanceGrid(n(i)),this._gridUnclustered[i]=new L.DistanceGrid(n(i));this._topClusterLevel=new this._markerCluster(this,e-1)},_addLayer:function(t,e){var s=this._gridClusters,n=this._gridUnclustered,i=Math.floor(this._map.getMinZoom()),r,o;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on(this._childMarkerEventHandlers,this);e>=i;e--){r=this._map.project(t.getLatLng(),e);var a=s[e].getNearObject(r);if(a){a._addChild(t),t.__parent=a;return}if(a=n[e].getNearObject(r),a){var l=a.__parent;l&&this._removeLayer(a,!1);var h=new this._markerCluster(this,e,a,t);s[e].addObject(h,this._map.project(h._cLatLng,e)),a.__parent=h,t.__parent=h;var u=h;for(o=e-1;o>l._zoom;o--)u=new this._markerCluster(this,o,u),s[o].addObject(u,this._map.project(a.getLatLng(),o));l._addChild(u),this._removeFromGridUnclustered(a,e);return}n[e].addObject(t,r)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()})},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(t){var e=this._maxLat;return e!==void 0&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-1/0)),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(e._childCount===2){e._addToMap();var s=e.getAllChildMarkers();this._featureGroup.removeLayer(s[0]),this._featureGroup.removeLayer(s[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var s=t.getLayers(),n=0,i;for(e=e||[];n<s.length;n++){if(i=s[n],i instanceof L.LayerGroup){this._extractNonGroupLayers(i,e);continue}e.push(i)}return e},_overrideMarkerIcon:function(t){var e=t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}});return e}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var s=this._getExpandedVisibleBounds(),n=this._featureGroup,i=Math.floor(this._map.getMinZoom()),r;this._ignoreMove=!0,this._topClusterLevel._recursively(s,t,i,function(o){var a=o._latlng,l=o._markers,h;for(s.contains(a)||(a=null),o._isSingleParent()&&t+1===e?(n.removeLayer(o),o._recursivelyAddChildrenToMap(null,e,s)):(o.clusterHide(),o._recursivelyAddChildrenToMap(a,e,s)),r=l.length-1;r>=0;r--)h=l[r],s.contains(h._latlng)||n.removeLayer(h)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(s,e),n.eachLayer(function(o){!(o instanceof L.MarkerCluster)&&o._icon&&o.clusterShow()}),this._topClusterLevel._recursively(s,t,e,function(o){o._recursivelyRestoreChildPositions(e)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(s,t,i,function(o){n.removeLayer(o),o.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var s=this,n=this._featureGroup;n.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue(function(){n.removeLayer(t),t.clusterShow(),s._animationEnd()})):(this._forceLayout(),s._animationStart(),s._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,s){var n=this._getExpandedVisibleBounds(),i=Math.floor(this._map.getMinZoom());t._recursivelyAnimateChildrenInAndAddSelfToMap(n,i,e+1,s);var r=this;this._forceLayout(),t._recursivelyBecomeVisible(n,s),this._enqueue(function(){if(t._childCount===1){var o=t._markers[0];this._ignoreMove=!0,o.setLatLng(o.getLatLng()),this._ignoreMove=!1,o.clusterShow&&o.clusterShow()}else t._recursively(n,s,i,function(a){a._recursivelyRemoveChildrenFromMap(n,i,e+1)});r._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)};var v=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(t,e,s,n){L.Marker.prototype.initialize.call(this,s?s._cLatLng||s.getLatLng():new L.LatLng(0,0),{icon:this,pane:t.options.clusterPane}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,s&&this._addChild(s),n&&this._addChild(n)},getAllChildMarkers:function(t,e){t=t||[];for(var s=this._childClusters.length-1;s>=0;s--)this._childClusters[s].getAllChildMarkers(t,e);for(var n=this._markers.length-1;n>=0;n--)e&&this._markers[n].__dragStart||t.push(this._markers[n]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(t){for(var e=this._childClusters.slice(),s=this._group._map,n=s.getBoundsZoom(this._bounds),i=this._zoom+1,r=s.getZoom(),o;e.length>0&&n>i;){i++;var a=[];for(o=0;o<e.length;o++)a=a.concat(e[o]._childClusters);e=a}n>i?this._group._map.setView(this._latlng,i):n<=r?this._group._map.setView(this._latlng,r+1):this._group._map.fitBounds(this._bounds,t)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-1/0,t._northEast.lng=-1/0)},_recalculateBounds:function(){var t=this._markers,e=this._childClusters,s=0,n=0,i=this._childCount,r,o,a,l;if(i!==0){for(this._resetBounds(),r=0;r<t.length;r++)a=t[r]._latlng,this._bounds.extend(a),s+=a.lat,n+=a.lng;for(r=0;r<e.length;r++)o=e[r],o._boundsNeedUpdate&&o._recalculateBounds(),this._bounds.extend(o._bounds),a=o._wLatLng,l=o._childCount,s+=a.lat*l,n+=a.lng*l;this._latlng=this._wLatLng=new L.LatLng(s/i,n/i),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,s){this._recursively(t,this._group._map.getMinZoom(),s-1,function(n){var i=n._markers,r,o;for(r=i.length-1;r>=0;r--)o=i[r],o._icon&&(o._setPos(e),o.clusterHide())},function(n){var i=n._childClusters,r,o;for(r=i.length-1;r>=0;r--)o=i[r],o._icon&&(o._setPos(e),o.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,s,n){this._recursively(t,n,e,function(i){i._recursivelyAnimateChildrenIn(t,i._group._map.latLngToLayerPoint(i.getLatLng()).round(),s),i._isSingleParent()&&s-1===n?(i.clusterShow(),i._recursivelyRemoveChildrenFromMap(t,e,s)):i.clusterHide(),i._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,this._group._map.getMinZoom(),e,null,function(s){s.clusterShow()})},_recursivelyAddChildrenToMap:function(t,e,s){this._recursively(s,this._group._map.getMinZoom()-1,e,function(n){if(e!==n._zoom)for(var i=n._markers.length-1;i>=0;i--){var r=n._markers[i];s.contains(r._latlng)&&(t&&(r._backupLatlng=r.getLatLng(),r.setLatLng(t),r.clusterHide&&r.clusterHide()),n._group._featureGroup.addLayer(r))}},function(n){n._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var s=this._markers[e];s._backupLatlng&&(s.setLatLng(s._backupLatlng),delete s._backupLatlng)}if(t-1===this._zoom)for(var n=this._childClusters.length-1;n>=0;n--)this._childClusters[n]._restorePosition();else for(var i=this._childClusters.length-1;i>=0;i--)this._childClusters[i]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,s,n){var i,r;this._recursively(t,e-1,s-1,function(o){for(r=o._markers.length-1;r>=0;r--)i=o._markers[r],(!n||!n.contains(i._latlng))&&(o._group._featureGroup.removeLayer(i),i.clusterShow&&i.clusterShow())},function(o){for(r=o._childClusters.length-1;r>=0;r--)i=o._childClusters[r],(!n||!n.contains(i._latlng))&&(o._group._featureGroup.removeLayer(i),i.clusterShow&&i.clusterShow())})},_recursively:function(t,e,s,n,i){var r=this._childClusters,o=this._zoom,a,l;if(e<=o&&(n&&n(this),i&&o===s&&i(this)),o<e||o<s)for(a=r.length-1;a>=0;a--)l=r[a],l._boundsNeedUpdate&&l._recalculateBounds(),t.intersects(l._bounds)&&l._recursively(t,e,s,n,i)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var t=this.options.opacity;return this.setOpacity(0),this.options.opacity=t,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var s=this._getCoord(e.x),n=this._getCoord(e.y),i=this._grid,r=i[n]=i[n]||{},o=r[s]=r[s]||[],a=L.Util.stamp(t);this._objectPoint[a]=e,o.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var s=this._getCoord(e.x),n=this._getCoord(e.y),i=this._grid,r=i[n]=i[n]||{},o=r[s]=r[s]||[],a,l;for(delete this._objectPoint[L.Util.stamp(t)],a=0,l=o.length;a<l;a++)if(o[a]===t)return o.splice(a,1),l===1&&delete r[s],!0},eachObject:function(t,e){var s,n,i,r,o,a,l,h=this._grid;for(s in h){o=h[s];for(n in o)for(a=o[n],i=0,r=a.length;i<r;i++)l=t.call(e,a[i]),l&&(i--,r--)}},getNearObject:function(t){var e=this._getCoord(t.x),s=this._getCoord(t.y),n,i,r,o,a,l,h,u,f=this._objectPoint,c=this._sqCellSize,d=null;for(n=s-1;n<=s+1;n++)if(o=this._grid[n],o){for(i=e-1;i<=e+1;i++)if(a=o[i],a)for(r=0,l=a.length;r<l;r++)h=a[r],u=this._sqDist(f[L.Util.stamp(h)],t),(u<c||u<=c&&d===null)&&(c=u,d=h)}return d},_getCoord:function(t){var e=Math.floor(t/this._cellSize);return isFinite(e)?e:t},_sqDist:function(t,e){var s=e.x-t.x,n=e.y-t.y;return s*s+n*n}},function(){L.QuickHull={getDistant:function(t,e){var s=e[1].lat-e[0].lat,n=e[0].lng-e[1].lng;return n*(t.lat-e[0].lat)+s*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var s=0,n=null,i=[],r,o,a;for(r=e.length-1;r>=0;r--){if(o=e[r],a=this.getDistant(o,t),a>0)i.push(o);else continue;a>s&&(s=a,n=o)}return{maxPoint:n,newPoints:i}},buildConvexHull:function(t,e){var s=[],n=this.findMostDistantPointFromBaseLine(t,e);return n.maxPoint?(s=s.concat(this.buildConvexHull([t[0],n.maxPoint],n.newPoints)),s=s.concat(this.buildConvexHull([n.maxPoint,t[1]],n.newPoints)),s):[t[0]]},getConvexHull:function(t){var e=!1,s=!1,n=!1,i=!1,r=null,o=null,a=null,l=null,h=null,u=null,f;for(f=t.length-1;f>=0;f--){var c=t[f];(e===!1||c.lat>e)&&(r=c,e=c.lat),(s===!1||c.lat<s)&&(o=c,s=c.lat),(n===!1||c.lng>n)&&(a=c,n=c.lng),(i===!1||c.lng<i)&&(l=c,i=c.lng)}s!==e?(u=o,h=r):(u=l,h=a);var d=[].concat(this.buildConvexHull([u,h],t),this.buildConvexHull([h,u],t));return d}}}(),L.MarkerCluster.include({getConvexHull:function(){var t=this.getAllChildMarkers(),e=[],s,n;for(n=t.length-1;n>=0;n--)s=t[n].getLatLng(),e.push(s);return L.QuickHull.getConvexHull(e)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var t=this.getAllChildMarkers(null,!0),e=this._group,s=e._map,n=s.latLngToLayerPoint(this._latlng),i;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?i=this._group.options.spiderfyShapePositions(t.length,n):t.length>=this._circleSpiralSwitchover?i=this._generatePointsSpiral(t.length,n):(n.y+=10,i=this._generatePointsCircle(t.length,n)),this._animationSpiderfy(t,i)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var s=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),n=s/this._2PI,i=this._2PI/t,r=[],o,a;for(n=Math.max(n,35),r.length=t,o=0;o<t;o++)a=this._circleStartAngle+o*i,r[o]=new L.Point(e.x+n*Math.cos(a),e.y+n*Math.sin(a))._round();return r},_generatePointsSpiral:function(t,e){var s=this._group.options.spiderfyDistanceMultiplier,n=s*this._spiralLengthStart,i=s*this._spiralFootSeparation,r=s*this._spiralLengthFactor*this._2PI,o=0,a=[],l;for(a.length=t,l=t;l>=0;l--)l<t&&(a[l]=new L.Point(e.x+n*Math.cos(o),e.y+n*Math.sin(o))._round()),o+=i/n+l*5e-4,n+=r/o;return a},_noanimationUnspiderfy:function(){var t=this._group,e=t._map,s=t._featureGroup,n=this.getAllChildMarkers(null,!0),i,r;for(t._ignoreMove=!0,this.setOpacity(1),r=n.length-1;r>=0;r--)i=n[r],s.removeLayer(i),i._preSpiderfyLatlng&&(i.setLatLng(i._preSpiderfyLatlng),delete i._preSpiderfyLatlng),i.setZIndexOffset&&i.setZIndexOffset(0),i._spiderLeg&&(e.removeLayer(i._spiderLeg),delete i._spiderLeg);t.fire("unspiderfied",{cluster:this,markers:n}),t._ignoreMove=!1,t._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var s=this._group,n=s._map,i=s._featureGroup,r=this._group.options.spiderLegPolylineOptions,o,a,l,h;for(s._ignoreMove=!0,o=0;o<t.length;o++)h=n.layerPointToLatLng(e[o]),a=t[o],l=new L.Polyline([this._latlng,h],r),n.addLayer(l),a._spiderLeg=l,a._preSpiderfyLatlng=a._latlng,a.setLatLng(h),a.setZIndexOffset&&a.setZIndexOffset(1e6),i.addLayer(a);this.setOpacity(.3),s._ignoreMove=!1,s.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var s=this,n=this._group,i=n._map,r=n._featureGroup,o=this._latlng,a=i.latLngToLayerPoint(o),l=L.Path.SVG,h=L.extend({},this._group.options.spiderLegPolylineOptions),u=h.opacity,f,c,d,g,k,m;for(u===void 0&&(u=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),l?(h.opacity=0,h.className=(h.className||"")+" leaflet-cluster-spider-leg"):h.opacity=u,n._ignoreMove=!0,f=0;f<t.length;f++)c=t[f],m=i.layerPointToLatLng(e[f]),d=new L.Polyline([o,m],h),i.addLayer(d),c._spiderLeg=d,l&&(g=d._path,k=g.getTotalLength()+.1,g.style.strokeDasharray=k,g.style.strokeDashoffset=k),c.setZIndexOffset&&c.setZIndexOffset(1e6),c.clusterHide&&c.clusterHide(),r.addLayer(c),c._setPos&&c._setPos(a);for(n._forceLayout(),n._animationStart(),f=t.length-1;f>=0;f--)m=i.layerPointToLatLng(e[f]),c=t[f],c._preSpiderfyLatlng=c._latlng,c.setLatLng(m),c.clusterShow&&c.clusterShow(),l&&(d=c._spiderLeg,g=d._path,g.style.strokeDashoffset=0,d.setStyle({opacity:u}));this.setOpacity(.3),n._ignoreMove=!1,setTimeout(function(){n._animationEnd(),n.fire("spiderfied",{cluster:s,markers:t})},200)},_animationUnspiderfy:function(t){var e=this,s=this._group,n=s._map,i=s._featureGroup,r=t?n._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):n.latLngToLayerPoint(this._latlng),o=this.getAllChildMarkers(null,!0),a=L.Path.SVG,l,h,u,f,c,d;for(s._ignoreMove=!0,s._animationStart(),this.setOpacity(1),h=o.length-1;h>=0;h--)l=o[h],l._preSpiderfyLatlng&&(l.closePopup(),l.setLatLng(l._preSpiderfyLatlng),delete l._preSpiderfyLatlng,d=!0,l._setPos&&(l._setPos(r),d=!1),l.clusterHide&&(l.clusterHide(),d=!1),d&&i.removeLayer(l),a&&(u=l._spiderLeg,f=u._path,c=f.getTotalLength()+.1,f.style.strokeDashoffset=c,u.setStyle({opacity:0})));s._ignoreMove=!1,setTimeout(function(){var g=0;for(h=o.length-1;h>=0;h--)l=o[h],l._spiderLeg&&g++;for(h=o.length-1;h>=0;h--)l=o[h],l._spiderLeg&&(l.clusterShow&&l.clusterShow(),l.setZIndexOffset&&l.setZIndexOffset(0),g>1&&i.removeLayer(l),n.removeLayer(l._spiderLeg),delete l._spiderLeg);s._animationEnd(),s.fire("unspiderfied",{cluster:e,markers:o})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(t){return t?t instanceof L.MarkerClusterGroup?t=t._topClusterLevel.getAllChildMarkers():t instanceof L.LayerGroup?t=t._layers:t instanceof L.MarkerCluster?t=t.getAllChildMarkers():t instanceof L.Marker&&(t=[t]):t=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(t),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(t),this},_flagParentsIconsNeedUpdate:function(t){var e,s;for(e in t)for(s=t[e].__parent;s;)s._iconNeedsUpdate=!0,s=s.__parent},_refreshSingleMarkerModeMarkers:function(t){var e,s;for(e in t)s=t[e],this.hasLayer(s)&&s.setIcon(this._overrideMarkerIcon(s))}}),L.Marker.include({refreshIconOptions:function(t,e){var s=this.options.icon;return L.setOptions(s,t),this.setIcon(s),e&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),_.MarkerClusterGroup=p,_.MarkerCluster=v,Object.defineProperty(_,"__esModule",{value:!0})})})(D,D.exports);const ht={id:"map",ref:"map"},ut={__name:"leafletMap",props:{searchQuery:{type:String,default:""},selectedCity:{type:String,default:null},selectedArea:{type:String,default:null},selectedSubcategories:{type:Array,default:()=>[]},selectedclient:{type:String,default:null}},setup(S){const b=q(),_=M(null),p=M([]),v=M([]),{api:t}=Q(),e=S,s=()=>{_.value=w.map("map").setView([25.049183268037577,121.51342818384893],12),_.value?(w.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(_.value),_.value.eachLayer(o=>{o instanceof w.Control.Locate&&_.value.removeControl(o)}),w.control.locate({position:"topleft",drawCircle:!0,drawMarker:!0,markerStyle:{color:"black",opacity:.8,weight:.8},locateOptions:{enableHighAccuracy:!0,maxZoom:16},icon:"fa fa-solid fa-crosshairs",onLocationError:function(o){console.error(o.message),b({text:o.message,snackbarProps:{color:"red"}})}}).addTo(_.value)):console.error("Map initialization failed.")},n=async()=>{var o,a;try{const{data:l}=await t.get("/landmark");console.log(l),v.value=l.result.data,r(),console.log(v.value)}catch(l){console.error("Error fetching data:",l),b({text:((a=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red"}})}},i={服務對象:w.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/2377/2377871.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),長期照顧:w.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/12264/12264430.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),身心障礙:w.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/17573/17573294.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),兒童及少年:w.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5759/5759522.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),心理衛生:w.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/4010/4010654.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),婦女:w.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/7457/7457069.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),社會救助:w.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/784/784791.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),綜合:w.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5153/5153858.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),其他:w.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5672/5672993.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]})},r=()=>{if(!_.value)return;p.value.forEach(a=>_.value.removeLayer(a)),p.value=[],v.value.filter(a=>{const l=!e.selectedCity||a.address.includes(e.selectedCity),h=!e.selectedArea||a.address.includes(e.selectedArea),u=!e.searchQuery||a.name.toLowerCase().includes(e.searchQuery.toLowerCase())||a.address.toLowerCase().includes(e.searchQuery.toLowerCase()),f=e.selectedSubcategories.length===0||a.categories.some(c=>e.selectedSubcategories.includes(c));return l&&h&&f&&u}).forEach(a=>{const l=parseFloat(a.lat),h=parseFloat(a.lng),u=a.cl,f=i[u]||i.綜合;if(isFinite(l)&&isFinite(h)){const c=w.marker([l,h],{icon:f}).addTo(_.value).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;color:#1b3f63;">${a.name}</h2>
        <h3 style="margin: 2px 0 2px 0;color:gray;">地址：${a.address}</h3>
        <h3 style="margin: 2px 0 2px 0;color:gray;">電話：${a.tel}</h3>
        <span style="font-size: 1.17em;font-weight: bold;color:gray;">類別：</span><span style="font-size: 1.17em;font-weight: bold;margin: 2px 0 2px 0;color:#7b97a6;">${a.categories.join(" | ")}</span>
        <div><span style="font-size: 1.17em;font-weight: bold;color:gray;">簡介：</span><h4 style="margin: 2px 0 2px 0;color:gray;white-space: pre-line;">${a.description}</h4></div>`);p.value.push(c)}else console.warn(`Invalid coordinates for item: ${JSON.stringify(a)}`)})};return F(()=>[e.searchQuery,e.selectedCity,e.selectedArea,e.selectedSubcategories,e.selectedclient],r),N(async()=>{s(),await n()}),(o,a)=>(x(),V(ot,null,{default:C(()=>[I("div",ht,null,512)]),_:1}))}},ct=H(ut,[["__scopeId","data-v-562f5b75"]]),_t={class:"text-right"},dt={__name:"index",setup(S,{emit:b}){const _=M([{name:"服務對象",subcategories:["長期照顧","身心障礙","婦女","兒童及少年","心理衛生","社會救助","綜合","其他"]},{name:"長期照顧",subcategories:["日照中心","護理之家","居家服務","交通接送","家庭托顧"]},{name:"身心障礙",subcategories:["身心障礙者服務中心","輔具中心","職業重建中心","小作所","庇護工場"]},{name:"兒童及少年",subcategories:["少年福利服務中心","親子館","課後班"]},{name:"婦女",subcategories:["婦女福利服務中心","新住民家庭服務中心"]},{name:"社會救助",subcategories:["經濟補助","待用餐","基金會","社會福利中心"]},{name:"其他",subcategories:["其他"]}]),p=M([]),v=M([]),t=M([]),e=M([]),s=M({}),n=M(null),i=M(null),r=["台北市","新北市"],o=async()=>{try{const c=await W.get("https://gist.githubusercontent.com/Wcc723/ac712d2bb5c4e61df99d7c5b7f3746e1/raw/2ebe2f94c3bbbeec254159b7dfe71a007f1696cd/tw-zipcode.json");a(c.data)}catch(c){console.error("Error loading JSON file:",c)}},a=c=>{const d={},g=[];Object.keys(c).forEach(k=>{r.includes(k)&&(g.push(k),d[k]=Object.keys(c[k]))}),t.value=g,s.value=d},l=c=>{console.log("Selected City:",c),e.value=s.value[c]||[],i.value=null};F(n,c=>{l(c)}),N(()=>{o()});const h=M(""),u=(c,d)=>{console.log("Clicked panel:",c.name),console.log("Panel index:",d);const g=p.value.filter(k=>c.subcategories.includes(k));p.value=g},f=()=>{p.value=[],v.value=[],i.value=[],n.value=[],h.value=""};return(c,d)=>{const g=ct,k=$;return x(),E(Z,null,[O("'' "),y(rt,{style:{height:"95vh"}},{default:C(()=>[y(T,{cols:"12",lg:"8",class:"map_col order-2 order-lg-1"},{default:C(()=>[y(g,{searchQuery:h.value,selectedCity:n.value,selectedArea:i.value,selectedSubcategories:p.value},null,8,["searchQuery","selectedCity","selectedArea","selectedSubcategories"])]),_:1}),y(T,{cols:"12",lg:"4",class:"map_col order-1 order-lg-2"},{default:C(()=>[y(Y,{variant:"outlined",class:"overflow-y-auto find-resource"},{default:C(()=>[y(A,{color:"secondary",prominent:"",class:"bb-1"},{default:C(()=>[y(U,null,{default:C(()=>[O(" 服務查詢 ")]),_:1})]),_:1}),y(J,null,{default:C(()=>[I("div",_t,[y(X,{type:"submit",variant:"plain",class:"rounded-md bb-1 mt-2 bg-grey-lighten-4",density:"comfortable",ripple:!1,height:"40",width:"80",onClick:d[0]||(d[0]=m=>f())},{default:C(()=>[O("清空條件")]),_:1})]),y(k,{class:"my-5","max-width":"1000px",modelValue:h.value,"onUpdate:modelValue":d[1]||(d[1]=m=>h.value=m),label:"輸入資源地址"},null,8,["modelValue"]),I("div",null,[y(z,{modelValue:n.value,"onUpdate:modelValue":d[2]||(d[2]=m=>n.value=m),items:t.value,"min-width":"215px",label:"縣市",class:"me-4 d-none d-md-inline-block",style:{width:"48%"},density:"comfortable",variant:"outlined",onChange:l},null,8,["modelValue","items"]),y(z,{modelValue:i.value,"onUpdate:modelValue":d[3]||(d[3]=m=>i.value=m),items:e.value,"min-width":"215px",label:"鄉鎮市區",class:"d-none d-md-inline-block",style:{width:"48%"},density:"comfortable",variant:"outlined"},null,8,["modelValue","items"])]),y(A,{density:"compact"},{default:C(()=>[y(U,{class:"ms-5 text-body-1"},{default:C(()=>[O(" 服務類別 ")]),_:1})]),_:1}),y(tt,{variant:"accordion",class:""},{default:C(()=>[(x(!0),E(Z,null,G(_.value,(m,B)=>(x(),V(et,{key:B,modelValue:v.value,"onUpdate:modelValue":d[5]||(d[5]=P=>v.value=P),onClick:P=>u(m,B)},{default:C(()=>[y(it,null,{default:C(()=>[O(K(m.name),1)]),_:2},1024),y(st,null,{default:C(()=>[(x(!0),E(Z,null,G(m.subcategories,(P,j)=>(x(),V(at,{key:j,modelValue:p.value,"onUpdate:modelValue":d[4]||(d[4]=R=>p.value=R),label:P,value:P,"hide-details":""},null,8,["modelValue","label","value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64)}}},bt=H(dt,[["__scopeId","data-v-8e4d17f3"]]);export{bt as default};
