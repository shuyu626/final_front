import{_ as de}from"./submitButton-CEFma3va.js";import{_ as pe}from"./inputText-BJbqElAX.js";import{a3 as me,i as ge,n as A,P as fe,o as y,c as _,b as e,w as o,F as h,p as ve,Q as ye,C as _e,l as u,V as he,a as xe,f as Ve,g as a,a8 as be,t as M,D as Ae,E as Me}from"./index-B48YCZ9Z.js";import{c as Se,a as d,e as x,u as Ue,b as p,V as $e}from"./index.esm-CO7hphL7.js";import{l as i,V as we,a as ke,c as ze}from"./leaflet-src-CybKgiCH.js";import{_ as Ce}from"./search-CchjQjwd.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as K,a as S}from"./VContainer-LbBbi1zP.js";import{V as g,a as c}from"./VRow-lGLSltiD.js";import{V as qe}from"./VBreadcrumbs-DxXggDc-.js";import{V as Te,a as Ee}from"./VToolbar-CnfX6LNg.js";import{V as Ie,b as V,a as b}from"./VSelect-E0cpSPTS.js";import{V as Le}from"./VTextarea-C4mk0VKG.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VMenu-BWraitUd.js";import"./ssrBoot-D8MGhuDs.js";const m=$=>(Ae("data-v-91803831"),$=$(),Me(),$),Be={id:"map",ref:"map"},Fe={class:"px-6"},Ne=m(()=>u("label",{class:"form-label"},"服務名稱",-1)),He=m(()=>u("label",{class:"form-label"},"服務電話",-1)),Re=m(()=>u("label",{class:"form-label"},"服務類別",-1)),We=m(()=>u("label",{class:"form-label"},"服務項目",-1)),je=m(()=>u("p",null,"服務對象",-1)),Oe=m(()=>u("p",null,"長期照顧",-1)),De=m(()=>u("p",null,"身心障礙",-1)),Ze=m(()=>u("p",null,"兒童及少年",-1)),Ge=m(()=>u("p",null,"社會救助",-1)),Ke=m(()=>u("p",null,"婦女",-1)),Qe=m(()=>u("p",null,"其他",-1)),Ye=m(()=>u("label",{class:"form-label"},"服務介紹",-1)),Je={__name:"createMark",setup($){const{api:Xe,apiAuth:O}=ve();me();const P=ge(),Q=A([{title:"首頁",disabled:!1,href:"/"},{title:"新增資源",disabled:!0}]),Y=["長期照顧","身心障礙","婦女","兒童及少年","心理衛生","保護性服務","社會救助","綜合","其他"],J=["日照中心","護理之家","居家服務","交通接送","家庭托顧"],X=["身心障礙者服務中心","輔具中心","職業重建中心","小作所","庇護工場"],ee=["少年福利服務中心","親子館","課後班"],le=["經濟補助","待用餐","基金會","社會福利中心"],oe=["婦女福利服務中心","新住民家庭服務中心"],ae=A(["長期照顧","身心障礙","婦女","兒童及少年","心理衛生","保護性服務","社會救助","綜合","其他"]),te=Se({name:d().required("服務單位必填"),address:d().required("服務地址必填"),tel:d(),cl:d(),category5:x().of(d()).required("分類必填"),category2:x().of(d()).required("分類必填"),category3:x().of(d()).required("分類必填"),category4:x().of(d()).required("分類必填"),category5:x().of(d()).required("分類必填"),category6:x().of(d()).required("分類必填"),category7:x().of(d()).required("分類必填"),description:d()}),{handleSubmit:se,isSubmitting:re,resetForm:ne}=Ue({validationSchema:te,initialValues:{name:"",address:"",tel:"",cl:"",category1:[],category2:[],category3:[],category4:[],category5:[],category6:[],category7:[],description:""}}),q=p("name"),T=p("tel"),E=p("cl"),I=p("category1"),L=p("category2"),B=p("category3"),F=p("category4"),N=p("category5"),H=p("category6"),R=p("category7"),W=p("description"),{value:f,errorMessage:ce}=p("address"),D="AIzaSyAyML8H2ENbc_kzs_ZSI6qYf7CCbBt0dAA";console.log(D);const v=A(null),U=A(null),j=A(null);fe(()=>{v.value=i.map("map").setView([25.049183268037577,121.51342818384893],12),i.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(v.value)});const Z=async()=>{if(!f.value){alert("找不到地址~");return}const r=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(f.value)}&key=${D}`;try{const n=(await ye.get(r)).data;if(console.log(n),n.results&&n.results.length>0){const s=n.results[0].geometry.location.lat,l=n.results[0].geometry.location.lng;U.value=s,j.value=l,console.log(U.value),console.log(n.results),console.log(s),console.log(l)}else alert("找不到地址~")}catch(t){console.error("新增地標錯誤:",t),alert("新增地標失敗~")}},ue=se(async r=>{var t,n;try{const s=C=>C.replace(/臺北市/g,"台北市"),l=s(f.value);console.log(s),f.value=l,console.log(f.value),await Z(),console.log(U.value);const z=[...r.category1,...r.category2,...r.category3,...r.category4,...r.category5,...r.category6,...r.category7],G={name:r.name,address:r.address,tel:r.tel,cl:r.cl,categories:z,description:r.description,lat:U.value,lng:j.value};console.log(G),await O.post("landmark/",G),P({text:"新增成功",snackbarProps:{color:"green"}}),v.value.eachLayer(C=>{C instanceof i.Marker&&v.value.removeLayer(C)});const ie=w[r.cl]||w.綜合;i.marker([U.value,j.value],{icon:ie}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${r.name}</h2>
        <h3 style="margin: 2px 0 2px 0;color:gray;">地址：${r.address}</h3>
        <h3 style="margin: 2px 0 2px 0;color:gray;">電話：${r.tel}</h3>
        <h4 style="margin: 2px 0 2px 0;color:gray;">類別：${z.join(" | ")}</h4>
        <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${r.description}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!0}).addTo(v.value).openPopup(),ne()}catch(s){console.log(s),P({text:((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),w={服務對象:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/2377/2377871.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),長期照顧:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/12264/12264430.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),身心障礙:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/17573/17573294.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),兒童及少年:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5759/5759522.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),心理衛生:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/4010/4010654.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),婦女:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/7457/7457069.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),社會救助:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/784/784791.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),綜合:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5153/5153858.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),其他:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5672/5672993.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]})},k=A([]);return(async()=>{var r,t;try{const{data:n}=await O.get("/landmark");k.value.splice(0,k.value.length,...n.result.data),console.log(n),v.value.eachLayer(s=>{s instanceof i.Marker&&v.value.removeLayer(s)}),console.log(k.value),k.value.forEach(s=>{const l=s.cl,z=w[l]||w.綜合;i.marker([s.lat,s.lng],{icon:z}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${s.name}</h2>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.address}</h3>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.tel}</h3>
        <h4 style="margin: 2px 0 2px 0;color:gray;">類別：${s.categories.join(" | ")}</h4>
        <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${s.description}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!1}).addTo(v.value)})}catch(n){console.log(n),P({text:((t=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}})(),(r,t)=>{const n=pe,s=de;return y(),_(h,null,[e(K,null,{default:o(()=>[e(qe,{items:Q.value},{divider:o(()=>[e(_e,{icon:"mdi-chevron-right"})]),_:1},8,["items"])]),_:1}),e(g,{style:{height:"95vh"}},{default:o(()=>[e(c,{cols:"12",lg:"8",class:"map_col order-2 order-lg-1"},{default:o(()=>[u("div",Be,null,512)]),_:1}),e(c,{cols:"12",lg:"4",class:"map_col order-1 order-lg-2"},{default:o(()=>[e(he,{variant:"outlined",class:"overflow-y-auto find-resource"},{default:o(()=>[e(Te,{color:"secondary bb-1",prominent:""},{default:o(()=>[e(Ee,null,{default:o(()=>[xe(" 新增資源 ")]),_:1})]),_:1}),u("div",Fe,[e($e,{onSubmit:Ve(a(ue),["prevent"]),disabled:a(re)},{default:o(()=>[e(Ce,{class:"mx-auto my-5","max-width":"1000px",modelValue:a(f),"onUpdate:modelValue":t[0]||(t[0]=l=>be(f)?f.value=l:null),"error-messages":a(ce),label:"輸入資源地址"},null,8,["modelValue","error-messages"]),e(g,{class:"my-5"},{default:o(()=>[e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:o(()=>[Ne]),_:1}),e(c,{cols:"12",md:"9"},{default:o(()=>[e(n,{modelValue:a(q).value.value,"onUpdate:modelValue":t[1]||(t[1]=l=>a(q).value.value=l),"error-messages":a(q).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:o(()=>[He]),_:1}),e(c,{cols:"12",md:"9"},{default:o(()=>[e(n,{modelValue:a(T).value.value,"onUpdate:modelValue":t[2]||(t[2]=l=>a(T).value.value=l),"error-messages":a(T).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:o(()=>[Re]),_:1}),e(c,{cols:"12",md:"9",class:"my-auto"},{default:o(()=>[e(Ie,{items:ae.value,label:"服務類別",density:"comfortable",variant:"outlined",modelValue:a(E).value.value,"onUpdate:modelValue":t[3]||(t[3]=l=>a(E).value.value=l),"error-messages":a(E).errorMessage.value,"hide-details":""},null,8,["items","modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"mt-2 text-left ps-6"},{default:o(()=>[We]),_:1}),e(c,{cols:"12",md:"9"},{default:o(()=>[e(we,{variant:"accordion"},{default:o(()=>[e(ke,{title:"選擇類別"},{default:o(()=>[e(ze,null,{default:o(()=>[e(K,null,{default:o(()=>[e(g,null,{default:o(()=>[e(c,null,{default:o(()=>[je,u("div",null,[e(V,{modelValue:a(I).value.value,"onUpdate:modelValue":t[4]||(t[4]=l=>a(I).value.value=l),"error-messages":a(I).errorMessage.value,column:"",multiple:""},{default:o(()=>[(y(),_(h,null,M(Y,l=>e(b,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:o(()=>[e(c,null,{default:o(()=>[Oe,u("div",null,[e(V,{modelValue:a(L).value.value,"onUpdate:modelValue":t[5]||(t[5]=l=>a(L).value.value=l),"error-messages":a(L).errorMessage.value,column:"",multiple:""},{default:o(()=>[(y(),_(h,null,M(J,l=>e(b,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:o(()=>[e(c,null,{default:o(()=>[De,u("div",null,[e(V,{modelValue:a(B).value.value,"onUpdate:modelValue":t[6]||(t[6]=l=>a(B).value.value=l),"error-messages":a(B).errorMessage.value,column:"",multiple:""},{default:o(()=>[(y(),_(h,null,M(X,l=>e(b,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:o(()=>[e(c,null,{default:o(()=>[Ze,u("div",null,[e(V,{modelValue:a(F).value.value,"onUpdate:modelValue":t[7]||(t[7]=l=>a(F).value.value=l),"error-messages":a(F).errorMessage.value,column:"",multiple:""},{default:o(()=>[(y(),_(h,null,M(ee,l=>e(b,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:o(()=>[e(c,null,{default:o(()=>[Ge,u("div",null,[e(V,{modelValue:a(N).value.value,"onUpdate:modelValue":t[8]||(t[8]=l=>a(N).value.value=l),"error-messages":a(N).errorMessage.value,column:"",multiple:""},{default:o(()=>[(y(),_(h,null,M(le,l=>e(b,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:o(()=>[e(c,null,{default:o(()=>[Ke,u("div",null,[e(V,{modelValue:a(R).value.value,"onUpdate:modelValue":t[9]||(t[9]=l=>a(R).value.value=l),"error-messages":a(R).errorMessage.value,column:"",multiple:""},{default:o(()=>[(y(),_(h,null,M(oe,l=>e(b,{text:l,value:l,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:o(()=>[e(c,null,{default:o(()=>[Qe,e(V,{modelValue:a(H).value.value,"onUpdate:modelValue":t[10]||(t[10]=l=>a(H).value.value=l),"error-messages":a(H).errorMessage.value,column:"",multiple:""},{default:o(()=>[e(b,{value:"其他",text:"其他",filter:"",density:"compact"})]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(c,{cols:"12",md:"3",class:"text-left ps-6"},{default:o(()=>[Ye]),_:1}),e(c,{cols:"12",md:"9"},{default:o(()=>[e(Le,{style:{"white-space":"pre-line"},variant:"outlined",clearable:"",modelValue:a(W).value.value,"onUpdate:modelValue":t[11]||(t[11]=l=>a(W).value.value=l),"error-messages":a(W).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:o(()=>[e(c,{class:"text-center"},{default:o(()=>[e(s,{type:"submit",class:"b-1 bg-accent mb-8",onClick:Z})]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])])]),_:1})]),_:1})]),_:1})],64)}}},_l=Pe(Je,[["__scopeId","data-v-91803831"]]);export{_l as default};
