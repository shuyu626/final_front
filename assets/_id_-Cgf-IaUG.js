import{_ as oe}from"./inputText-21tOsGNw.js";import{_ as re}from"./appButton-CjmqcvMO.js";import{i as J,a5 as K,n as y,P as ne,o as C,e as M,w as a,b as e,l,c as de,F as ie,t as j,au as E,B as P,x as g,f as O,g as n,av as ce,m as D,a as z,p as Q,D as W,E as X,y as ue,V as R,T as L,k as G,h as me,A as pe,aw as _e}from"./index-DOKjEeaw.js";import{c as Y,a as U,u as Z,b as I,V as ee,f as fe}from"./index.esm-DOR69wP7.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as d,a as x}from"./VRow-DEu2eCRv.js";import{a as te,V as H}from"./VContainer-CAztc7wg.js";import{V as ve}from"./VTextarea-0oifa1gI.js";import{V as ge}from"./VBreadcrumbs-D7xO5Q_I.js";import{V as be}from"./VNumberInput-_b2Xxnhc.js";import"./_commonjsHelpers-Cpj98o6Y.js";const he=f=>(W("data-v-ce3eee22"),f=f(),X(),f),ye=he(()=>l("div",{class:"b-1 info-margin text-center text-body-1 pa-2 bg-accent rounded-t-lg",style:{width:"150px",padding:"0","border-bottom":"0px"}},"留言板",-1)),xe={class:"b-1 pa-5 info-margin"},Ve={class:"pa-4"},we={class:"ml-1"},ke={class:"ml-16 text-body-2"},Se={class:"pa-4"},$e={__name:"comment",setup(f){const{api:N,apiAuth:V}=Q(),w=J(),b=K(),h=Y({comment:U().required("留言內容必填")}),{handleSubmit:B,isSubmitting:S,resetForm:T}=Z({validationSchema:h,initialValues:{comment:""}}),o=y([]),$=async()=>{try{const{data:c}=await V.get("/comment/"+b.params.id);console.log(c),o.value=c.result,console.log(o.value[0].user.username)}catch(c){console.log(c)}};ne(()=>{$()});const q=I("comment"),A=B(async c=>{var i,s;try{const u={content:c.comment,materialId:b.params.id};console.log(u),await V.post("comment/",u),w({text:"新增成功",snackbarProps:{color:"green"}}),T()}catch(u){console.log(u),w({text:((s=(i=u==null?void 0:u.response)==null?void 0:i.data)==null?void 0:s.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),k=y([]);return(async()=>{var c,i;try{const{data:s}=await V.get("/user/profile");k.value=[s.result],console.log(k.value)}catch(s){w({text:((i=(c=s==null?void 0:s.response)==null?void 0:c.data)==null?void 0:i.message)||"發生錯誤",snackbarProps:{color:"red"}})}})(),(c,i)=>(C(),M(x,{class:"mt-10"},{default:a(()=>[e(d,null,{default:a(()=>[ye,l("div",xe,[(C(!0),de(ie,null,j(o.value,s=>(C(),M(x,{key:s._id},{default:a(()=>[l("div",Ve,[e(E,{color:"primary b-1",class:"me-3",size:"large"},{default:a(()=>[e(P,{src:s.user.avatar||"default-avatar-url"},null,8,["src"])]),_:2},1024),l("span",we,g(s.user.username),1),l("p",ke,g(s.content),1)])]),_:2},1024))),128)),e(te),e(x,{class:"my-2"},{default:a(()=>[l("div",Se,[e(ee,{onSubmit:O(n(A),["prevent"]),disabled:n(S)},{default:a(()=>[e(ve,{ref:"textarea",modelValue:n(q).value.value,"onUpdate:modelValue":i[0]||(i[0]=s=>n(q).value.value=s),"error-messages":n(q).errorMessage.value,placeholder:"請輸入您的留言或提問",variant:"outlined",width:"600",maxlength:"20",counter:""},ce({_:2},[j(k.value,s=>({name:"prepend",fn:a(()=>[e(E,{color:"primary ",class:"me-1 b-1",size:"large"},{default:a(()=>[e(P,{src:s.avatar},null,8,["src"])]),_:2},1024)])}))]),1032,["modelValue","error-messages"]),e(D,{type:"submit",variant:"text",class:"rounded-md b-1 bg-accent mt-2",density:"comfortable",ripple:!1},{default:a(()=>[z("送出")]),_:1})]),_:1},8,["onSubmit","disabled"])])]),_:1})])]),_:1})]),_:1}))}},qe=ae($e,[["__scopeId","data-v-ce3eee22"]]),v=f=>(W("data-v-49238841"),f=f(),X(),f),Ce={style:{width:"360px",height:"360px"},class:"b-1 pa-2 d-flex justify-center"},Ie=v(()=>l("label",{class:"form-label"},"需求單位",-1)),Be=v(()=>l("label",{class:"form-label"},"物資類別",-1)),Te=v(()=>l("label",{class:"form-label"},"需求介紹",-1)),Ae=v(()=>l("label",{class:"form-label"},"所需數量",-1)),Fe=v(()=>l("p",null,"2包",-1)),Me={class:"b-1 bg-white rounded-sm pt-5 mt-1"},Pe=v(()=>l("label",{class:"form-label"},"捐贈數量",-1)),De=v(()=>l("label",{class:"form-label"},"單位／姓名",-1)),ze=v(()=>l("label",{class:"form-label"},"聯絡電話",-1)),Ue={class:"mx-auto"},Ne={__name:"[id]",setup(f){const{api:N,apiAuth:V}=Q(),w=K(),b=J(),h=y(!1),B=m=>{h.value=!0},S=()=>{h.value=!1},T=y([{title:"首頁",disabled:!1,href:"/"},{title:"我要募資",disabled:!1,href:"/material/find/findMaterial"},{title:"物資詳情",disabled:!0}]),o=y({_id:"",name:"",quantity:0,category:"",description:"",image:""}),$=y(null);(async()=>{var m,t;try{const{data:r}=await N.get("/material/"+w.params.id);o.value._id=r.result._id,o.value.name=r.result.name,o.value.quantity=r.result.quantity,o.value.category=r.result.category,o.value.description=r.result.description,o.value.organizer=r.result.organizer,o.value.image=r.result.image}catch(r){console.log(r),b({text:((t=(m=r==null?void 0:r.response)==null?void 0:m.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const A=Y({donator:U().required("服務單位必填"),quantity:fe().min(1,"數量不符").required("數量必填"),phone:U().required("聯絡電話必填")}),{handleSubmit:k,isSubmitting:F,resetForm:c}=Z({validationSchema:A,initialValues:{donator:"",quantity:0,phone:""}}),i=I("donator"),s=I("quantity"),u=I("phone"),se=k(async m=>{var t,r;try{console.log(o.value._id);const p={donator:m.donator,quantity:m.quantity,phone:m.phone,id:o.value._id};console.log(p),await V.post("material/donate",p),b({text:"新增成功",snackbarProps:{color:"green"}}),S()}catch(p){console.log(p),b({text:((r=(t=p==null?void 0:p.response)==null?void 0:t.data)==null?void 0:r.message)||"發生錯誤",snackbarProps:{color:"red"}})}});function le(m){const t=document.querySelector(m);t&&(t.scrollIntoView({behavior:"smooth"}),_e(()=>{$.value.focus()}))}return(m,t)=>{const r=re,p=oe;return C(),M(H,{style:{padding:"0.5rem 15rem 3rem 15rem"}},{default:a(()=>[e(ge,{items:T.value},{divider:a(()=>[e(ue,{icon:"mdi-chevron-right"})]),_:1},8,["items"]),e(x,{"justify-center":"",class:"mt-5"},{default:a(()=>[e(d,{cols:"5",class:"d-flex justify-center align-center"},{default:a(()=>[l("div",Ce,[e(P,{src:o.value.image,"max-width":"330","max-height":"330",contain:""},null,8,["src"])])]),_:1}),e(d,{cols:"5"},{default:a(()=>[e(R,{variant:"flat",id:"resourceCard"},{default:a(()=>[e(L,{class:"font-weight-black mb-3 text-h5"},{default:a(()=>[z("物資名稱："+g(o.value.name),1)]),_:1}),e(te,{thickness:"0"}),e(x,null,{default:a(()=>[e(d,{cols:"12",md:"3",class:"my-auto"},{default:a(()=>[Ie]),_:1}),e(d,{cols:"12",md:"9"},{default:a(()=>[l("p",null,g(o.value.organizer),1)]),_:1}),e(d,{cols:"12",md:"3",class:"my-auto"},{default:a(()=>[Be]),_:1}),e(d,{cols:"12",md:"9"},{default:a(()=>[l("p",null,g(o.value.category),1)]),_:1}),e(d,{cols:"12",md:"3"},{default:a(()=>[Te]),_:1}),e(d,{cols:"12",md:"9"},{default:a(()=>[l("p",null,g(o.value.description),1)]),_:1}),e(d,{cols:"12",md:"3",class:"my-auto"},{default:a(()=>[Ae]),_:1}),e(d,{cols:"12",md:"9",class:"my-auto"},{default:a(()=>[Fe]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(r,{text:"我要留言",width:"90",class:"me-4 bg-third",onClick:t[0]||(t[0]=_=>le("#msg"))}),e(r,{text:"我要捐贈",width:"90",class:"bg-third",onClick:t[1]||(t[1]=_=>B(null))}),e(pe,{"max-width":"700px",modelValue:h.value,"onUpdate:modelValue":t[6]||(t[6]=_=>h.value=_)},{default:a(()=>[e(R,{class:"bg-third"},{default:a(()=>[e(H,null,{default:a(()=>[e(G,{class:"pa-0"},{default:a(()=>[e(D,{id:"close",icon:"$close",variant:"text",onClick:t[2]||(t[2]=_=>S())})]),_:1}),e(L,{class:"font-weight-black text-left text-h5 py-0"},{default:a(()=>[z("物資名稱："+g(o.value.name),1)]),_:1}),l("div",Me,[e(me,null,{default:a(()=>[e(ee,{onSubmit:O(n(se),["prevent"]),disabled:n(F)},{default:a(()=>[e(x,null,{default:a(()=>[e(d,{cols:"12",md:"3",class:"my-auto text-center"},{default:a(()=>[Pe]),_:1}),e(d,{cols:"12",md:"9"},{default:a(()=>[e(n(be),{"control-variant":"stacked",variant:"outlined",density:"comfortable",inset:"",label:"輸入數量","hide-details":"",min:0,modelValue:n(s).value.value,"onUpdate:modelValue":t[3]||(t[3]=_=>n(s).value.value=_),"error-messages":n(s).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12",md:"3",class:"my-auto text-center"},{default:a(()=>[De]),_:1}),e(d,{cols:"12",md:"9"},{default:a(()=>[e(p,{modelValue:n(i).value.value,"onUpdate:modelValue":t[4]||(t[4]=_=>n(i).value.value=_),"error-messages":n(i).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12",md:"3",class:"my-auto text-center"},{default:a(()=>[ze]),_:1}),e(d,{cols:"12",md:"9"},{default:a(()=>[e(p,{modelValue:n(u).value.value,"onUpdate:modelValue":t[5]||(t[5]=_=>n(u).value.value=_),"error-messages":n(u).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(G,null,{default:a(()=>[l("div",Ue,[e(D,{type:"submit",text:"送出",variant:"text",class:"rounded-xl b-1 bg-primary",density:"comfortable",loading:n(F)},null,8,["loading"])])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(qe,{id:"msg",ref_key:"textarea",ref:$},null,512)]),_:1})}}},Xe=ae(Ne,[["__scopeId","data-v-49238841"]]);export{Xe as default};
