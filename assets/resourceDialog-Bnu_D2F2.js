import{_ as N}from"./inputText-CmsPNYtG.js";import{i as P,n as f,r as j,o as E,c as G,b as a,w as l,a as w,A as g,m as S,V as H,T as J,h as K,f as L,g as o,l as i,k as O,x as Q,F as W,p as X,C as Y,D as Z}from"./index-BVlipDpZ.js";import{c as ee,a as v,f as ae,u as te,b as m,V as le}from"./index.esm-CbTNu1z3.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as se}from"./VContainer-BN7E75Xr.js";import{a as z,V as s}from"./breadcrumbs-IdtgZ2kU.js";import{V as re}from"./VSelect-CABLZTpi.js";const C=r=>(Y("data-v-270b7321"),r=r(),Z(),r),ne=C(()=>i("label",{class:"form-label"},"物資名稱",-1)),ue={class:"form-label"},de=C(()=>i("label",{class:"form-label"},"物資類別",-1)),ie={class:"form-label"},me=C(()=>i("label",{class:"form-label"},"單位名稱",-1)),ce={class:"mx-auto"},pe={__name:"resourceDialog",props:{cardTitle:{type:String,default:"發布需求"},numberTitle:{type:String,default:"需求量"},descriptionTitle:{type:String,default:"需求介紹"},type:{type:String,default:"share"}},setup(r){const{apiAuth:U}=X(),T=P(),D=r,k=["食品","服飾配件","日用品","家具","輔具","教育用品","嬰幼兒用品","電器","休閒用品","其他"],c=f(!1),A=n=>{c.value=!0},q=()=>{c.value=!1,I(),h.value.deleteFileRecord()},h=f(null),d=f([]),F=f([]),B=ee({name:v().required("物品名稱必填"),quantity:ae().min(1,"物品數量不符").required("物品數量必填"),category:v().required("物品分類必填").test("isCategory","商品分類錯誤",n=>k.includes(n)),description:v().required("物資介紹必填"),organizer:v().required("單位名稱必填")}),{handleSubmit:$,isSubmitting:M,resetForm:I}=te({validationSchema:B,initialValues:{name:"",quantity:"0",category:"",description:"",organizer:""}}),V=m("name"),b=m("quantity"),y=m("category"),_=m("description"),x=m("organizer"),R=$(async n=>{var t,p,u;if(!((t=d.value[0])!=null&&t.error)&&!(d.value.length<1))try{const e=new FormData;e.append("name",n.name),e.append("quantity",n.quantity),e.append("category",n.category),e.append("description",n.description),e.append("organizer",n.organizer),e.append("type",D.type),d.value.length>0&&e.append("image",d.value[0].file),console.log(e),await U.post("/material",e),T({text:"新增成功",snackbarProps:{color:"green"}}),q()}catch(e){console.log(e),T({text:((u=(p=e==null?void 0:e.response)==null?void 0:p.data)==null?void 0:u.message)||"發生錯誤",snackbarProps:{color:"red"}})}});return(n,t)=>{const p=j("vue-file-agent"),u=N;return E(),G(W,null,[a(S,{onClick:t[0]||(t[0]=e=>A()),class:"rounded-lg bg-info b-1 font-weight-black text-body-1 mt-10","prepend-icon":"mdi-plus",variant:"text",height:"50",width:"150",id:"create",ripple:!1},{default:l(()=>[w(g(r.cardTitle),1)]),_:1}),a(Q,{"max-width":"600",modelValue:c.value,"onUpdate:modelValue":t[9]||(t[9]=e=>c.value=e)},{default:l(()=>[a(H,null,{default:l(()=>[a(se,null,{default:l(()=>[a(J,{class:"font-weight-black text-center text-h4"},{default:l(()=>[w(g(r.cardTitle),1)]),_:1}),a(K,null,{default:l(()=>[a(le,{onSubmit:L(o(R),["prevent"]),disabled:o(M)},{default:l(()=>[a(z,null,{default:l(()=>[a(s,null,{default:l(()=>[a(p,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=e=>d.value=e),"raw-model-value":F.value,"onUpdate:rawModelValue":t[2]||(t[2]=e=>F.value=e),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:h},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1}),a(z,null,{default:l(()=>[a(s,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[ne]),_:1}),a(s,{cols:"12",md:"9"},{default:l(()=>[a(u,{modelValue:o(V).value.value,"onUpdate:modelValue":t[3]||(t[3]=e=>o(V).value.value=e),"error-messages":o(V).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(s,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[i("label",ue,g(r.numberTitle),1)]),_:1}),a(s,{cols:"12",md:"9"},{default:l(()=>[a(u,{type:"number",min:"0",modelValue:o(b).value.value,"onUpdate:modelValue":t[4]||(t[4]=e=>o(b).value.value=e),"error-messages":o(b).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(s,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[de]),_:1}),a(s,{cols:"12",md:"9"},{default:l(()=>[a(re,{modelValue:o(y).value.value,"onUpdate:modelValue":t[5]||(t[5]=e=>o(y).value.value=e),"error-messages":o(y).errorMessage.value,label:"選擇",variant:"outlined",density:"comfortable",dense:"",items:k,"hide-details":""},null,8,["modelValue","error-messages"])]),_:1}),a(s,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[i("label",ie,g(r.descriptionTitle),1)]),_:1}),a(s,{cols:"12",md:"9"},{default:l(()=>[a(u,{modelValue:o(_).value.value,"onUpdate:modelValue":t[6]||(t[6]=e=>o(_).value.value=e),"error-messages":o(_).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(s,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[me]),_:1}),a(s,{cols:"12",md:"9"},{default:l(()=>[a(u,{modelValue:o(x).value.value,"onUpdate:modelValue":t[7]||(t[7]=e=>o(x).value.value=e),"error-messages":o(x).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(O,null,{default:l(()=>[i("div",ce,[a(S,{variant:"text",class:"rounded-xl b-1",density:"comfortable",type:"submit",loading:o(M)},{default:l(()=>[w("送出")]),_:1},8,["loading"]),a(S,{text:"取消",variant:"text",class:"rounded-xl b-1",density:"comfortable",onClick:t[8]||(t[8]=e=>q())})])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},xe=oe(pe,[["__scopeId","data-v-270b7321"]]);export{xe as _};
