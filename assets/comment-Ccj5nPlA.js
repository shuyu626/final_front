import{G as ce,ap as de,aq as me,K as ve,_ as fe,s as c,ar as Z,as as pe,a2 as be,X as he,N as _e,j as ee,b as n,F as A,A as ge,m as V,at as te,i as ye,a3 as xe,n as F,P as ke,o as h,e as z,w as u,l as d,c as R,t as ne,au as ae,y as le,B as oe,v as L,a as j,f as Ve,g as $,av as we,p as Ie,D as Ce,E as Pe}from"./index-B48YCZ9Z.js";import{a as B}from"./VContainer-LbBbi1zP.js";import{c as Ne,a as De,u as Se,b as Fe,V as $e}from"./index.esm-CO7hphL7.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as G,V as I}from"./VRow-lGLSltiD.js";import{V as se}from"./VTextarea-C4mk0VKG.js";const Be=ce({controlVariant:{type:String,default:"default"},inset:Boolean,hideInput:Boolean,min:{type:Number,default:-1/0},max:{type:Number,default:1/0},step:{type:Number,default:1},...de(me(),["appendInnerIcon","prependInnerIcon"])},"VNumberInput"),tt=ve()({name:"VNumberInput",props:{...Be()},emits:{"update:modelValue":a=>!0},setup(a,H){let{attrs:w,emit:p,slots:r}=H;const l=fe(a,"modelValue"),T=c(()=>Z(a.step)),K=c(()=>l.value!=null?Z(l.value):0),C=pe(),m=c(()=>a.disabled||a.readonly||(C==null?void 0:C.isReadonly.value)),b=c(()=>m.value?!1:l.value==null?!0:l.value+a.step<=a.max),_=c(()=>m.value?!1:l.value==null?!0:l.value-a.step>=a.min);be(()=>{m.value||l.value!=null&&(l.value<a.min||l.value>a.max)&&(l.value=he(l.value,a.min,a.max))});const i=c(()=>a.hideInput?"stacked":a.controlVariant),g=c(()=>i.value==="split"?"$plus":"$collapse"),y=c(()=>i.value==="split"?"$minus":"$expand"),P=c(()=>i.value==="split"?"default":"small"),v=c(()=>i.value==="stacked"?"auto":"100%"),x=c(()=>({click:M})),q=c(()=>({click:E}));function k(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(m.value)return;if(l.value==null){l.value=0;return}const U=Math.max(K.value,T.value);e?b.value&&(l.value=+(l.value+a.step).toFixed(U)):_.value&&(l.value=+(l.value-a.step).toFixed(U))}function M(e){e.stopPropagation(),k()}function E(e){e.stopPropagation(),k(!1)}function s(e){if(!(["Enter","ArrowLeft","ArrowRight","Backspace","Delete","Tab"].includes(e.key)||e.ctrlKey)){if(["ArrowDown"].includes(e.key)){e.preventDefault(),k(!1);return}if(["ArrowUp"].includes(e.key)){e.preventDefault(),k();return}/^[0-9\-+.]+$/.test(e.key)||e.preventDefault()}}function o(e){l.value=e?+e:void 0}function t(e){e.stopPropagation()}_e(()=>{const{modelValue:e,...U}=ee.filterProps(a);function X(){return r.increment?n(te,{key:"increment-defaults",defaults:{VBtn:{disabled:!b.value,flat:!0,height:v.value,size:P.value,icon:g.value}}},{default:()=>[r.increment(x.value)]}):n(V,{disabled:!b.value,flat:!0,key:"increment-btn",height:v.value,name:"increment-btn",icon:g.value,onClick:M,onMousedown:t,size:P.value,tabindex:"-1"},null)}function J(){return r.decrement?n(te,{key:"decrement-defaults",defaults:{VBtn:{disabled:!_.value,flat:!0,height:v.value,size:P.value,icon:y.value}}},{default:()=>[r.decrement(q.value)]}):n(V,{disabled:!_.value,flat:!0,key:"decrement-btn",height:v.value,name:"decrement-btn",icon:y.value,size:P.value,tabindex:"-1",onClick:E,onMousedown:t},null)}function O(){return n("div",{class:"v-number-input__control"},[J(),n(B,{vertical:i.value!=="stacked"},null),X()])}function Q(){return!a.hideInput&&!a.inset?n(B,{vertical:!0},null):void 0}const W=i.value==="split"?n("div",{class:"v-number-input__control"},[n(B,{vertical:!0},null),X()]):a.reverse?void 0:n(A,null,[Q(),O()]),ue=r["append-inner"]||W,Y=i.value==="split"?n("div",{class:"v-number-input__control"},[J(),n(B,{vertical:!0},null)]):a.reverse?n(A,null,[O(),Q()]):void 0,ie=r["prepend-inner"]||Y;return n(ee,ge({modelValue:l.value,"onUpdate:modelValue":o,onKeydown:s,class:["v-number-input",{"v-number-input--default":i.value==="default","v-number-input--hide-input":a.hideInput,"v-number-input--inset":a.inset,"v-number-input--reverse":a.reverse,"v-number-input--split":i.value==="split","v-number-input--stacked":i.value==="stacked"},a.class]},U,{style:a.style,inputmode:"decimal"}),{...r,"append-inner":ue?function(){var S;for(var N=arguments.length,D=new Array(N),f=0;f<N;f++)D[f]=arguments[f];return n(A,null,[(S=r["append-inner"])==null?void 0:S.call(r,...D),W])}:void 0,"prepend-inner":ie?function(){var S;for(var N=arguments.length,D=new Array(N),f=0;f<N;f++)D[f]=arguments[f];return n(A,null,[Y,(S=r["prepend-inner"])==null?void 0:S.call(r,...D)])}:void 0})})}}),re=a=>(Ce("data-v-ad0f21fa"),a=a(),Pe(),a),Me=re(()=>d("div",{class:"b-1 info-margin text-center text-body-1 pa-2 bg-accent rounded-t-lg font-weight-bold",style:{"max-width":"150px",padding:"0","border-bottom":"0px"}},"留言板",-1)),Ee={class:"b-1 pa-5 info-margin"},Ue={class:"pa-4"},ze={class:"ml-1"},Re={key:0},Te={class:"ml-16 text-body-2 d-inline"},Ke={key:1,style:{width:"800"}},qe={class:"pa-4"},Le={style:{width:"500px"}},je={key:0,class:"text-center text-body-2 mt-4 mx-auto"},Ge=re(()=>d("h1",{style:{color:"#bfbfbf"},class:"mb-15"}," 目前暫無任何留言 ",-1)),He=[Ge],Xe={class:"pa-4"},Je={__name:"comment",setup(a){const{api:H,apiAuth:w}=Ie(),p=ye(),r=xe(),l=Ne({comment:De().required("留言內容必填")}),{handleSubmit:T,isSubmitting:K,resetForm:C}=Se({validationSchema:l,initialValues:{comment:""}}),m=F([]),b=async()=>{try{const{data:s}=await w.get("/comment/"+r.params.id);console.log(s),m.value=s.result,console.log(m.value[0].user._id)}catch(s){console.log(s)}};ke(()=>{b()});const _=Fe("comment"),i=T(async s=>{var o,t;try{const e={content:s.comment,materialId:r.params.id};console.log(e),await w.post("comment/",e),p({text:"新增成功",snackbarProps:{color:"green"}}),C(),b()}catch(e){console.log(e),p({text:((t=(o=e==null?void 0:e.response)==null?void 0:o.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),g=F([]),y=F(null);(async()=>{var s,o;try{const{data:t}=await w.get("/user/profile");g.value=[t.result],console.log(g.value),y.value=g.value[0].id,console.log(y.value)}catch(t){p({text:((o=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const v=F(null),x=F(""),q=(s,o)=>{v.value=s,x.value=o},k=()=>{v.value=null,x.value=""},M=async()=>{var s,o;try{await w.patch(`/comment/${v.value}`,{content:x.value}),p({text:"留言已更新",snackbarProps:{color:"green"}}),b(),k()}catch(t){p({text:((o=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:o.message)||"更新留言時出錯",snackbarProps:{color:"red"}})}},E=async s=>{var o,t;try{await w.delete(`/comment/${s}`),p({text:"留言已刪除",snackbarProps:{color:"green"}}),b()}catch(e){p({text:((t=(o=e==null?void 0:e.response)==null?void 0:o.data)==null?void 0:t.message)||"刪除留言時出錯",snackbarProps:{color:"red"}})}};return(s,o)=>(h(),z(I,{class:"mt-10"},{default:u(()=>[n(G,null,{default:u(()=>[Me,d("div",Ee,[(h(!0),R(A,null,ne(m.value,t=>(h(),z(I,{key:t._id},{default:u(()=>[n(G,{cols:"5"},{default:u(()=>[d("div",Ue,[d("div",null,[n(ae,{color:"primary b-1",class:"me-3",size:"large"},{default:u(()=>[n(le,{src:t.user.avatar||"default-avatar-url"},null,8,["src"])]),_:2},1024),d("span",ze,oe(t.user.username),1)]),v.value!==t._id?(h(),R("div",Re,[d("p",Te,oe(t.content),1),t.user._id==y.value?(h(),z(V,{key:0,icon:"mdi-pencil",onClick:e=>q(t._id,t.content),variant:"text",class:"d-inline",color:"grey"},null,8,["onClick"])):L("",!0),t.user._id==y.value?(h(),z(V,{key:1,icon:"mdi-delete",onClick:e=>E(t._id),variant:"text",class:"d-inline",color:"grey"},null,8,["onClick"])):L("",!0)])):(h(),R("div",Ke,[n(I,{class:"mt-2 mx-8"},{default:u(()=>[d("div",qe,[n(se,{modelValue:x.value,"onUpdate:modelValue":o[0]||(o[0]=e=>x.value=e),placeholder:"請輸入新的留言內容",rows:"4",variant:"outlined",width:"530",clearable:"","hide-details":"",class:"ms-1"},null,8,["modelValue"])])]),_:1}),n(I,null,{default:u(()=>[n(G,{cols:"12"},{default:u(()=>[d("div",Le,[n(V,{onClick:e=>M(t._id),variant:"text",class:"rounded-md b-1 bg-primary me-2",height:"30"},{default:u(()=>[j("儲存")]),_:2},1032,["onClick"]),n(V,{onClick:k,variant:"text",class:"rounded-md b-1 bg-info",height:"30"},{default:u(()=>[j("取消")]),_:1})])]),_:2},1024)]),_:2},1024)]))])]),_:2},1024)]),_:2},1024))),128)),n(I,{class:"my-10"},{default:u(()=>[m.value.length===0?(h(),R("div",je,He)):L("",!0),n(B)]),_:1}),n(I,{class:"my-2"},{default:u(()=>[d("div",Xe,[n($e,{onSubmit:Ve($(i),["prevent"]),disabled:$(K)},{default:u(()=>[n(se,{ref:"commentInput",modelValue:$(_).value.value,"onUpdate:modelValue":o[1]||(o[1]=t=>$(_).value.value=t),"error-messages":$(_).errorMessage.value,placeholder:"請輸入您的留言或提問",variant:"outlined",width:"600",maxlength:"20",counter:"",clearable:""},we({_:2},[ne(g.value,t=>({name:"prepend",fn:u(()=>[n(ae,{color:"primary ",class:"me-1 b-1",size:"large"},{default:u(()=>[n(le,{src:t.avatar},null,8,["src"])]),_:2},1024)])}))]),1032,["modelValue","error-messages"]),n(V,{type:"submit",variant:"text",class:"rounded-md b-1 bg-accent mt-2",density:"comfortable",ripple:!1},{default:u(()=>[j("送出")]),_:1})]),_:1},8,["onSubmit","disabled"])])]),_:1})])]),_:1})]),_:1}))}},nt=Ae(Je,[["__scopeId","data-v-ad0f21fa"]]);export{nt as C,tt as V};
