import{_ as de}from"./submitButton-C5WB9zef.js";import{_ as pe}from"./inputText-CMFXtWBw.js";import{i as me,n as x,P as ge,o as y,e as fe,w as l,b as e,y as ve,l as c,a as ye,f as _e,g as a,at as he,c as b,t as A,F as M,V as Ve,p as xe,a5 as be,R as Ae,D as Me,E as Se}from"./index-CBalmzPI.js";import{c as Ue,a as d,e as _,u as $e,b as p,V as ke}from"./index.esm-BCERKO5v.js";import{l as i,V as we,a as ze,c as Ce}from"./leaflet-src-DQ6gWO9P.js";import{_ as Pe}from"./search-Dp423F7P.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Te}from"./VBreadcrumbs-DOUMiQ5f.js";import{V as Ee,a as Ie}from"./VToolbar--hoZ0_5e.js";import{a as g,V as u}from"./VRow-C3pH8_4g.js";import{V as Be,b as h,a as V}from"./VSelect-B0DEa_dR.js";import{V as K,a as S}from"./VContainer-D3aEslrv.js";import{V as Le}from"./VTextarea-CUZCd_WE.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VMenu-BbjlTTUM.js";import"./ssrBoot-DQvMx5fX.js";const m=$=>(Me("data-v-9b711d7c"),$=$(),Se(),$),Fe={id:"map",ref:"map"},Ne={class:"px-6"},He=m(()=>c("label",{class:"form-label"},"服務名稱",-1)),Re=m(()=>c("label",{class:"form-label"},"服務電話",-1)),We=m(()=>c("label",{class:"form-label"},"服務類別",-1)),je=m(()=>c("label",{class:"form-label"},"服務項目",-1)),Oe=m(()=>c("p",null,"服務對象",-1)),De=m(()=>c("p",null,"長期照顧",-1)),Ze=m(()=>c("p",null,"身心障礙",-1)),Ge=m(()=>c("p",null,"兒童及少年",-1)),Ke=m(()=>c("p",null,"社會救助",-1)),Ye=m(()=>c("p",null,"婦女",-1)),Je=m(()=>c("p",null,"其他",-1)),Qe=m(()=>c("label",{class:"form-label"},"服務介紹",-1)),Xe={__name:"createMark",setup($){const{api:eo,apiAuth:O}=xe();be();const P=me(),Y=x([{title:"首頁",disabled:!1,href:"/"},{title:"新增資源",disabled:!0}]),J=["長期照顧","身心障礙","婦女","兒童及少年","心理衛生","保護性服務","社會救助","綜合","其他"],Q=["日照中心","護理之家","居家服務","交通接送","家庭托顧"],X=["身心障礙者服務中心","輔具中心","職業重建中心","小作所","庇護工場"],ee=["少年福利服務中心","親子館","課後班"],oe=["經濟補助","待用餐","基金會","社會福利中心"],le=["婦女福利服務中心","新住民家庭服務中心"],ae=x(["長期照顧","身心障礙","婦女","兒童及少年","心理衛生","保護性服務","社會救助","綜合","其他"]),te=Ue({name:d().required("服務單位必填"),address:d().required("服務地址必填"),tel:d(),cl:d(),category5:_().of(d()).required("分類必填"),category2:_().of(d()).required("分類必填"),category3:_().of(d()).required("分類必填"),category4:_().of(d()).required("分類必填"),category5:_().of(d()).required("分類必填"),category6:_().of(d()).required("分類必填"),category7:_().of(d()).required("分類必填"),description:d()}),{handleSubmit:se,isSubmitting:re,resetForm:ne}=$e({validationSchema:te,initialValues:{name:"",address:"",tel:"",cl:"",category1:[],category2:[],category3:[],category4:[],category5:[],category6:[],category7:[],description:""}}),q=p("name"),T=p("tel"),E=p("cl"),I=p("category1"),B=p("category2"),L=p("category3"),F=p("category4"),N=p("category5"),H=p("category6"),R=p("category7"),W=p("description"),{value:f,errorMessage:ce}=p("address"),D="AIzaSyAyML8H2ENbc_kzs_ZSI6qYf7CCbBt0dAA";console.log(D);const v=x(null),U=x(null),j=x(null);ge(()=>{v.value=i.map("map").setView([25.049183268037577,121.51342818384893],12),i.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(v.value)});const Z=async()=>{if(!f.value){alert("找不到地址~");return}const r=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(f.value)}&key=${D}`;try{const n=(await Ae.get(r)).data;if(console.log(n),n.results&&n.results.length>0){const s=n.results[0].geometry.location.lat,o=n.results[0].geometry.location.lng;U.value=s,j.value=o,console.log(U.value),console.log(n.results),console.log(s),console.log(o)}else alert("找不到地址~")}catch(t){console.error("新增地標錯誤:",t),alert("新增地標失敗~")}},ue=se(async r=>{var t,n;try{const s=C=>C.replace(/臺北市/g,"台北市"),o=s(f.value);console.log(s),f.value=o,console.log(f.value),await Z(),console.log(U.value);const z=[...r.category1,...r.category2,...r.category3,...r.category4,...r.category5,...r.category6,...r.category7],G={name:r.name,address:r.address,tel:r.tel,cl:r.cl,categories:z,description:r.description,lat:U.value,lng:j.value};console.log(G),await O.post("landmark/",G),P({text:"新增成功",snackbarProps:{color:"green"}}),v.value.eachLayer(C=>{C instanceof i.Marker&&v.value.removeLayer(C)});const ie=k[r.cl]||k.綜合;i.marker([U.value,j.value],{icon:ie}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${r.name}</h2>
        <h3 style="margin: 2px 0 2px 0;color:gray;">地址：${r.address}</h3>
        <h3 style="margin: 2px 0 2px 0;color:gray;">電話：${r.tel}</h3>
        <h4 style="margin: 2px 0 2px 0;color:gray;">類別：${z.join(" | ")}</h4>
        <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${r.description}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!0}).addTo(v.value).openPopup(),ne()}catch(s){console.log(s),P({text:((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),k={服務對象:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/2377/2377871.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),長期照顧:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/12264/12264430.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),身心障礙:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/17573/17573294.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),兒童及少年:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5759/5759522.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),心理衛生:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/4010/4010654.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),婦女:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/7457/7457069.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),社會救助:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/784/784791.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),綜合:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5153/5153858.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),其他:i.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5672/5672993.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]})},w=x([]);return(async()=>{var r,t;try{const{data:n}=await O.get("/landmark");w.value.splice(0,w.value.length,...n.result.data),console.log(n),v.value.eachLayer(s=>{s instanceof i.Marker&&v.value.removeLayer(s)}),console.log(w.value),w.value.forEach(s=>{const o=s.cl,z=k[o]||k.綜合;i.marker([s.lat,s.lng],{icon:z}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${s.name}</h2>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.address}</h3>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.tel}</h3>
        <h4 style="margin: 2px 0 2px 0;color:gray;">類別：${s.categories.join(" | ")}</h4>
        <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${s.description}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!1}).addTo(v.value)})}catch(n){console.log(n),P({text:((t=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}})(),(r,t)=>{const n=pe,s=de;return y(),fe(K,null,{default:l(()=>[e(Te,{items:Y.value},{divider:l(()=>[e(ve,{icon:"mdi-chevron-right"})]),_:1},8,["items"]),c("div",Fe,null,512),e(Ve,{width:"500px",variant:"outlined",class:"overflow-y-auto"},{default:l(()=>[e(Ee,{color:"secondary bb-1",prominent:""},{default:l(()=>[e(Ie,null,{default:l(()=>[ye(" 新增資源 ")]),_:1})]),_:1}),c("div",Ne,[e(ke,{onSubmit:_e(a(ue),["prevent"]),disabled:a(re)},{default:l(()=>[e(Pe,{class:"mx-auto my-5",modelValue:a(f),"onUpdate:modelValue":t[0]||(t[0]=o=>he(f)?f.value=o:null),"error-messages":a(ce),label:"輸入資源地址"},null,8,["modelValue","error-messages"]),e(g,{class:"my-5"},{default:l(()=>[e(u,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[He]),_:1}),e(u,{cols:"12",md:"9"},{default:l(()=>[e(n,{modelValue:a(q).value.value,"onUpdate:modelValue":t[1]||(t[1]=o=>a(q).value.value=o),"error-messages":a(q).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[Re]),_:1}),e(u,{cols:"12",md:"9"},{default:l(()=>[e(n,{modelValue:a(T).value.value,"onUpdate:modelValue":t[2]||(t[2]=o=>a(T).value.value=o),"error-messages":a(T).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[We]),_:1}),e(u,{cols:"12",md:"9",class:"my-auto"},{default:l(()=>[e(Be,{items:ae.value,label:"服務類別",density:"comfortable",variant:"outlined",modelValue:a(E).value.value,"onUpdate:modelValue":t[3]||(t[3]=o=>a(E).value.value=o),"error-messages":a(E).errorMessage.value,"hide-details":""},null,8,["items","modelValue","error-messages"])]),_:1}),e(u,{cols:"12",md:"3",class:"mt-2 text-left ps-6"},{default:l(()=>[je]),_:1}),e(u,{cols:"12",md:"9"},{default:l(()=>[e(we,{variant:"accordion"},{default:l(()=>[e(ze,{title:"選擇類別"},{default:l(()=>[e(Ce,null,{default:l(()=>[e(K,null,{default:l(()=>[e(g,null,{default:l(()=>[e(u,null,{default:l(()=>[Oe,c("div",null,[e(h,{modelValue:a(I).value.value,"onUpdate:modelValue":t[4]||(t[4]=o=>a(I).value.value=o),"error-messages":a(I).errorMessage.value,column:"",multiple:""},{default:l(()=>[(y(),b(M,null,A(J,o=>e(V,{text:o,value:o,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(u,null,{default:l(()=>[De,c("div",null,[e(h,{modelValue:a(B).value.value,"onUpdate:modelValue":t[5]||(t[5]=o=>a(B).value.value=o),"error-messages":a(B).errorMessage.value,column:"",multiple:""},{default:l(()=>[(y(),b(M,null,A(Q,o=>e(V,{text:o,value:o,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(u,null,{default:l(()=>[Ze,c("div",null,[e(h,{modelValue:a(L).value.value,"onUpdate:modelValue":t[6]||(t[6]=o=>a(L).value.value=o),"error-messages":a(L).errorMessage.value,column:"",multiple:""},{default:l(()=>[(y(),b(M,null,A(X,o=>e(V,{text:o,value:o,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(u,null,{default:l(()=>[Ge,c("div",null,[e(h,{modelValue:a(F).value.value,"onUpdate:modelValue":t[7]||(t[7]=o=>a(F).value.value=o),"error-messages":a(F).errorMessage.value,column:"",multiple:""},{default:l(()=>[(y(),b(M,null,A(ee,o=>e(V,{text:o,value:o,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(u,null,{default:l(()=>[Ke,c("div",null,[e(h,{modelValue:a(N).value.value,"onUpdate:modelValue":t[8]||(t[8]=o=>a(N).value.value=o),"error-messages":a(N).errorMessage.value,column:"",multiple:""},{default:l(()=>[(y(),b(M,null,A(oe,o=>e(V,{text:o,value:o,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(u,null,{default:l(()=>[Ye,c("div",null,[e(h,{modelValue:a(R).value.value,"onUpdate:modelValue":t[9]||(t[9]=o=>a(R).value.value=o),"error-messages":a(R).errorMessage.value,column:"",multiple:""},{default:l(()=>[(y(),b(M,null,A(le,o=>e(V,{text:o,value:o,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(S)]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(u,null,{default:l(()=>[Je,e(h,{modelValue:a(H).value.value,"onUpdate:modelValue":t[10]||(t[10]=o=>a(H).value.value=o),"error-messages":a(H).errorMessage.value,column:"",multiple:""},{default:l(()=>[e(V,{value:"其他",text:"其他",filter:"",density:"compact"})]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{cols:"12",md:"3",class:"text-left ps-6"},{default:l(()=>[Qe]),_:1}),e(u,{cols:"12",md:"9"},{default:l(()=>[e(Le,{style:{"white-space":"pre-line"},variant:"outlined",clearable:"",modelValue:a(W).value.value,"onUpdate:modelValue":t[11]||(t[11]=o=>a(W).value.value=o),"error-messages":a(W).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(u,{class:"text-center"},{default:l(()=>[e(s,{type:"submit",class:"b-1 bg-accent mb-8",onClick:Z})]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])])]),_:1})]),_:1})}}},Vo=qe(Xe,[["__scopeId","data-v-9b711d7c"]]);export{Vo as default};
