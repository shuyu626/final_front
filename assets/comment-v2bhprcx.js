import{G as me,aq as ve,ar as fe,K as pe,_ as be,s as d,as as Y,at as he,a2 as ge,X as ye,N as _e,j as Z,b as e,F as I,A as ue,m as C,au as ee,i as we,a3 as xe,n as z,P as Ve,o as h,e as te,w as s,l as c,c as k,t as ae,av as ne,y as le,B as j,a as F,aw as ke,v as Ie,f as Ce,g as A,p as $e,D as Pe,E as Ne}from"./index-r8X6d816.js";import{a as M}from"./VContainer-Dx4MoKxf.js";import{c as De,a as Se,u as ze,b as Fe,V as Ae}from"./index.esm-jyBM9uoL.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as B,V as L}from"./VRow-CqE8Shjy.js";import{V as se}from"./VTextarea-CvzFPeQ4.js";import{b as Me,V as Ee,a as oe,c as re}from"./_commonjsHelpers-10dJ3ZpB.js";const Ue=me({controlVariant:{type:String,default:"default"},inset:Boolean,hideInput:Boolean,min:{type:Number,default:-1/0},max:{type:Number,default:1/0},step:{type:Number,default:1},...ve(fe(),["appendInnerIcon","prependInnerIcon"])},"VNumberInput"),rt=pe()({name:"VNumberInput",props:{...Ue()},emits:{"update:modelValue":n=>!0},setup(n,G){let{attrs:x,emit:p,slots:u}=G;const o=be(n,"modelValue"),R=d(()=>Y(n.step)),K=d(()=>o.value!=null?Y(o.value):0),$=he(),m=d(()=>n.disabled||n.readonly||($==null?void 0:$.isReadonly.value)),b=d(()=>m.value?!1:o.value==null?!0:o.value+n.step<=n.max),g=d(()=>m.value?!1:o.value==null?!0:o.value-n.step>=n.min);ge(()=>{m.value||o.value!=null&&(o.value<n.min||o.value>n.max)&&(o.value=ye(o.value,n.min,n.max))});const i=d(()=>n.hideInput?"stacked":n.controlVariant),y=d(()=>i.value==="split"?"$plus":"$collapse"),V=d(()=>i.value==="split"?"$minus":"$expand"),P=d(()=>i.value==="split"?"default":"small"),v=d(()=>i.value==="stacked"?"auto":"100%"),_=d(()=>({click:E})),q=d(()=>({click:U}));function w(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(m.value)return;if(o.value==null){o.value=0;return}const T=Math.max(K.value,R.value);t?b.value&&(o.value=+(o.value+n.step).toFixed(T)):g.value&&(o.value=+(o.value-n.step).toFixed(T))}function E(t){t.stopPropagation(),w()}function U(t){t.stopPropagation(),w(!1)}function l(t){if(!(["Enter","ArrowLeft","ArrowRight","Backspace","Delete","Tab"].includes(t.key)||t.ctrlKey)){if(["ArrowDown"].includes(t.key)){t.preventDefault(),w(!1);return}if(["ArrowUp"].includes(t.key)){t.preventDefault(),w();return}/^[0-9\-+.]+$/.test(t.key)||t.preventDefault()}}function r(t){o.value=t?+t:void 0}function a(t){t.stopPropagation()}_e(()=>{const{modelValue:t,...T}=Z.filterProps(n);function H(){return u.increment?e(ee,{key:"increment-defaults",defaults:{VBtn:{disabled:!b.value,flat:!0,height:v.value,size:P.value,icon:y.value}}},{default:()=>[u.increment(_.value)]}):e(C,{disabled:!b.value,flat:!0,key:"increment-btn",height:v.value,name:"increment-btn",icon:y.value,onClick:E,onMousedown:a,size:P.value,tabindex:"-1"},null)}function X(){return u.decrement?e(ee,{key:"decrement-defaults",defaults:{VBtn:{disabled:!g.value,flat:!0,height:v.value,size:P.value,icon:V.value}}},{default:()=>[u.decrement(q.value)]}):e(C,{disabled:!g.value,flat:!0,key:"decrement-btn",height:v.value,name:"decrement-btn",icon:V.value,size:P.value,tabindex:"-1",onClick:U,onMousedown:a},null)}function J(){return e("div",{class:"v-number-input__control"},[X(),e(M,{vertical:i.value!=="stacked"},null),H()])}function O(){return!n.hideInput&&!n.inset?e(M,{vertical:!0},null):void 0}const Q=i.value==="split"?e("div",{class:"v-number-input__control"},[e(M,{vertical:!0},null),H()]):n.reverse?void 0:e(I,null,[O(),J()]),de=u["append-inner"]||Q,W=i.value==="split"?e("div",{class:"v-number-input__control"},[X(),e(M,{vertical:!0},null)]):n.reverse?e(I,null,[J(),O()]):void 0,ce=u["prepend-inner"]||W;return e(Z,ue({modelValue:o.value,"onUpdate:modelValue":r,onKeydown:l,class:["v-number-input",{"v-number-input--default":i.value==="default","v-number-input--hide-input":n.hideInput,"v-number-input--inset":n.inset,"v-number-input--reverse":n.reverse,"v-number-input--split":i.value==="split","v-number-input--stacked":i.value==="stacked"},n.class]},T,{style:n.style,inputmode:"decimal"}),{...u,"append-inner":de?function(){var S;for(var N=arguments.length,D=new Array(N),f=0;f<N;f++)D[f]=arguments[f];return e(I,null,[(S=u["append-inner"])==null?void 0:S.call(u,...D),Q])}:void 0,"prepend-inner":ce?function(){var S;for(var N=arguments.length,D=new Array(N),f=0;f<N;f++)D[f]=arguments[f];return e(I,null,[W,(S=u["prepend-inner"])==null?void 0:S.call(u,...D)])}:void 0})})}}),ie=n=>(Pe("data-v-4ae9d30d"),n=n(),Ne(),n),Te=ie(()=>c("div",{class:"b-1 info-margin text-center text-body-1 pa-1 pa-sm-2 bg-accent rounded-t-lg font-weight-bold comment-tag"},"留言板",-1)),Le={class:"b-1 pa-5 info-margin"},Re={class:"pa-1 pa-md-4"},Ke={class:"ml-1 font-weight-bold name-fz"},qe={key:0},je={class:"mt-4 ml-4 ml-sm-16 info-fz",style:{"white-space":"pre-line","word-wrap":"break-word"}},Ge={key:1,class:"w-100 h-100 mt-4"},He={style:{height:"35px"},class:"w-100 w-sm-75 w-md-100 pe-2 text-end"},Xe={key:0,class:"text-center text-body-2 mt-4 mx-auto"},Je=ie(()=>c("h1",{style:{color:"#bfbfbf"},class:"mb-15"}," 目前暫無任何留言 ",-1)),Oe=[Je],Qe={class:"pa-1 pa-md-4"},We={class:"ml-1 font-weight-bold name-fz"},Ye={style:{height:"35px"},class:"pe-2 text-end w-100 w-sm-75 w-md-100"},Ze={__name:"comment",setup(n){const{api:G,apiAuth:x}=$e(),p=we(),u=xe(),o=De({comment:Se().required("留言內容必填")}),{handleSubmit:R,isSubmitting:K,resetForm:$}=ze({validationSchema:o,initialValues:{comment:""}}),m=z([]),b=async()=>{try{const{data:l}=await x.get("/comment/"+u.params.id);console.log(l),m.value=l.result,console.log(m.value[0].user._id)}catch(l){console.log(l)}};Ve(()=>{b()});const g=Fe("comment"),i=R(async l=>{var r,a;try{const t={content:l.comment,materialId:u.params.id};console.log(t),await x.post("comment/",t),p({text:"新增成功",snackbarProps:{color:"green"}}),$(),b()}catch(t){console.log(t),p({text:((a=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),y=z([]),V=z(null);(async()=>{var l,r;try{const{data:a}=await x.get("/user/profile");y.value=[a.result],console.log(y.value),V.value=y.value[0].id,console.log(V.value)}catch(a){p({text:((r=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:r.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const v=z(null),_=z(""),q=(l,r)=>{v.value=l,_.value=r},w=()=>{v.value=null,_.value=""},E=async()=>{var l,r;try{await x.patch(`/comment/${v.value}`,{content:_.value}),p({text:"留言已更新",snackbarProps:{color:"green"}}),b(),w()}catch(a){p({text:((r=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:r.message)||"更新留言時出錯",snackbarProps:{color:"red"}})}},U=async l=>{var r,a;try{await x.delete(`/comment/${l}`),p({text:"留言已刪除",snackbarProps:{color:"green"}}),b()}catch(t){p({text:((a=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:a.message)||"刪除留言時出錯",snackbarProps:{color:"red"}})}};return(l,r)=>(h(),te(L,{class:"mt-10"},{default:s(()=>[e(B,null,{default:s(()=>[Te,c("div",Le,[(h(!0),k(I,null,ae(m.value,a=>(h(),te(L,{key:a._id},{default:s(()=>[e(B,{cols:"10",md:"9"},{default:s(()=>[c("div",Re,[c("div",null,[e(ne,{color:"primary b-1",class:"me-3",size:l.$vuetify.display.xs?"default":"large"},{default:s(()=>[e(le,{src:a.user.avatar},null,8,["src"])]),_:2},1032,["size"]),c("span",Ke,j(a.user.username),1)]),v.value!==a._id?(h(),k("div",qe,[c("p",je,j(a.content),1)])):(h(),k("div",Ge,[e(se,{modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=t=>_.value=t),placeholder:"請輸入新的留言內容",variant:"outlined",rows:l.$vuetify.display.xs?"3":"4",clearable:!l.$vuetify.display.xs,"hide-details":"",class:"ms-1 w-100 w-sm-75 w-md-100 px-3 pb-3","auto-grow":"",maxlength:"150",style:{"word-break":"break-word"}},null,8,["modelValue","rows","clearable"]),c("div",He,[e(C,{onClick:t=>E(a._id),variant:"text",class:"rounded-md b-1 bg-primary me-2 d-inline-block",height:l.$vuetify.display.xs?"25":"30"},{default:s(()=>[F("儲存")]),_:2},1032,["onClick","height"]),e(C,{onClick:w,variant:"text",class:"rounded-md b-1 bg-info d-inline-block",height:l.$vuetify.display.xs?"25":"30"},{default:s(()=>[F("取消")]),_:1},8,["height"])])]))])]),_:2},1024),e(B,{cols:"2",md:"3",class:"text-end"},{default:s(()=>[e(Me,{location:"end",class:"cursor-pointer"},ke({default:s(()=>[e(Ee,{density:"comfortable"},{default:s(()=>[e(oe,null,{default:s(()=>[e(re,{onClick:t=>q(a._id,a.content),variant:"text"},{default:s(()=>[F("編輯")]),_:2},1032,["onClick"])]),_:2},1024),e(oe,null,{default:s(()=>[e(re,{onClick:t=>U(a._id),variant:"text"},{default:s(()=>[F("刪除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},[a.user._id==V.value?{name:"activator",fn:s(({props:t})=>[e(C,ue({icon:"mdi-dots-vertical",variant:"plain",ref_for:!0},t,{size:l.$vuetify.display.xs?"small":"default"}),null,16,["size"])]),key:"0"}:void 0]),1024)]),_:2},1024)]),_:2},1024))),128)),e(L,{class:"mt-4 mt-sm-5 mt-md-8 mt-lg-10 mb-2"},{default:s(()=>[m.value.length===0?(h(),k("div",Xe,Oe)):Ie("",!0),e(M)]),_:1}),e(L,{class:"my-2"},{default:s(()=>[e(B,{cols:"12"},{default:s(()=>[(h(!0),k(I,null,ae(y.value,a=>(h(),k("div",Qe,[c("div",null,[e(ne,{color:"primary b-1",class:"me-3",size:l.$vuetify.display.xs?"default":"large"},{default:s(()=>[e(le,{src:a.avatar},null,8,["src"])]),_:2},1032,["size"]),c("span",We,j(a.username),1)])]))),256))]),_:1}),e(B,{cols:"12",md:"9"},{default:s(()=>[e(Ae,{onSubmit:Ce(A(i),["prevent"]),disabled:A(K)},{default:s(()=>[e(se,{ref:"commentInput",modelValue:A(g).value.value,"onUpdate:modelValue":r[1]||(r[1]=a=>A(g).value.value=a),"error-messages":A(g).errorMessage.value,placeholder:"請輸入您的留言或提問",variant:"outlined",maxlength:"150",counter:"",clearable:!l.$vuetify.display.xs,rows:l.$vuetify.display.xs?"4":"5","auto-grow":"",class:"ms-1 w-100 w-sm-75 w-md-100 px-3 pb-1"},null,8,["modelValue","error-messages","clearable","rows"]),c("div",Ye,[e(C,{type:"submit",variant:"text",class:"rounded-md b-1 bg-accent",density:"comfortable",ripple:!1},{default:s(()=>[F("送出")]),_:1})])]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})])]),_:1})]),_:1}))}},ut=Be(Ze,[["__scopeId","data-v-4ae9d30d"]]);export{ut as C,rt as V};
