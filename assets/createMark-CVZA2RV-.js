import{_ as ne}from"./submitButton-DK8pJ4DP.js";import{_ as ue}from"./inputText-BZbIDHrA.js";import{a as p,V as c,_ as ce}from"./breadcrumbs-BLWK-pqN.js";import{i as de,n as A,O as ie,o as v,e as me,w as l,b as e,l as n,a as pe,f as ge,g as o,as as fe,c as b,t as M,F as w,V as ve,p as ye,a3 as _e,Q as xe,C as Ve,D as he}from"./index-CzRNNlIw.js";import{c as be,a as d,e as y,u as Me,b as i,V as we}from"./index.esm-CSTT7WTR.js";import{l as _,V as $e,a as ke,c as Se}from"./leaflet-src-YpobalhV.js";import{_ as Ue}from"./search-DtELWfcf.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Pe,a as qe}from"./VToolbar-gysEO12v.js";import{V as Z,a as $}from"./VContainer-WFWzqaWf.js";import{a as x,V}from"./VChip-CAAVSUsS.js";import{V as Ae}from"./VTextarea-CvnaPNSj.js";import{V as Te}from"./VFooter-C47_bIXE.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VSlideGroup-BvokDqPp.js";const m=k=>(Ve("data-v-ec406712"),k=k(),he(),k),Ee={id:"map",ref:"map"},Ie={class:"px-6"},Fe=m(()=>n("label",{class:"form-label"},"服務名稱",-1)),Le=m(()=>n("label",{class:"form-label"},"服務電話",-1)),Be=m(()=>n("label",{class:"form-label"},"服務項目",-1)),Ne=m(()=>n("p",null,"服務對象",-1)),He=m(()=>n("p",null,"長期照顧",-1)),ze=m(()=>n("p",null,"身心障礙",-1)),Oe=m(()=>n("p",null,"兒童及少年",-1)),Re=m(()=>n("p",null,"社會救助",-1)),We=m(()=>n("p",null,"婦女",-1)),je=m(()=>n("p",null,"其他",-1)),De=m(()=>n("label",{class:"form-label"},"服務介紹",-1)),Ze={__name:"createMark",setup(k){const{api:Ge,apiAuth:z}=ye();_e();const T=de(),G=["資源地圖","新增資源"],K=["長期照顧","身心障礙","婦女","兒童及少年","保護性服務"],Q=["日照中心","護理之家","居家服務","交通接送","家庭托顧"],Y=["身心障礙者服務中心","輔具中心","職業重建中心","小作所","庇護工場"],J=["少年福利服務中心","親子館","課後班"],X=["經濟補助","待用餐","基金會","社會福利中心"],ee=["婦女福利服務中心","新住民家庭服務中心"],ae=be({name:d().required("服務單位必填"),address:d().required("服務地址必填"),tel:d(),category5:y().of(d()).required("分類必填"),category2:y().of(d()).required("分類必填"),category3:y().of(d()).required("分類必填"),category4:y().of(d()).required("分類必填"),category5:y().of(d()).required("分類必填"),category6:y().of(d()).required("分類必填"),category7:y().of(d()).required("分類必填"),description:d()}),{handleSubmit:le,isSubmitting:oe,resetForm:te}=Me({validationSchema:ae,initialValues:{name:"",address:"",tel:"",category1:[],category2:[],category3:[],category4:[],category5:[],category6:[],category7:[],description:""}}),S=i("name"),U=i("tel"),E=i("category1"),I=i("category2"),F=i("category3"),L=i("category4"),B=i("category5"),N=i("category6"),H=i("category7"),C=i("description"),{value:h,errorMessage:se}=i("address"),O="AIzaSyAyML8H2ENbc_kzs_ZSI6qYf7CCbBt0dAA";console.log(O);const f=A(null),P=A(null),R=A(null);ie(()=>{f.value=_.map("map").setView([25.049183268037577,121.51342818384893],12),_.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(f.value)});const W=async()=>{if(!h.value){alert("找不到地址~");return}const u=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(h.value)}&key=${O}`;try{const r=(await xe.get(u)).data;if(console.log(r),r.results&&r.results.length>0){const s=r.results[0].geometry.location.lat,g=r.results[0].geometry.location.lng;P.value=s,R.value=g,console.log(P.value),console.log(r.results),console.log(s),console.log(g),_.marker([s,g],{icon:j}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${S.value}</h2>
       <h3 style="margin: 2px 0 2px 0;color:gray;">${h.value}</h3>
       <h3 style="margin: 2px 0 2px 0;color:gray;">${U.value}</h3>
  
       <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${C.value}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!1}).openPopup(),D()}else alert("找不到地址~")}catch(t){console.error("新增地標錯誤:",t),alert("新增地標失敗~")}},re=le(async u=>{var t,r;try{await W(),console.log(P.value);const s=[...u.category1,...u.category2,...u.category3,...u.category4,...u.category5,...u.category6,...u.category7],g={name:u.name,address:u.address,tel:u.tel,categories:s,description:u.description,lat:P.value,lng:R.value};console.log(g),await z.post("landmark/",g),T({text:"新增成功",snackbarProps:{color:"green"}}),f.value.eachLayer(a=>{a instanceof _.Marker&&f.value.removeLayer(a)}),te()}catch(s){console.log(s),T({text:((r=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:r.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),j=_.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/7596/7596723.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),q=A([]),D=async()=>{var u,t;try{const{data:r}=await z.get("/landmark");q.value.splice(0,q.value.length,...r.result.data),console.log(r),f.value.eachLayer(s=>{s instanceof _.Marker&&f.value.removeLayer(s)}),console.log(q.value),q.value.forEach(s=>{_.marker([s.lat,s.lng],{icon:j}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${s.name}</h2>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.address}</h3>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.tel}</h3>
        <h4 style="margin: 2px 0 2px 0;color:gray;">類別：${s.categories.join(" | ")}</h4>
        <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${s.description}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!1}).addTo(f.value)})}catch(r){console.log(r),T({text:((t=(u=r==null?void 0:r.response)==null?void 0:u.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return D(),(u,t)=>{const r=ce,s=ue,g=ne;return v(),me(Z,null,{default:l(()=>[e(r,{title:G}),n("div",Ee,null,512),e(ve,{width:"500px",variant:"outlined",class:"overflow-y-auto"},{default:l(()=>[e(Pe,{color:"secondary bb-1",prominent:""},{default:l(()=>[e(qe,null,{default:l(()=>[pe(" 新增資源 ")]),_:1})]),_:1}),n("div",Ie,[e(we,{onSubmit:ge(o(re),["prevent"]),disabled:o(oe)},{default:l(()=>[e(Ue,{class:"mx-auto my-5",modelValue:o(h),"onUpdate:modelValue":t[0]||(t[0]=a=>fe(h)?h.value=a:null),"error-messages":o(se),label:"輸入資源地址"},null,8,["modelValue","error-messages"]),e(p,{class:"my-5"},{default:l(()=>[e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[Fe]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e(s,{modelValue:o(S).value.value,"onUpdate:modelValue":t[1]||(t[1]=a=>o(S).value.value=a),"error-messages":o(S).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[Le]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e(s,{modelValue:o(U).value.value,"onUpdate:modelValue":t[2]||(t[2]=a=>o(U).value.value=a),"error-messages":o(U).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"mt-2 text-left ps-6"},{default:l(()=>[Be]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e($e,{variant:"accordion"},{default:l(()=>[e(ke,{title:"選擇類別"},{default:l(()=>[e(Se,null,{default:l(()=>[e(Z,null,{default:l(()=>[e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[Ne,n("div",null,[e(x,{modelValue:o(E).value.value,"onUpdate:modelValue":t[3]||(t[3]=a=>o(E).value.value=a),"error-messages":o(E).errorMessage.value,column:"",multiple:""},{default:l(()=>[(v(),b(w,null,M(K,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[He,n("div",null,[e(x,{modelValue:o(I).value.value,"onUpdate:modelValue":t[4]||(t[4]=a=>o(I).value.value=a),"error-messages":o(I).errorMessage.value,column:"",multiple:""},{default:l(()=>[(v(),b(w,null,M(Q,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[ze,n("div",null,[e(x,{modelValue:o(F).value.value,"onUpdate:modelValue":t[5]||(t[5]=a=>o(F).value.value=a),"error-messages":o(F).errorMessage.value,column:"",multiple:""},{default:l(()=>[(v(),b(w,null,M(Y,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[Oe,n("div",null,[e(x,{modelValue:o(L).value.value,"onUpdate:modelValue":t[6]||(t[6]=a=>o(L).value.value=a),"error-messages":o(L).errorMessage.value,column:"",multiple:""},{default:l(()=>[(v(),b(w,null,M(J,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[Re,n("div",null,[e(x,{modelValue:o(B).value.value,"onUpdate:modelValue":t[7]||(t[7]=a=>o(B).value.value=a),"error-messages":o(B).errorMessage.value,column:"",multiple:""},{default:l(()=>[(v(),b(w,null,M(X,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[We,n("div",null,[e(x,{modelValue:o(H).value.value,"onUpdate:modelValue":t[8]||(t[8]=a=>o(H).value.value=a),"error-messages":o(H).errorMessage.value,column:"",multiple:""},{default:l(()=>[(v(),b(w,null,M(ee,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[je,e(x,{modelValue:o(N).value.value,"onUpdate:modelValue":t[9]||(t[9]=a=>o(N).value.value=a),"error-messages":o(N).errorMessage.value,column:"",multiple:""},{default:l(()=>[e(V,{value:"其他",text:"其他",filter:"",density:"compact"})]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(c,{cols:"12",md:"3",class:"text-left ps-6"},{default:l(()=>[De]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e(Ae,{style:{"white-space":"pre-line"},variant:"outlined",clearable:"",modelValue:o(C).value.value,"onUpdate:modelValue":t[10]||(t[10]=a=>o(C).value.value=a),"error-messages":o(C).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,{class:"text-center"},{default:l(()=>[e(g,{type:"submit",class:"b-1 bg-accent mb-8",onClick:W})]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])])]),_:1}),e(Te,{color:"info",height:"60px",class:"b-1",app:""})]),_:1})}}},da=Ce(Ze,[["__scopeId","data-v-ec406712"]]);export{da as default};
