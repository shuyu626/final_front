import{_ as ge}from"./inputText-nYR14uyd.js";import{d as ve,i as ye,n as i,s as Ve,r as Q,o as f,c as k,b as e,w as a,g as o,m as T,y as be,a6 as O,l as u,F as C,p as _e,D as H,a as m,V as J,T as K,h as xe,f as he,k as we,j as ke,v as q,e as A,a5 as Ce,C as S,R as Se,z as ze,a7 as Ee,E as $e,G as Ue}from"./index-BM-Z1O92.js";import{c as Me,a as V,e as Fe,u as Pe,b as g,V as Be}from"./index.esm-D6wyXeFr.js";import{e as Ie}from"./mitt-E5P-NQ8u.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as W}from"./VContainer-D-C1iiCU.js";import{V as D,a as n}from"./VRow-Bnu10bz3.js";import{V as qe}from"./VPagination-Dn48Fdl6.js";import{V as Ae,a as De,b as Le}from"./VTooltip-DMfQTwdu.js";import{V as Re,a as X}from"./VSelect-CwMpn1b_.js";import{V as Ge}from"./VTextarea-xYR5fM6x.js";import{V as je}from"./VBreadcrumbs-BJSnEFV_.js";import{V as Ne}from"./VSlideGroup-ydR4NULJ.js";import"./_commonjsHelpers-BEJhyQ8M.js";import"./ssrBoot-DNpl3ar1.js";const v=b=>($e("data-v-d7b5164f"),b=b(),Ue(),b),Qe=v(()=>u("label",{class:"form-label"},"活動名稱：",-1)),Oe=v(()=>u("label",{class:"form-label"},"活動地點：",-1)),He=v(()=>u("label",{class:"form-label"},"活動類別：",-1)),Je=v(()=>u("label",{class:"form-label"},"活動時間：",-1)),Ke=v(()=>u("label",{class:"form-label"},"主辦單位：",-1)),We=v(()=>u("label",{class:"form-label"},"活動介紹：",-1)),Xe={class:"mx-auto mt-3"},Ye={class:"text-center"},Ze={class:"mx-auto",style:{width:"100%"}},ea={class:"d-flex justify-content-center b-1 mt-2 mb-2 bg-white img-container"},aa={class:"text-center my-5"},Y=12,la={__name:"findEvent",setup(b){const Z=ve(),{api:ee,apiAuth:ae}=_e(),_=ye(),le=i([{title:"首頁",disabled:!1,to:"/"},{title:"活動分享",disabled:!0}]),te=["兒童","青少年","育兒","長照","精神","照顧","就學","就業","身障","親職教育","早療","紓壓","居住","醫療","司法","社工","其他"],se=i([{name:"兒童",selected:!1},{name:"青少年",selected:!1},{name:"育兒",selected:!1},{name:"長照",selected:!1},{name:"精神",selected:!1},{name:"照顧",selected:!1},{name:"就學",selected:!1},{name:"就業",selected:!1},{name:"身障",selected:!1},{name:"親職教育",selected:!1},{name:"早療",selected:!1},{name:"紓壓",selected:!1},{name:"居住",selected:!1},{name:"醫療",selected:!1},{name:"司法",selected:!1},{name:"社工",selected:!1},{name:"其他",selected:!1}]),z=i(1),L=i(1),oe=i(null),x=i(!1),re=Me({title:V().required("活動標題必填"),date:V().required("活動日期必填"),address:V().required("活動地點必填"),category:Fe().required("活動分類必填").max(4,"最多選擇 4 個項目"),organizer:V().required("主辦單位必填"),description:V().required("活動介紹必填")}),{handleSubmit:ne,isSubmitting:R,resetForm:G}=Pe({validationSchema:re,initialValues:{title:"",date:"",address:"",category:[],organizer:"",description:""}}),E=g("title"),$=g("date"),U=g("address"),M=g("category"),F=g("organizer"),P=g("description"),p=i([]),j=i([]),de=s=>{G(),x.value=!0},N=()=>{x.value=!1,G()},ie=ne(async s=>{var l,d,c;if(!((l=p.value[0])!=null&&l.error)&&!(p.value.length<1))try{const r=new FormData;r.append("title",s.title),r.append("date",s.date),r.append("address",s.address),r.append("category",s.category),r.append("organizer",s.organizer),r.append("description",s.description),p.value.length>0&&r.append("image",p.value[0].file),await ae.post("/event",r),_({text:"新增成功",snackbarProps:{color:"green"}}),N(),I()}catch(r){console.log(r),_({text:((c=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:c.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),h=i([]),ue=s=>{const l=h.value.indexOf(s);l===-1?h.value.push(s):h.value.splice(l,1)},ce=(s,l)=>{ue(s),l()},me=Ve(()=>{const s=w.value?w.value.toLowerCase():"";return B.value.filter(l=>{const d=h.value.every(r=>l.category.includes(r)),c=l.title.toLowerCase().includes(s)||l.organizer.toLowerCase().includes(s);return d&&c})}),w=i(""),B=i([]),I=async()=>{var s,l;try{const{data:d}=await ee.get("/event",{params:{itemssPerPage:Y,page:z.value}});L.value=Math.ceil(d.result.total/Y),B.value.splice(0,B.value.length,...d.result.data)}catch(d){console.log(d),_({text:((l=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:l.message)||"發生錯誤",snackbarProps:{color:"red"}})}};I();const fe=()=>{_({text:"請登入後再新增活動",snackbarProps:{color:"red"}}),Ie.emit("open-login-dialog")};return(s,l)=>{const d=Q("vue-file-agent"),c=ge,r=Q("router-link");return f(),k(C,null,[e(T,{onClick:l[0]||(l[0]=t=>o(Z).isLogin?de():fe()),class:"bg-third b-1 p-0",variant:"text",id:"create"},{default:a(()=>[e(H,{size:"x-large"},{default:a(()=>[m("mdi-plus")]),_:1}),e(Ae,{activator:"parent",location:"top"},{default:a(()=>[m(" 新增活動 ")]),_:1})]),_:1}),e(be,{"max-width":"700",modelValue:x.value,"onUpdate:modelValue":l[10]||(l[10]=t=>x.value=t)},{default:a(()=>[e(J,null,{default:a(()=>[e(W,{class:"dialog-container"},{default:a(()=>[e(K,{class:"font-weight-black text-center text-sm-h4 text-h5"},{default:a(()=>[m("新增活動")]),_:1}),e(xe,null,{default:a(()=>[e(Be,{onSubmit:he(o(ie),["prevent"]),disabled:o(R)},{default:a(()=>[e(D,null,{default:a(()=>[e(n,{cols:"1"}),e(n,{cols:"10",md:"12"},{default:a(()=>[e(d,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=t=>p.value=t),"raw-model-value":j.value,"onUpdate:rawModelValue":l[2]||(l[2]=t=>j.value=t),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:oe},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(n,{cols:"4",class:"my-auto text-center dialog-col"},{default:a(()=>[Qe]),_:1}),e(n,{cols:"8"},{default:a(()=>[e(c,{modelValue:o(E).value.value,"onUpdate:modelValue":l[3]||(l[3]=t=>o(E).value.value=t),"error-messages":o(E).errorMessage.value,density:s.$vuetify.display.xs?"compact":"comfortable"},null,8,["modelValue","error-messages","density"])]),_:1}),e(n,{cols:"4",class:"my-auto text-center dialog-col"},{default:a(()=>[Oe]),_:1}),e(n,{cols:"8"},{default:a(()=>[e(c,{modelValue:o(U).value.value,"onUpdate:modelValue":l[4]||(l[4]=t=>o(U).value.value=t),"error-messages":o(U).errorMessage.value,density:s.$vuetify.display.xs?"compact":"comfortable"},null,8,["modelValue","error-messages","density"])]),_:1}),e(n,{cols:"4",class:"my-auto text-center dialog-col"},{default:a(()=>[He]),_:1}),e(n,{cols:"8",class:"pb-0"},{default:a(()=>[e(Re,{modelValue:o(M).value.value,"onUpdate:modelValue":l[5]||(l[5]=t=>o(M).value.value=t),"error-messages":o(M).errorMessage.value,label:"選擇",variant:"outlined",density:s.$vuetify.display.xs?"compact":"comfortable",dense:"",items:te,multiple:""},null,8,["modelValue","error-messages","density"])]),_:1}),e(n,{cols:"4",class:"my-auto text-center px-0 dialog-col"},{default:a(()=>[Je]),_:1}),e(n,{cols:"8"},{default:a(()=>[e(c,{modelValue:o($).value.value,"onUpdate:modelValue":l[6]||(l[6]=t=>o($).value.value=t),"error-messages":o($).errorMessage.value,density:s.$vuetify.display.xs?"compact":"comfortable"},null,8,["modelValue","error-messages","density"])]),_:1}),e(n,{cols:"4",class:"my-auto text-center dialog-col"},{default:a(()=>[Ke]),_:1}),e(n,{cols:"8"},{default:a(()=>[e(c,{modelValue:o(F).value.value,"onUpdate:modelValue":l[7]||(l[7]=t=>o(F).value.value=t),"error-messages":o(F).errorMessage.value,density:s.$vuetify.display.xs?"compact":"comfortable"},null,8,["modelValue","error-messages","density"])]),_:1}),e(n,{cols:"4",class:"text-center dialog-col mt-3"},{default:a(()=>[We]),_:1}),e(n,{cols:"8"},{default:a(()=>[e(Ge,{"auto-grow":"",label:"輸入文字",variant:"outlined",clearable:"","hide-details":"",modelValue:o(P).value.value,"onUpdate:modelValue":l[8]||(l[8]=t=>o(P).value.value=t),"error-messages":o(P).errorMessage.value,density:s.$vuetify.display.xs?"compact":"comfortable",rows:s.$vuetify.display.xs?"3":"4"},null,8,["modelValue","error-messages","density","rows"])]),_:1})]),_:1}),e(we,null,{default:a(()=>[u("div",Xe,[e(T,{variant:"text",class:"rounded-xl b-1 bg-accent",density:"comfortable",type:"submit",loading:o(R)},{default:a(()=>[m("送出")]),_:1},8,["loading"]),e(T,{text:"取消",variant:"text",class:"rounded-xl b-1 bg-info",density:"comfortable",onClick:l[9]||(l[9]=t=>N())})])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(W,null,{default:a(()=>[e(je,{items:le.value},{divider:a(()=>[e(H,{icon:"mdi-chevron-right"})]),_:1},8,["items"])]),_:1}),e(O,{"max-width":"700px",class:"mx-auto"},{default:a(()=>[e(ke,{variant:"outlined",label:"搜尋","prepend-inner-icon":"mdi-magnify","hide-details":"","single-line":"",density:"comfortable",clearable:"",class:"bg-white mx-5 mt-5 my-5",modelValue:w.value,"onUpdate:modelValue":l[11]||(l[11]=t=>w.value=t)},null,8,["modelValue"])]),_:1}),u("div",Ye,[e(O,{"max-width":"900",class:"mx-auto"},{default:a(()=>[e(De,{class:"w-100 mx-auto d-inline-block"},{default:a(()=>[e(Ne,{"show-arrows":"",multiple:"","mobile-breakpoint":"xxl"},{default:a(()=>[(f(!0),k(C,null,q(se.value,t=>(f(),A(Le,{key:t.name},{default:a(({isSelected:y,toggle:pe})=>[e(X,{style:Ce({backgroundColor:y?"#616161":"#EEEEEE",color:y?"white":"black"}),class:"ma-2",onClick:()=>ce(t.name,pe)},{default:a(()=>[m(S(t.name),1)]),_:2},1032,["style","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),u("div",Ze,[e(D,{class:"my-3 d-flex"},{default:a(()=>[(f(!0),k(C,null,q(me.value,t=>(f(),A(n,{cols:"12",sm:"6",md:"4",lg:"3",key:t._id,class:"mx-0"},{default:a(()=>[e(r,{to:"/event/"+t._id,style:{"text-decoration":"none"}},{default:a(()=>[e(J,{variant:"flat",color:"third",class:"b-1 card-size",elevation:"5"},{default:a(()=>[e(Se,{class:"p-5 text-left"},{default:a(()=>[u("div",ea,[e(ze,{src:t.image,contain:""},null,8,["src"])]),e(K,{class:"font-weight-black",style:{"font-size":"1.1rem"}},{default:a(()=>[m(S(t.title),1)]),_:2},1024),e(Ee,{style:{width:"200px"},class:"font-weight-black"},{default:a(()=>[m(S(t.organizer),1)]),_:2},1024),(f(!0),k(C,null,q(t.category,y=>(f(),A(X,{density:"compact",class:"mt-2 me-1",key:y},{default:a(()=>[m(S(y),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})])]),u("div",aa,[e(qe,{modelValue:z.value,"onUpdate:modelValue":[l[12]||(l[12]=t=>z.value=t),I],length:L.value,rounded:"circle"},null,8,["modelValue","length"])])],64)}}},Va=Te(la,[["__scopeId","data-v-d7b5164f"]]);export{Va as default};
