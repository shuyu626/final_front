import{o as f,e as G,m as ce,i as de,n as A,O as ie,w as l,b as e,l as n,a as me,f as pe,g as t,as as ge,c as M,t as w,F as k,V as fe,p as ve,a3 as ye,Q as _e,C as xe,D as Ve}from"./index-C3mp5WEP.js";import{_ as be}from"./inputText-DagDIKt6.js";import{a as p,V as c,_ as he}from"./breadcrumbs-yq99DckG.js";import{c as Me,a as d,e as y,u as we,b as i,V as ke}from"./index.esm-DeABz7sj.js";import{l as _,V as $e,b as Se,d as Ue,a as Ce}from"./leaflet-src-Cit0rg5H.js";import{_ as Pe}from"./search-Df8gTNvQ.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Ae,a as Te}from"./VToolbar-Ckk57Jif.js";import{V as Z,a as $}from"./VContainer-DtZPQl3V.js";import{a as x,V}from"./VChip-DJM18zea.js";import{V as Be}from"./VTextarea-D-Rm4aSK.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VSlideGroup-BWGUuJ6i.js";const Ee={__name:"submitButton",props:{text:{type:String,default:"新增"}},setup(b){return(K,T)=>(f(),G(ce,{text:b.text,variant:"text",class:"rounded-xl b-1",density:"comfortable",id:"button"},null,8,["text"]))}},m=b=>(xe("data-v-9e6cf30d"),b=b(),Ve(),b),Ie={id:"map",ref:"map"},Fe={class:"px-6"},Le=m(()=>n("label",{class:"form-label"},"服務名稱",-1)),Ne=m(()=>n("label",{class:"form-label"},"服務電話",-1)),He=m(()=>n("label",{class:"form-label"},"服務項目",-1)),ze=m(()=>n("p",null,"服務對象",-1)),Oe=m(()=>n("p",null,"長期照顧",-1)),Re=m(()=>n("p",null,"身心障礙",-1)),We=m(()=>n("p",null,"兒童及少年",-1)),je=m(()=>n("p",null,"社會救助",-1)),De=m(()=>n("p",null,"婦女",-1)),Ze=m(()=>n("p",null,"其他",-1)),Ge=m(()=>n("label",{class:"form-label"},"服務介紹",-1)),Ke={__name:"createMark",setup(b){const{api:K,apiAuth:T}=ve();ye();const B=de(),Q=["資源地圖","新增資源"],Y=["長期照顧","身心障礙","婦女","兒童及少年","保護性服務"],J=["日照中心","護理之家","居家服務","交通接送","家庭托顧"],X=["身心障礙者服務中心","輔具中心","職業重建中心","小作所","庇護工場"],ee=["少年福利服務中心","親子館","課後班"],ae=["經濟補助","待用餐","基金會","社會福利中心"],le=["婦女福利服務中心","新住民家庭服務中心"],te=Me({name:d().required("服務單位必填"),address:d().required("服務地址必填"),tel:d(),category5:y().of(d()).required("分類必填"),category2:y().of(d()).required("分類必填"),category3:y().of(d()).required("分類必填"),category4:y().of(d()).required("分類必填"),category5:y().of(d()).required("分類必填"),category6:y().of(d()).required("分類必填"),category7:y().of(d()).required("分類必填"),description:d()}),{handleSubmit:oe,isSubmitting:se,resetForm:re}=we({validationSchema:te,initialValues:{name:"",address:"",tel:"",category1:[],category2:[],category3:[],category4:[],category5:[],category6:[],category7:[],description:""}}),S=i("name"),U=i("tel"),E=i("category1"),I=i("category2"),F=i("category3"),L=i("category4"),N=i("category5"),H=i("category6"),z=i("category7"),C=i("description"),{value:h,errorMessage:ne}=i("address"),O="AIzaSyAyML8H2ENbc_kzs_ZSI6qYf7CCbBt0dAA";console.log(O);const v=A(null),P=A(null),R=A(null);ie(()=>{v.value=_.map("map").setView([25.049183268037577,121.51342818384893],12),_.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(v.value)});const W=async()=>{if(!h.value){alert("找不到地址~");return}const u=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(h.value)}&key=${O}`;try{const r=(await _e.get(u)).data;if(console.log(r),r.results&&r.results.length>0){const s=r.results[0].geometry.location.lat,g=r.results[0].geometry.location.lng;P.value=s,R.value=g,console.log(P.value),console.log(r.results),console.log(s),console.log(g),_.marker([s,g],{icon:j}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${S.value}</h2>
       <h3 style="margin: 2px 0 2px 0;color:gray;">${h.value}</h3>
       <h3 style="margin: 2px 0 2px 0;color:gray;">${U.value}</h3>
  
       <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${C.value}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!1}).openPopup(),D()}else alert("找不到地址~")}catch(o){console.error("新增地標錯誤:",o),alert("新增地標失敗~")}},ue=oe(async u=>{var o,r;try{await W(),console.log(P.value);const s=[...u.category1,...u.category2,...u.category3,...u.category4,...u.category5,...u.category6,...u.category7],g={name:u.name,address:u.address,tel:u.tel,categories:s,description:u.description,lat:P.value,lng:R.value};console.log(g),await T.post("landmark/",g),B({text:"新增成功",snackbarProps:{color:"green"}}),v.value.eachLayer(a=>{a instanceof _.Marker&&v.value.removeLayer(a)}),re()}catch(s){console.log(s),B({text:((r=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:r.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),j=_.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/7596/7596723.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),q=A([]),D=async()=>{var u,o;try{const{data:r}=await T.get("/landmark");q.value.splice(0,q.value.length,...r.result.data),console.log(r),v.value.eachLayer(s=>{s instanceof _.Marker&&v.value.removeLayer(s)}),console.log(q.value),q.value.forEach(s=>{_.marker([s.lat,s.lng],{icon:j}).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;">${s.name}</h2>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.address}</h3>
        <h3 style="margin: 2px 0 2px 0;color:gray;">${s.tel}</h3>
        <h4 style="margin: 2px 0 2px 0;color:gray;">類別：${s.categories.join(" | ")}</h4>
        <p style="margin: 2px 0 2px 0;color:gray;">簡介：<br>${s.description}</p>`,{className:"custom-popup-class",maxWidth:400,minWidth:100,maxHeight:250,minHeight:100,closeOnClick:!1,autoPan:!1}).addTo(v.value)})}catch(r){console.log(r),B({text:((o=(u=r==null?void 0:r.response)==null?void 0:u.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return D(),(u,o)=>{const r=he,s=be,g=Ee;return f(),G(Z,null,{default:l(()=>[e(r,{title:Q}),n("div",Ie,null,512),e(fe,{width:"500px",variant:"outlined",class:"overflow-y-auto"},{default:l(()=>[e(Ae,{color:"secondary bb-1",prominent:""},{default:l(()=>[e(Te,null,{default:l(()=>[me(" 新增資源 ")]),_:1})]),_:1}),n("div",Fe,[e(ke,{onSubmit:pe(t(ue),["prevent"]),disabled:t(se)},{default:l(()=>[e(Pe,{class:"mx-auto",modelValue:t(h),"onUpdate:modelValue":o[0]||(o[0]=a=>ge(h)?h.value=a:null),"error-messages":t(ne),label:"輸入資源地址"},null,8,["modelValue","error-messages"]),e(p,{class:"my-5"},{default:l(()=>[e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[Le]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e(s,{modelValue:t(S).value.value,"onUpdate:modelValue":o[1]||(o[1]=a=>t(S).value.value=a),"error-messages":t(S).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:l(()=>[Ne]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e(s,{modelValue:t(U).value.value,"onUpdate:modelValue":o[2]||(o[2]=a=>t(U).value.value=a),"error-messages":t(U).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"3",class:"mt-2 text-left ps-6"},{default:l(()=>[He]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e($e,{variant:"accordion"},{default:l(()=>[e(Se,{title:"選擇類別"},{default:l(()=>[e(Ue,null,{default:l(()=>[e(Z,null,{default:l(()=>[e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[ze,n("div",null,[e(x,{modelValue:t(E).value.value,"onUpdate:modelValue":o[3]||(o[3]=a=>t(E).value.value=a),"error-messages":t(E).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(Y,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[Oe,n("div",null,[e(x,{modelValue:t(I).value.value,"onUpdate:modelValue":o[4]||(o[4]=a=>t(I).value.value=a),"error-messages":t(I).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(J,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[Re,n("div",null,[e(x,{modelValue:t(F).value.value,"onUpdate:modelValue":o[5]||(o[5]=a=>t(F).value.value=a),"error-messages":t(F).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(X,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[We,n("div",null,[e(x,{modelValue:t(L).value.value,"onUpdate:modelValue":o[6]||(o[6]=a=>t(L).value.value=a),"error-messages":t(L).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(ee,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[je,n("div",null,[e(x,{modelValue:t(N).value.value,"onUpdate:modelValue":o[7]||(o[7]=a=>t(N).value.value=a),"error-messages":t(N).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(ae,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[De,n("div",null,[e(x,{modelValue:t(z).value.value,"onUpdate:modelValue":o[8]||(o[8]=a=>t(z).value.value=a),"error-messages":t(z).errorMessage.value,column:"",multiple:""},{default:l(()=>[(f(),M(k,null,w(le,a=>e(V,{text:a,value:a,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e($)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[Ze,e(x,{modelValue:t(H).value.value,"onUpdate:modelValue":o[9]||(o[9]=a=>t(H).value.value=a),"error-messages":t(H).errorMessage.value,column:"",multiple:""},{default:l(()=>[e(V,{value:"其他",text:"其他",filter:"",density:"compact"})]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(c,{cols:"12",md:"3",class:"text-left ps-6"},{default:l(()=>[Ge]),_:1}),e(c,{cols:"12",md:"9"},{default:l(()=>[e(Be,{style:{"word-wrap":"break-word"},variant:"outlined",clearable:"",modelValue:t(C).value.value,"onUpdate:modelValue":o[10]||(o[10]=a=>t(C).value.value=a),"error-messages":t(C).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(c,{class:"text-center"},{default:l(()=>[e(g,{type:"submit",class:"b-1 bg-accent mb-8",onClick:W})]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])])]),_:1}),e(Ce,{color:"info",height:"60px",class:"b-1",app:""})]),_:1})}}},ca=qe(Ke,[["__scopeId","data-v-9e6cf30d"]]);export{ca as default};
