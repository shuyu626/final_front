import{i as ge,n as r,O as Ae,r as de,o as V,c as L,l as n,b as e,w as t,S as _e,y as ke,B as $,a as R,m as X,V as me,T as Ve,h as ze,f as Ue,g as s,k as Re,x as Be,F as Y,p as ve,D as Fe,E as De,u as lt,e as ce,t as te,j as Oe,a9 as Le,Q as at,P as st,C as Ie,v as Ne,a7 as We}from"./index-r8X6d816.js";import{c as Se,a as z,u as Ce,b as q,V as Me,f as Qe,e as fe}from"./index.esm-jyBM9uoL.js";import{_ as Ee}from"./inputText-uTbmSu8B.js";import{_ as Pe}from"./search-C4ZwNqv9.js";import{V as he}from"./eventTable.vue_vue_type_style_index_0_scoped_dd92091b_lang-Cp6soGq_.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as we,a as se}from"./VContainer-Dx4MoKxf.js";import{V as H,a as o}from"./VRow-CqE8Shjy.js";import{V as je,b as ye,a as be}from"./VSelect-Cjz-cSM7.js";import{V as Ye}from"./VTextarea-CvzFPeQ4.js";import{_ as ot}from"./appButton-DI5fHr43.js";import{V as Ze,a as Je}from"./VToolbar-HQNNs7E-.js";import{_ as nt}from"./submitButton-DKsFpN4Z.js";import{V as rt,a as dt,c as ut}from"./leaflet-src-DVFDMRoB.js";import{a as Ge,b as re,c as it,V as $e}from"./VTabs-DrpTWxi3.js";import{V as ct}from"./VNavigationDrawer-BaSUCQTy.js";import{V as Te}from"./VBreadcrumbs-DGS9crYF.js";import"./_commonjsHelpers-10dJ3ZpB.js";import"./ssrBoot-B6WD1mPH.js";import"./VPagination-DOp6LO0D.js";import"./VSlideGroup-CaQQGlc3.js";const xe=S=>(Fe("data-v-dd92091b"),S=S(),De(),S),mt={class:"b-1 w-75 mx-auto"},pt=xe(()=>n("h2",{class:"bb-1 bg-accent text-center mx-auto py-1"},"活動管理",-1)),gt={style:{width:"180px"},class:"text-left"},vt={style:{width:"220px"},class:"text-left"},ft={style:{width:"80px"}},yt={style:{width:"350px"},class:"py-2"},bt={style:{width:"80px"}},xt=xe(()=>n("label",{class:"form-label"},"活動名稱：",-1)),_t=xe(()=>n("label",{class:"form-label"},"活動地點：",-1)),kt=xe(()=>n("label",{class:"form-label"},"活動類別：",-1)),Vt=xe(()=>n("label",{class:"form-label"},"活動時間：",-1)),ht=xe(()=>n("label",{class:"form-label"},"主辦單位：",-1)),wt=xe(()=>n("label",{class:"form-label"},"活動介紹：",-1)),$t={class:"mx-auto"},Pt={__name:"eventTable",setup(S){const{api:pe,apiAuth:F}=ve(),_=ge(),G=r(null),P=r([]),h=r([]),U=r(10),B=r([{key:"createdAt",order:"desc"}]),I=r(1),C=r([]),T=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"活動名稱",align:"center",sortable:!1,key:"title"},{title:"活動地點",align:"center",sortable:!1,key:"address"},{title:"活動類別",align:"center",sortable:!0,key:"category"},{title:"活動時間",align:"center",sortable:!0,key:"date"},{title:"主辦單位",align:"center",sortable:!1,key:"organizer"},{title:"活動介紹",align:"center",sortable:!1,key:"description"},{title:"操作",align:"center",sortable:!1,key:"action"}],A=r(!0),m=r(0),v=r(""),c=async u=>{var l,k,f,i;u&&(I.value=1),A.value=!0;try{const{data:b}=await F.get("/user/event",{params:{page:I.value,itemsPerPage:U.value,sortBy:((l=B.value[0])==null?void 0:l.key)||"createdAt",sortOrder:((k=B.value[0])==null?void 0:k.order)||"desc",search:v.value}});C.value.splice(0,C.value.length,...b.result.data),m.value=b.result.total}catch(b){console.log(b),_({text:((i=(f=b==null?void 0:b.response)==null?void 0:f.data)==null?void 0:i.message)||"發生錯誤",snackbarProps:{color:"red"}})}A.value=!1};c();const p=["兒童","青少年","育兒","長照","精神","照顧","就學","就業","身障","親職教育","早療","紓壓","居住","醫療","司法","社工","其他"],y=r({open:!1,id:""}),w=u=>{y.value.open=!0,y.value.id=u._id,N.value.value=u.title,x.value.value=u.date,M.value.value=u.address,W.value.value=u.category,Z.value.value=u.organizer,J.value.value=u.description},O=()=>{y.value.open=!1,j(),G.value.deleteFileRecord()},le=Se({title:z().required("活動標題必填"),date:z().required("活動日期必填"),address:z().required("活動地點必填"),category:z().required("活動分類必填").test("isCategory","商品分類錯誤",u=>p.includes(u)),organizer:z().required("主辦單位必填"),description:z().required("活動介紹必填")}),{handleSubmit:D,isSubmitting:E,resetForm:j}=Ce({validationSchema:le,initialValues:{title:"",date:"",address:"",category:"",organizer:"",description:""}}),N=q("title"),x=q("date"),M=q("address"),W=q("category"),Z=q("organizer"),J=q("description"),ue=D(async u=>{var l,k,f;if(!((l=P.value[0])!=null&&l.error)&&!(P.value.length<1))try{const i=new FormData;i.append("title",u.title),i.append("date",u.date),i.append("address",u.address),i.append("category",u.category),i.append("organizer",u.organizer),i.append("description",u.description),P.value.length>0&&i.append("image",P.value[0].file),await F.patch("/event/"+y.value.id,i),_({text:"新增成功",snackbarProps:{color:"green"}}),O(),c()}catch(i){console.log(i),_({text:((f=(k=i==null?void 0:i.response)==null?void 0:k.data)==null?void 0:f.message)||"發生錯誤",snackbarProps:{color:"red"}})}});Ae(v,()=>{c(!0)});const ie=async u=>{var l,k;try{await F.delete(`/event/${u._id}`),_({text:"刪除成功",snackbarProps:{color:"green"}}),c(!0)}catch(f){console.log(f),_({text:((k=(l=f==null?void 0:f.response)==null?void 0:l.data)==null?void 0:k.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return(u,l)=>{const k=Pe,f=de("router-link"),i=de("vue-file-agent"),b=Ee;return V(),L(Y,null,[n("div",mt,[pt,e(he,{"items-per-page":U.value,"onUpdate:itemsPerPage":[l[3]||(l[3]=a=>U.value=a),l[6]||(l[6]=a=>c(!1))],"sort-by":B.value,"onUpdate:sortBy":[l[4]||(l[4]=a=>B.value=a),l[7]||(l[7]=a=>c(!1))],page:I.value,"onUpdate:page":[l[5]||(l[5]=a=>I.value=a),l[8]||(l[8]=a=>c(!1))],items:C.value,headers:T,loading:A.value,"items-length":m.value,search:v.value,hover:"",class:"mb-15 px-8 rounded-lg"},{top:t(()=>[e(k,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=a=>v.value=a),onClickAppend:l[1]||(l[1]=a=>c(!0)),onKeydown:l[2]||(l[2]=_e(a=>c(!0),["enter"])),"max-width":"100%",class:"my-5"},null,8,["modelValue"])]),"item.image":t(({item:a})=>[e(f,{to:"/event/"+a._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ke,{src:a.image,width:"140px","max-height":"160px",class:"my-5"},null,8,["src"])]),_:2},1032,["to"])]),"item.title":t(({item:a})=>[n("td",gt,$(a.title),1)]),"item.address":t(({item:a})=>[n("td",vt,$(a.address),1)]),"item.category":t(({item:a})=>[n("td",ft,$(a.category.join(" , ")),1)]),"item.description":t(({item:a})=>[n("td",yt,$(a.description),1)]),"item.action":t(({item:a})=>[n("td",bt,[R($(a.action)+" ",1),e(X,{icon:"mdi-pencil",variant:"text",color:"blue-grey-darken-1",onClick:oe=>w(a)},null,8,["onClick"]),e(X,{icon:"mdi-delete",variant:"text",color:"red-darken-4",onClick:oe=>ie(a)},null,8,["onClick"])])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),e(Be,{"max-width":"700",modelValue:y.value.open,"onUpdate:modelValue":l[18]||(l[18]=a=>y.value.open=a)},{default:t(()=>[e(me,null,{default:t(()=>[e(we,null,{default:t(()=>[e(Ve,{class:"font-weight-black text-center text-h4"},{default:t(()=>[R("新增活動")]),_:1}),e(ze,null,{default:t(()=>[e(Me,{onSubmit:Ue(s(ue),["prevent"]),disabled:s(E)},{default:t(()=>[e(H,null,{default:t(()=>[e(o,null,{default:t(()=>[e(i,{modelValue:P.value,"onUpdate:modelValue":l[9]||(l[9]=a=>P.value=a),"raw-model-value":h.value,"onUpdate:rawModelValue":l[10]||(l[10]=a=>h.value=a),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:G},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(o,{cols:"12",md:"3",class:"my-auto text-center"},{default:t(()=>[xt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(b,{modelValue:s(N).value.value,"onUpdate:modelValue":l[11]||(l[11]=a=>s(N).value.value=a),"error-messages":s(N).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-center"},{default:t(()=>[_t]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(b,{modelValue:s(M).value.value,"onUpdate:modelValue":l[12]||(l[12]=a=>s(M).value.value=a),"error-messages":s(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-center"},{default:t(()=>[kt]),_:1}),e(o,{cols:"12",md:"3"},{default:t(()=>[e(je,{modelValue:s(W).value.value,"onUpdate:modelValue":l[13]||(l[13]=a=>s(W).value.value=a),"error-messages":s(W).errorMessage.value,label:"選擇",variant:"outlined",density:"comfortable",dense:"",width:"140",items:p,"hide-details":""},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"3",class:"my-auto text-center px-0"},{default:t(()=>[Vt]),_:1}),e(o,{cols:"3"},{default:t(()=>[e(b,{modelValue:s(x).value.value,"onUpdate:modelValue":l[14]||(l[14]=a=>s(x).value.value=a),"error-messages":s(x).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-center"},{default:t(()=>[ht]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(b,{modelValue:s(Z).value.value,"onUpdate:modelValue":l[15]||(l[15]=a=>s(Z).value.value=a),"error-messages":s(Z).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"text-center"},{default:t(()=>[wt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(Ye,{label:"輸入文字",variant:"outlined",clearable:"","hide-details":"",modelValue:s(J).value.value,"onUpdate:modelValue":l[16]||(l[16]=a=>s(J).value.value=a),"error-messages":s(J).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(Re,null,{default:t(()=>[n("div",$t,[e(X,{variant:"text",class:"rounded-xl b-1",density:"comfortable",type:"submit",loading:s(E)},{default:t(()=>[R("送出")]),_:1},8,["loading"]),e(X,{text:"取消",variant:"text",class:"rounded-xl b-1",density:"comfortable",onClick:l[17]||(l[17]=a=>O())})])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Ut=qe(Pt,[["__scopeId","data-v-dd92091b"]]),St={class:"b-1 w-75 mx-auto"},Ct=n("h2",{class:"bg-accent text-center mx-auto bb-1 py-1"},"我要分享",-1),Mt={style:{width:"250px","white-space":"pre-line"},class:"py-2"},qt={style:{width:"80px"}},It=n("label",{class:"form-label"},"物資名稱",-1),Tt={class:"form-label"},At=n("label",{class:"form-label"},"物資類別",-1),zt={class:"form-label"},Bt=n("label",{class:"form-label"},"單位名稱",-1),Ft={class:"mx-auto"},Dt={__name:"shareTable",props:{cardTitle:{type:String,default:"發布需求"},numberTitle:{type:String,default:"需求量"},descriptionTitle:{type:String,default:"需求介紹"},type:{type:String,default:"share"}},setup(S){const{api:pe,apiAuth:F}=ve(),_=ge(),G=S,P=r(null),h=r([]),U=r([]),B=r(8),I=r([{key:"createdAt",order:"desc"}]),C=r(1),T=r([]),A=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!1,key:"name"},{title:"數量",align:"center",sortable:!1,key:"quantity"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"概況",align:"center",sortable:!1,key:"description"},{title:"單位",align:"center",sortable:!1,key:"organizer"},{title:"操作",align:"center",sortable:!1,key:"action"}],m=r(!0),v=r(0),c=r(""),p=async u=>{var l,k,f,i;u&&(C.value=1),m.value=!0;try{const{data:b}=await F.get("/user/share",{params:{page:C.value,itemsPerPage:B.value,sortBy:((l=I.value[0])==null?void 0:l.key)||"createdAt",sortOrder:((k=I.value[0])==null?void 0:k.order)||"desc",search:c.value}});console.log(b),T.value.splice(0,T.value.length,...b.result.data),v.value=b.result.total}catch(b){console.log(b),_({text:((i=(f=b==null?void 0:b.response)==null?void 0:f.data)==null?void 0:i.message)||"發生錯誤",snackbarProps:{color:"red"}})}m.value=!1};p();const y=["食品","服飾配件","日用品","家具","輔具","教育用品","嬰幼兒用品","電器","休閒用品","其他"],w=r({open:!1,id:""}),O=u=>{w.value.open=!0,w.value.id=u._id,x.value.value=u.name,M.value.value=u.quantity,W.value.value=u.category,Z.value.value=u.description,J.value.value=u.organizer},le=()=>{w.value.open=!1,N(),P.value.deleteFileRecord()},D=Se({name:z().required("物品名稱必填"),quantity:Qe().min(1,"物品數量不符").required("物品數量必填"),category:z().required("物品分類必填").test("isCategory","商品分類錯誤",u=>y.includes(u)),description:z().required("物資介紹必填"),organizer:z().required("單位名稱必填")}),{handleSubmit:E,isSubmitting:j,resetForm:N}=Ce({validationSchema:D,initialValues:{name:"",quantity:"0",category:"",description:"",organizer:""}}),x=q("name"),M=q("quantity"),W=q("category"),Z=q("description"),J=q("organizer"),ue=E(async u=>{var l,k,f;if(!((l=h.value[0])!=null&&l.error)&&!(h.value.length<1))try{const i=new FormData;i.append("name",u.name),i.append("quantity",u.quantity),i.append("category",u.category),i.append("description",u.description),i.append("organizer",u.organizer),i.append("type",G.type),h.value.length>0&&i.append("image",h.value[0].file),console.log(i),await F.patch("/material/"+w.value.id,i),_({text:"新增成功",snackbarProps:{color:"green"}}),le(),p()}catch(i){console.log(i),_({text:((f=(k=i==null?void 0:i.response)==null?void 0:k.data)==null?void 0:f.message)||"發生錯誤",snackbarProps:{color:"red"}})}});Ae(c,()=>{p(!0)});const ie=async u=>{var l,k;try{await F.delete(`/Material/${u._id}`),_({text:"刪除成功",snackbarProps:{color:"green"}}),p(!0)}catch(f){console.log(f),_({text:((k=(l=f==null?void 0:f.response)==null?void 0:l.data)==null?void 0:k.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return(u,l)=>{const k=Pe,f=de("router-link"),i=de("vue-file-agent"),b=Ee;return V(),L(Y,null,[n("div",St,[Ct,e(he,{"items-per-page":B.value,"onUpdate:itemsPerPage":[l[3]||(l[3]=a=>B.value=a),l[6]||(l[6]=a=>p(!1))],"sort-by":I.value,"onUpdate:sortBy":[l[4]||(l[4]=a=>I.value=a),l[7]||(l[7]=a=>p(!1))],page:C.value,"onUpdate:page":[l[5]||(l[5]=a=>C.value=a),l[8]||(l[8]=a=>p(!1))],items:T.value,headers:A,loading:m.value,"items-length":v.value,search:c.value,hover:"",class:"mb-15 px-8"},{top:t(()=>[e(k,{class:"my-5",modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=a=>c.value=a),onClickAppend:l[1]||(l[1]=a=>p(!0)),onKeydown:l[2]||(l[2]=_e(a=>p(!0),["enter"])),"max-width":"100%"},null,8,["modelValue"])]),"item.image":t(({item:a})=>[e(f,{to:"/material/share/"+a._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ke,{src:a.image,width:"80px","max-height":"100px"},null,8,["src"])]),_:2},1032,["to"])]),"item.description":t(({item:a})=>[n("td",Mt,$(a.description),1)]),"item.action":t(({item:a})=>[n("td",qt,[R($(a.action)+" ",1),e(X,{icon:"mdi-pencil",variant:"text",color:"blue-grey-darken-1",onClick:oe=>O(a)},null,8,["onClick"]),e(X,{icon:"mdi-delete",variant:"text",color:"red-darken-4",onClick:oe=>ie(a)},null,8,["onClick"])])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),e(Be,{"max-width":"600",modelValue:w.value.open,"onUpdate:modelValue":l[17]||(l[17]=a=>w.value.open=a)},{default:t(()=>[e(me,null,{default:t(()=>[e(we,null,{default:t(()=>[e(Ve,{class:"font-weight-black text-center text-h4"},{default:t(()=>[R($(S.cardTitle),1)]),_:1}),e(ze,null,{default:t(()=>[e(Me,{onSubmit:Ue(s(ue),["prevent"]),disabled:s(j)},{default:t(()=>[e(H,null,{default:t(()=>[e(o,null,{default:t(()=>[e(i,{modelValue:h.value,"onUpdate:modelValue":l[9]||(l[9]=a=>h.value=a),"raw-model-value":U.value,"onUpdate:rawModelValue":l[10]||(l[10]=a=>U.value=a),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:P},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[It]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(b,{modelValue:s(x).value.value,"onUpdate:modelValue":l[11]||(l[11]=a=>s(x).value.value=a),"error-messages":s(x).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[n("label",Tt,$(S.numberTitle),1)]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(b,{modelValue:s(M).value.value,"onUpdate:modelValue":l[12]||(l[12]=a=>s(M).value.value=a),"error-messages":s(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[At]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(je,{modelValue:s(W).value.value,"onUpdate:modelValue":l[13]||(l[13]=a=>s(W).value.value=a),"error-messages":s(W).errorMessage.value,label:"選擇",variant:"outlined",density:"comfortable",dense:"",items:y,"hide-details":""},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[n("label",zt,$(S.descriptionTitle),1)]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(b,{modelValue:s(Z).value.value,"onUpdate:modelValue":l[14]||(l[14]=a=>s(Z).value.value=a),"error-messages":s(Z).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[Bt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(b,{modelValue:s(J).value.value,"onUpdate:modelValue":l[15]||(l[15]=a=>s(J).value.value=a),"error-messages":s(J).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(Re,null,{default:t(()=>[n("div",Ft,[e(X,{variant:"text",class:"rounded-xl b-1",density:"comfortable",type:"submit",loading:s(j)},{default:t(()=>[R("送出")]),_:1},8,["loading"]),e(X,{text:"取消",variant:"text",class:"rounded-xl b-1",density:"comfortable",onClick:l[16]||(l[16]=a=>le())})])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Et={class:"b-1 w-75 mx-auto"},Lt=n("h2",{class:"bg-accent text-center mx-auto bb-1 py-1"},"我要募資",-1),Rt={style:{width:"250px","white-space":"pre-line"},class:"py-2"},jt={style:{width:"80px"}},Kt=n("label",{class:"form-label"},"物資名稱",-1),Ht={class:"form-label"},Ot=n("label",{class:"form-label"},"物資類別",-1),Nt={class:"form-label"},Wt=n("label",{class:"form-label"},"單位名稱",-1),Gt={class:"mx-auto"},Qt={__name:"findTable",props:{cardTitle:{type:String,default:"發布需求"},numberTitle:{type:String,default:"需求量"},descriptionTitle:{type:String,default:"需求介紹"},type:{type:String,default:"share"}},setup(S){const{api:pe,apiAuth:F}=ve(),_=ge(),G=S,P=r(null),h=r([]),U=r([]),B=r(8),I=r([{key:"createdAt",order:"desc"}]),C=r(1),T=r([]),A=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!1,key:"name"},{title:"數量",align:"center",sortable:!1,key:"quantity"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"概況",align:"center",sortable:!1,key:"description"},{title:"單位",align:"center",sortable:!1,key:"organizer"},{title:"操作",align:"center",sortable:!1,key:"action"}],m=r(!0),v=r(0),c=r(""),p=async u=>{var l,k,f,i;u&&(C.value=1),m.value=!0;try{const{data:b}=await F.get("/user/find",{params:{page:C.value,itemsPerPage:B.value,sortBy:((l=I.value[0])==null?void 0:l.key)||"createdAt",sortOrder:((k=I.value[0])==null?void 0:k.order)||"desc",search:c.value}});T.value.splice(0,T.value.length,...b.result.data),v.value=b.result.total}catch(b){console.log(b),_({text:((i=(f=b==null?void 0:b.response)==null?void 0:f.data)==null?void 0:i.message)||"發生錯誤",snackbarProps:{color:"red"}})}m.value=!1};p();const y=["食品","服飾配件","日用品","家具","輔具","教育用品","嬰幼兒用品","電器","休閒用品","其他"],w=r({open:!1,id:""}),O=u=>{w.value.open=!0,w.value.id=u._id,x.value.value=u.name,M.value.value=u.quantity,W.value.value=u.category,Z.value.value=u.description,J.value.value=u.organizer},le=()=>{w.value.open=!1,N(),P.value.deleteFileRecord()},D=Se({name:z().required("物品名稱必填"),quantity:Qe().min(1,"物品數量不符").required("物品數量必填"),category:z().required("物品分類必填").test("isCategory","商品分類錯誤",u=>y.includes(u)),description:z().required("物資介紹必填"),organizer:z().required("單位名稱必填")}),{handleSubmit:E,isSubmitting:j,resetForm:N}=Ce({validationSchema:D,initialValues:{name:"",quantity:"0",category:"",description:"",organizer:""}}),x=q("name"),M=q("quantity"),W=q("category"),Z=q("description"),J=q("organizer"),ue=E(async u=>{var l,k,f;if(!((l=h.value[0])!=null&&l.error)&&!(h.value.length<1))try{const i=new FormData;i.append("name",u.name),i.append("quantity",u.quantity),i.append("category",u.category),i.append("description",u.description),i.append("organizer",u.organizer),i.append("type",G.type),h.value.length>0&&i.append("image",h.value[0].file),console.log(i),await F.patch("/material/"+w.value.id,i),_({text:"新增成功",snackbarProps:{color:"green"}}),p(),le()}catch(i){console.log(i),_({text:((f=(k=i==null?void 0:i.response)==null?void 0:k.data)==null?void 0:f.message)||"發生錯誤",snackbarProps:{color:"red"}})}});Ae(c,()=>{p(!0)});const ie=async u=>{var l,k;try{await F.delete(`/Material/${u._id}`),_({text:"刪除成功",snackbarProps:{color:"green"}}),p(!0)}catch(f){console.log(f),_({text:((k=(l=f==null?void 0:f.response)==null?void 0:l.data)==null?void 0:k.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return(u,l)=>{const k=Pe,f=de("router-link"),i=de("vue-file-agent"),b=Ee;return V(),L(Y,null,[n("div",Et,[Lt,e(he,{"items-per-page":B.value,"onUpdate:itemsPerPage":[l[3]||(l[3]=a=>B.value=a),l[6]||(l[6]=a=>p(!1))],"sort-by":I.value,"onUpdate:sortBy":[l[4]||(l[4]=a=>I.value=a),l[7]||(l[7]=a=>p(!1))],page:C.value,"onUpdate:page":[l[5]||(l[5]=a=>C.value=a),l[8]||(l[8]=a=>p(!1))],items:T.value,headers:A,loading:m.value,"items-length":v.value,search:c.value,hover:"",class:"mb-15 px-8 text-body-1"},{top:t(()=>[e(k,{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=a=>c.value=a),onClickAppend:l[1]||(l[1]=a=>p(!0)),onKeydown:l[2]||(l[2]=_e(a=>p(!0),["enter"])),"max-width":"100%",class:"my-5"},null,8,["modelValue"])]),"item.image":t(({item:a})=>[e(f,{to:"/material/find/"+a._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ke,{src:a.image,width:"80px","max-height":"100px"},null,8,["src"])]),_:2},1032,["to"])]),"item.description":t(({item:a})=>[n("td",Rt,$(a.description),1)]),"item.action":t(({item:a})=>[n("td",jt,[R($(a.action)+" ",1),e(X,{icon:"mdi-pencil",variant:"text",color:"blue-grey-darken-1",onClick:oe=>O(a)},null,8,["onClick"]),e(X,{icon:"mdi-delete",variant:"text",color:"red-darken-4",onClick:oe=>ie(a)},null,8,["onClick"])])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),e(Be,{"max-width":"600",modelValue:w.value.open,"onUpdate:modelValue":l[17]||(l[17]=a=>w.value.open=a)},{default:t(()=>[e(me,null,{default:t(()=>[e(we,null,{default:t(()=>[e(Ve,{class:"font-weight-black text-center text-h4"},{default:t(()=>[R($(S.cardTitle),1)]),_:1}),e(ze,null,{default:t(()=>[e(Me,{onSubmit:Ue(s(ue),["prevent"]),disabled:s(j)},{default:t(()=>[e(H,null,{default:t(()=>[e(o,null,{default:t(()=>[e(i,{modelValue:h.value,"onUpdate:modelValue":l[9]||(l[9]=a=>h.value=a),"raw-model-value":U.value,"onUpdate:rawModelValue":l[10]||(l[10]=a=>U.value=a),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:P},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[Kt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(b,{modelValue:s(x).value.value,"onUpdate:modelValue":l[11]||(l[11]=a=>s(x).value.value=a),"error-messages":s(x).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[n("label",Ht,$(S.numberTitle),1)]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(b,{modelValue:s(M).value.value,"onUpdate:modelValue":l[12]||(l[12]=a=>s(M).value.value=a),"error-messages":s(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[Ot]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(je,{modelValue:s(W).value.value,"onUpdate:modelValue":l[13]||(l[13]=a=>s(W).value.value=a),"error-messages":s(W).errorMessage.value,label:"選擇",variant:"outlined",density:"comfortable",dense:"",items:y,"hide-details":""},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[n("label",Nt,$(S.descriptionTitle),1)]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(b,{modelValue:s(Z).value.value,"onUpdate:modelValue":l[14]||(l[14]=a=>s(Z).value.value=a),"error-messages":s(Z).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-left ps-6"},{default:t(()=>[Wt]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(b,{modelValue:s(J).value.value,"onUpdate:modelValue":l[15]||(l[15]=a=>s(J).value.value=a),"error-messages":s(J).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(Re,null,{default:t(()=>[n("div",Gt,[e(X,{variant:"text",class:"rounded-xl b-1",density:"comfortable",type:"submit",loading:s(j)},{default:t(()=>[R("送出")]),_:1},8,["loading"]),e(X,{text:"取消",variant:"text",class:"rounded-xl b-1",density:"comfortable",onClick:l[16]||(l[16]=a=>le())})])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Yt={class:"b-1 account-container text-center rounded-lg mx-auto"},Zt={key:0,style:{color:"#616161"},class:"info-text pl-4 pl-md-0"},Jt={style:{color:"#616161"},class:"info-text pl-4 pl-md-0"},Xt={key:0,style:{color:"#616161"},class:"info-text pl-4 pl-md-0"},el={__name:"accountTable",setup(S){const pe=lt(),{apiAuth:F}=ve(),_=ge(),G=r(null),P=r([]),h=r([]),U=r([]);(async()=>{var D,E;try{const{data:j}=await F.get("/user/profile");U.value=[j.result],U.value[0].password="********",U.value[0].newUsername=U.value[0].username,U.value[0].newPassword="",console.log(U.value),console.log(P.value)}catch(j){_({text:((E=(D=j==null?void 0:j.response)==null?void 0:D.data)==null?void 0:E.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const I=Se({newUsername:z().min(3,"服務單位長度不符").max(20,"服務單位長度不符"),newPassword:z().min(6,"使用者密碼長度不符").max(20,"使用者密碼長度不符")}),{handleSubmit:C,isSubmitting:T}=Ce({validationSchema:I}),{value:A,errorMessage:m}=q("newUsername"),{value:v,errorMessage:c}=q("newPassword"),p=C(async()=>{var D,E;try{const j=U.value[0],N=new FormData;A.value&&A.value!==j.username&&N.append("username",A.value),v.value&&v.value!==""&&N.append("password",v.value),P.value.length!==0&&N.append("image",P.value[0].file);for(let[M,W]of N.entries())console.log(`${M}:`,W);if(N.get("username")===null&&N.get("password")===null&&N.get("image")===null){_({text:"沒有任何變更",snackbarProps:{color:"accent"}});return}console.log(N);const x=await F.patch("/user/change",N);x.data.success?(_({text:"資料修改成功",snackbarProps:{color:"green"}}),pe.push("/")):_({text:x.data.message||"發生錯誤",snackbarProps:{color:"red"}})}catch(j){_({text:((E=(D=j==null?void 0:j.response)==null?void 0:D.data)==null?void 0:E.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),y=D=>{D.isEditing=!D.isEditing},w=D=>{D.isEditing=!1},O=D=>{D.passwordisEditing=!D.passwordisEditing},le=D=>{D.passwordisEditing=!1};return(D,E)=>{const j=de("vue-file-agent"),N=ot;return V(),ce(me,{flat:""},{default:t(()=>[e(Me,{onSubmit:Ue(s(p),["prevent"]),disabled:s(T)},{default:t(()=>[e(ze,{class:"pa-0 pa-sm-2"},{default:t(()=>[n("div",Yt,[e(Ze,{color:"info",class:"mb-10 rounded-t-lg bb-1",prominent:""},{default:t(()=>[e(Je,{class:"ms-0 font-weight-bold",style:{"font-size":"23px",color:"#616161"}},{default:t(()=>[R("基本資料")]),_:1})]),_:1}),e(j,{id:"account",class:"d-flex justify-center mb-5",accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"上傳大頭照","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},modelValue:P.value,"onUpdate:modelValue":E[0]||(E[0]=x=>P.value=x),"raw-model-value":h.value,"onUpdate:rawModelValue":E[1]||(E[1]=x=>h.value=x),ref_key:"fileAgent",ref:G},null,8,["modelValue","raw-model-value"]),e(we,null,{default:t(()=>[e(H,{class:"text-left justify-center"},{default:t(()=>[e(o,{cols:"0",md:"1",lg:"2"}),e(o,{cols:"4",md:"3",lg:"3",class:"info-text my-auto pl-8 pl-sm-13 pl-md-0 pl-lg-12"},{default:t(()=>[R("服務單位")]),_:1}),(V(!0),L(Y,null,te(U.value,x=>(V(),L(Y,{key:x.id},[e(o,{cols:"5",md:"4",lg:"4",class:"px-0 my-auto"},{default:t(()=>[x.isEditing?(V(),ce(Oe,{key:1,class:"my-auto",variant:"outlined","single-line":"",density:"compact",clearable:"",dense:"",modelValue:s(A),"onUpdate:modelValue":E[2]||(E[2]=M=>Le(A)?A.value=M:null),"error-messages":s(m),onKeydown:_e(M=>w(x),["enter"]),"hide-details":""},null,8,["modelValue","error-messages","onKeydown"])):(V(),L("p",Zt,$(x.username),1))]),_:2},1024),e(o,{cols:"3",md:"2",lg:"2",class:"text-center text-sm-left"},{default:t(()=>[e(X,{onClick:M=>y(x),icon:"mdi-pencil",variant:"text",color:"blue-grey-darken-1"},null,8,["onClick"])]),_:2},1024)],64))),128)),e(se)]),_:1}),e(H,{class:"text-left justify-center"},{default:t(()=>[e(o,{cols:"0",md:"1",lg:"2"}),e(o,{cols:"4",md:"3",lg:"3",class:"info-text my-auto pl-8 pl-sm-13 pl-md-0 pl-lg-12"},{default:t(()=>[R("電子信箱")]),_:1}),(V(!0),L(Y,null,te(U.value,x=>(V(),ce(o,{key:x.id,cols:"5",md:"4",lg:"4",class:"px-0 my-auto"},{default:t(()=>[n("p",Jt,$(x.email),1)]),_:2},1024))),128)),e(o,{cols:"3",md:"2",lg:"2",class:"text-center"},{default:t(()=>[e(X,{onClick:E[3]||(E[3]=x=>O(D.item)),icon:"mdi-pencil",variant:"text",color:"transparent",disabled:""})]),_:1}),e(se)]),_:1}),e(H,{class:"text-left justify-center"},{default:t(()=>[e(o,{cols:"0",md:"1",lg:"2"}),e(o,{cols:"4",md:"3",lg:"3",class:"info-text my-auto pl-8 pl-sm-13 pl-md-0 pl-lg-12"},{default:t(()=>[R("密碼")]),_:1}),(V(!0),L(Y,null,te(U.value,x=>(V(),L(Y,{key:x.id},[e(o,{cols:"5",md:"4",lg:"4",class:"px-0 my-auto"},{default:t(()=>[x.passwordisEditing?(V(),ce(Oe,{key:1,class:"info-text",variant:"outlined","single-line":"",density:"compact",clearable:"",dense:"",modelValue:s(v),"onUpdate:modelValue":E[4]||(E[4]=M=>Le(v)?v.value=M:null),"error-messages":s(c),onKeydown:_e(M=>le(x),["enter"]),"hide-details":""},null,8,["modelValue","error-messages","onKeydown"])):(V(),L("p",Xt,$(x.password),1))]),_:2},1024),e(o,{cols:"3",md:"2",lg:"2",class:"text-center text-sm-left"},{default:t(()=>[e(X,{onClick:M=>O(x),icon:"mdi-pencil",variant:"text",color:"blue-grey-darken-1"},null,8,["onClick"])]),_:2},1024)],64))),128)),e(se)]),_:1}),e(H,null,{default:t(()=>[e(o,{class:"my-md-5"},{default:t(()=>[e(N,{text:"提交",class:"mx-auto my-1 bg-accent text-body-1 d-inline-block",width:"80",height:"30"})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})}}},tl=qe(el,[["__scopeId","data-v-6729d73a"]]),ll=S=>(Fe("data-v-71aa44fe"),S=S(),De(),S),al={class:"b-1 w-75 mx-auto my-8"},sl=ll(()=>n("h2",{class:"bb-1 bg-accent text-center mx-auto py-1 mb-5"},"索取者聯絡資訊",-1)),ol={__name:"shareReplyTable",setup(S){const{api:pe,apiAuth:F}=ve(),_=ge(),G=r(8),P=r([{key:"createdAt",order:"desc"}]),h=r(1),U=r([]),B=[{title:"物資",align:"center",sortable:!1,key:"image"},{title:"索取者聯絡資訊",align:"center",sortable:!1,key:"donations"}],I=r(!0),C=r(0),T=async A=>{var m,v,c,p;A&&(h.value=1),I.value=!0;try{const{data:y}=await F.get("/user/share",{params:{page:h.value,itemsPerPage:G.value,sortBy:((m=P.value[0])==null?void 0:m.key)||"createdAt",sortOrder:((v=P.value[0])==null?void 0:v.order)||"desc"}});console.log(y.result.data);const w=y.result.data.filter(O=>O.donations&&O.donations.length>0);U.value.splice(0,U.value.length,...w),C.value=w.length}catch(y){console.log(y),_({text:((p=(c=y==null?void 0:y.response)==null?void 0:c.data)==null?void 0:p.message)||"發生錯誤",snackbarProps:{color:"red"}})}I.value=!1};return T(),(A,m)=>{const v=de("router-link");return V(),L("div",al,[sl,e(he,{"items-per-page":G.value,"onUpdate:itemsPerPage":[m[0]||(m[0]=c=>G.value=c),m[3]||(m[3]=c=>T(!1))],"sort-by":P.value,"onUpdate:sortBy":[m[1]||(m[1]=c=>P.value=c),m[4]||(m[4]=c=>T(!1))],page:h.value,"onUpdate:page":[m[2]||(m[2]=c=>h.value=c),m[5]||(m[5]=c=>T(!1))],items:U.value,headers:B,loading:I.value,"items-length":C.value,hover:"",class:"mb-15 px-8 rounded-lg"},{"item.image":t(({item:c})=>[e(o,{cols:"12",md:"4",class:"mx-auto",style:{width:"300px"}},{default:t(()=>[e(v,{to:"/material/share/"+c._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ke,{src:c.image,width:"250px","max-height":"200px",class:"my-5"},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024)]),"item.donations":t(({item:c})=>[e(o,null,{default:t(()=>[(V(!0),L(Y,null,te(c.donations,(p,y)=>(V(),ce(me,{class:"mb-2",outlined:"",variant:"text",key:y},{default:t(()=>[e(Ve,null,{default:t(()=>[e(H,{"no-gutters":""},{default:t(()=>[e(o,{cols:"3",class:"text-body-1 text-left"},{default:t(()=>[R("數量: "+$(p.quantity),1)]),_:2},1024),e(o,{cols:"5",class:"text-body-1 text-left"},{default:t(()=>[R("服務單位: "+$(p.donator),1)]),_:2},1024),e(o,{cols:"4",class:"text-body-1 text-left"},{default:t(()=>[R("聯絡電話: "+$(p.phone),1)]),_:2},1024)]),_:2},1024),e(se,{class:"100%"})]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length"])])}}},nl=qe(ol,[["__scopeId","data-v-71aa44fe"]]),rl=S=>(Fe("data-v-8c0c0b4e"),S=S(),De(),S),dl={class:"b-1 w-75 mx-auto"},ul=rl(()=>n("h2",{class:"bb-1 bg-accent text-center mx-auto py-1 mb-5"},"捐贈者聯絡資訊",-1)),il={__name:"findReplyTable",setup(S){const{api:pe,apiAuth:F}=ve(),_=ge(),G=r(8),P=r([{key:"createdAt",order:"desc"}]),h=r(1),U=r([]),B=[{title:"物資",align:"center",sortable:!1,key:"image"},{title:"捐贈者聯絡資訊",align:"center",sortable:!1,key:"donations"}],I=r(!0),C=r(0),T=async A=>{var m,v,c,p;A&&(h.value=1),I.value=!0;try{const{data:y}=await F.get("/user/find",{params:{page:h.value,itemsPerPage:G.value,sortBy:((m=P.value[0])==null?void 0:m.key)||"createdAt",sortOrder:((v=P.value[0])==null?void 0:v.order)||"desc"}});console.log(y.result.data);const w=y.result.data.filter(O=>O.donations&&O.donations.length>0);U.value.splice(0,U.value.length,...w),C.value=w.length}catch(y){console.log(y),_({text:((p=(c=y==null?void 0:y.response)==null?void 0:c.data)==null?void 0:p.message)||"發生錯誤",snackbarProps:{color:"red"}})}I.value=!1};return T(),(A,m)=>{const v=de("router-link");return V(),L("div",dl,[ul,e(he,{"items-per-page":G.value,"onUpdate:itemsPerPage":[m[0]||(m[0]=c=>G.value=c),m[3]||(m[3]=c=>T(!1))],"sort-by":P.value,"onUpdate:sortBy":[m[1]||(m[1]=c=>P.value=c),m[4]||(m[4]=c=>T(!1))],page:h.value,"onUpdate:page":[m[2]||(m[2]=c=>h.value=c),m[5]||(m[5]=c=>T(!1))],items:U.value,headers:B,loading:I.value,"items-length":C.value,hover:"",class:"mb-15 px-8 rounded-lg"},{"item.image":t(({item:c})=>[e(o,{cols:"12",md:"4",class:"mx-auto",style:{width:"250px"}},{default:t(()=>[e(v,{to:"/material/find/"+c._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ke,{src:c.image,width:"250px","max-height":"150px",class:"my-5"},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024)]),"item.donations":t(({item:c})=>[e(o,null,{default:t(()=>[(V(!0),L(Y,null,te(c.donations,(p,y)=>(V(),ce(me,{class:"mb-2",outlined:"",variant:"text",key:y},{default:t(()=>[e(Ve,null,{default:t(()=>[e(H,{"no-gutters":""},{default:t(()=>[e(o,{cols:"3",class:"text-body-1 text-left"},{default:t(()=>[R("數量: "+$(p.quantity),1)]),_:2},1024),e(o,{cols:"5",class:"text-body-1 text-left"},{default:t(()=>[R("服務單位: "+$(p.donator),1)]),_:2},1024),e(o,{cols:"4",class:"text-body-1 text-left"},{default:t(()=>[R("聯絡電話: "+$(p.phone),1)]),_:2},1024)]),_:2},1024),e(se,{class:"100%"})]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length"])])}}},cl=qe(il,[["__scopeId","data-v-8c0c0b4e"]]),ml={class:"b-1 w-75 mx-auto"},pl=n("h2",{class:"bg-accent text-center mx-auto bb-1 py-1"},"地標管理",-1),gl={style:{width:"240px"}},vl={style:{width:"120px"}},fl={style:{width:"300px"},class:"text-left"},yl={style:{width:"200px"},class:"text-center"},bl={style:{width:"350px"},class:"py-2 text-left"},xl={style:{width:"80px"}},_l={class:"px-6 my-2"},kl=n("label",{class:"form-label"},"服務地址",-1),Vl=n("label",{class:"form-label"},"服務名稱",-1),hl=n("label",{class:"form-label"},"服務電話",-1),wl=n("label",{class:"form-label"},"服務項目",-1),$l=n("p",null,"服務對象",-1),Pl=n("p",null,"長期照顧",-1),Ul=n("p",null,"身心障礙",-1),Sl=n("p",null,"兒童及少年",-1),Cl=n("p",null,"社會救助",-1),Ml=n("p",null,"婦女",-1),ql=n("p",null,"其他",-1),Il=n("label",{class:"form-label"},"服務介紹",-1),Tl={__name:"landmarkTable",setup(S){const{api:pe,apiAuth:F}=ve(),_=ge(),G=["長期照顧","身心障礙","婦女","兒童及少年","保護性服務"],P=["日照中心","護理之家","居家服務","交通接送","家庭托顧"],h=["身心障礙者服務中心","輔具中心","職業重建中心","小作所","庇護工場"],U=["少年福利服務中心","親子館","課後班"],B=["經濟補助","待用餐","基金會","社會福利中心"],I=["婦女福利服務中心","新住民家庭服務中心"],C=r(10),T=r([{key:"createdAt",order:"desc"}]),A=r(1),m=r([]),v=[{title:"服務名稱",align:"center",sortable:!1,key:"name"},{title:"地址",align:"center",sortable:!0,key:"address"},{title:"聯絡電話",align:"center",sortable:!1,key:"tel"},{title:"服務項目",align:"center",sortable:!0,key:"categories"},{title:"服務介紹",align:"center",sortable:!1,key:"description"},{title:"操作",align:"center",sortable:!1,key:"action"}],c=r(!0),p=r(0),y=r(""),w=async K=>{var g,ee,Q,ae;K&&(A.value=1),c.value=!0;try{const{data:ne}=await F.get("/user/landmark",{params:{page:A.value,itemsPerPage:C.value,sortBy:((g=T.value[0])==null?void 0:g.key)||"createdAt",sortOrder:((ee=T.value[0])==null?void 0:ee.order)||"desc",search:y.value}});console.log(ne),m.value.splice(0,m.value.length,...ne.result.data),p.value=ne.result.total}catch(ne){console.log(ne),_({text:((ae=(Q=ne==null?void 0:ne.response)==null?void 0:Q.data)==null?void 0:ae.message)||"發生錯誤",snackbarProps:{color:"red"}})}c.value=!1};w();const O=r({open:!1}),le=K=>{O.value.open=!0,O.value.id=K._id,M.value.value=K.name,W.value.value=K.tel,f.value.value=K.description},D=()=>{O.value.open=!1,x()},E=Se({name:z().required("服務單位必填"),address:z().required("服務地址必填"),tel:z(),category5:fe().of(z()).required("分類必填"),category2:fe().of(z()).required("分類必填"),category3:fe().of(z()).required("分類必填"),category4:fe().of(z()).required("分類必填"),category5:fe().of(z()).required("分類必填"),category6:fe().of(z()).required("分類必填"),category7:fe().of(z()).required("分類必填"),description:z()}),{handleSubmit:j,isSubmitting:N,resetForm:x}=Ce({validationSchema:E,initialValues:{name:"",address:"",tel:"",category1:[],category2:[],category3:[],category4:[],category5:[],category6:[],category7:[],description:""}}),M=q("name"),W=q("tel"),Z=q("category1"),J=q("category2"),ue=q("category3"),ie=q("category4"),u=q("category5"),l=q("category6"),k=q("category7"),f=q("description"),{value:i,errorMessage:b}=q("address"),a="AIzaSyAyML8H2ENbc_kzs_ZSI6qYf7CCbBt0dAA";console.log(a);const oe=r(null),Ke=r(null),He=async()=>{if(!i.value){alert("找不到地址~");return}const K=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(i.value)}&key=${a}`;try{const ee=(await at.get(K)).data;if(console.log(ee),ee.results&&ee.results.length>0){const Q=ee.results[0].geometry.location.lat,ae=ee.results[0].geometry.location.lng;oe.value=Q,Ke.value=ae,console.log(oe.value),console.log(ee.results),console.log(Q),console.log(ae)}else alert("找不到地址~")}catch(g){console.error("新增地標錯誤:",g),alert("新增地標失敗~")}},Xe=j(async K=>{var g,ee;try{await He(),console.log(oe.value);const Q=[...K.category1,...K.category2,...K.category3,...K.category4,...K.category5,...K.category6,...K.category7],ae={name:K.name,address:K.address,tel:K.tel,categories:Q,description:K.description,lat:oe.value,lng:Ke.value};console.log(ae),await F.patch("landmark/"+O.value.id,ae),_({text:"修改成功",snackbarProps:{color:"green"}}),D(),x(),w(!0)}catch(Q){console.log(Q),_({text:((ee=(g=Q==null?void 0:Q.response)==null?void 0:g.data)==null?void 0:ee.message)||"發生錯誤",snackbarProps:{color:"red"}})}});Ae(y,()=>{w(!0)});const et=async K=>{var g,ee;try{await F.delete(`/landmark/${K._id}`),_({text:"刪除成功",snackbarProps:{color:"green"}}),w(!0)}catch(Q){console.log(Q),_({text:((ee=(g=Q==null?void 0:Q.response)==null?void 0:g.data)==null?void 0:ee.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return(K,g)=>{const ee=Pe,Q=Pe,ae=Ee,ne=nt;return V(),L(Y,null,[n("div",ml,[pl,e(he,{"items-per-page":C.value,"onUpdate:itemsPerPage":[g[3]||(g[3]=d=>C.value=d),g[6]||(g[6]=d=>w(!1))],"sort-by":T.value,"onUpdate:sortBy":[g[4]||(g[4]=d=>T.value=d),g[7]||(g[7]=d=>w(!1))],page:A.value,"onUpdate:page":[g[5]||(g[5]=d=>A.value=d),g[8]||(g[8]=d=>w(!1))],items:m.value,headers:v,loading:c.value,"items-length":p.value,search:y.value,hover:"",class:"mx-auto mb-15 px-8 text-body-1 rounded-lg"},{top:t(()=>[e(ee,{class:"my-5",modelValue:y.value,"onUpdate:modelValue":g[0]||(g[0]=d=>y.value=d),onClickAppend:g[1]||(g[1]=d=>w(!0)),onKeydown:g[2]||(g[2]=_e(d=>w(!0),["enter"])),"max-width":"100%"},null,8,["modelValue"])]),"item.name":t(({item:d})=>[n("td",gl,$(d.name),1)]),"item.tel":t(({item:d})=>[n("td",vl,$(d.tel),1)]),"item.address":t(({item:d})=>[n("td",fl,$(d.address),1)]),"item.categories":t(({item:d})=>[n("td",yl,$(d.categories.join(" , ")),1)]),"item.description":t(({item:d})=>[n("td",bl,$(d.description),1)]),"item.action":t(({item:d})=>[n("td",xl,[R($(d.action)+" ",1),e(X,{icon:"mdi-pencil",variant:"text",color:"grey-darken-2",onClick:tt=>le(d)},null,8,["onClick"]),e(X,{icon:"mdi-delete",variant:"text",color:"red-darken-4",onClick:tt=>et(d)},null,8,["onClick"])])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),e(Be,{"max-width":"700",modelValue:O.value.open,"onUpdate:modelValue":g[20]||(g[20]=d=>O.value.open=d)},{default:t(()=>[e(me,null,{default:t(()=>[e(Ze,{color:"secondary",prominent:"",class:"bb-1",height:"55"},{default:t(()=>[e(Je,{class:"mt-3 text-center"},{default:t(()=>[R(" 修改地標 ")]),_:1})]),_:1}),n("div",_l,[e(Me,{onSubmit:Ue(s(Xe),["prevent"]),disabled:s(N)},{default:t(()=>[e(H,{class:"my-1"},{default:t(()=>[e(o,{cols:"12",md:"3",class:"my-auto text-center ps-6"},{default:t(()=>[kl]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(Q,{modelValue:s(i),"onUpdate:modelValue":g[9]||(g[9]=d=>Le(i)?i.value=d:null),"error-messages":s(b),label:"輸入資源地址","max-width":"1000px"},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-center ps-6"},{default:t(()=>[Vl]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(ae,{modelValue:s(M).value.value,"onUpdate:modelValue":g[10]||(g[10]=d=>s(M).value.value=d),"error-messages":s(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"my-auto text-center ps-6"},{default:t(()=>[hl]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(ae,{modelValue:s(W).value.value,"onUpdate:modelValue":g[11]||(g[11]=d=>s(W).value.value=d),"error-messages":s(W).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",md:"3",class:"mt-2 text-center ps-6"},{default:t(()=>[wl]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(rt,{variant:"accordion"},{default:t(()=>[e(dt,{title:"選擇類別"},{default:t(()=>[e(ut,null,{default:t(()=>[e(we,null,{default:t(()=>[e(H,null,{default:t(()=>[e(o,null,{default:t(()=>[$l,n("div",null,[e(ye,{modelValue:s(Z).value.value,"onUpdate:modelValue":g[12]||(g[12]=d=>s(Z).value.value=d),"error-messages":s(Z).errorMessage.value,column:"",multiple:""},{default:t(()=>[(V(),L(Y,null,te(G,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(o,null,{default:t(()=>[Pl,n("div",null,[e(ye,{modelValue:s(J).value.value,"onUpdate:modelValue":g[13]||(g[13]=d=>s(J).value.value=d),"error-messages":s(J).errorMessage.value,column:"",multiple:""},{default:t(()=>[(V(),L(Y,null,te(P,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(o,null,{default:t(()=>[Ul,n("div",null,[e(ye,{modelValue:s(ue).value.value,"onUpdate:modelValue":g[14]||(g[14]=d=>s(ue).value.value=d),"error-messages":s(ue).errorMessage.value,column:"",multiple:""},{default:t(()=>[(V(),L(Y,null,te(h,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(o,null,{default:t(()=>[Sl,n("div",null,[e(ye,{modelValue:s(ie).value.value,"onUpdate:modelValue":g[15]||(g[15]=d=>s(ie).value.value=d),"error-messages":s(ie).errorMessage.value,column:"",multiple:""},{default:t(()=>[(V(),L(Y,null,te(U,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(o,null,{default:t(()=>[Cl,n("div",null,[e(ye,{modelValue:s(u).value.value,"onUpdate:modelValue":g[16]||(g[16]=d=>s(u).value.value=d),"error-messages":s(u).errorMessage.value,column:"",multiple:""},{default:t(()=>[(V(),L(Y,null,te(B,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(o,null,{default:t(()=>[Ml,n("div",null,[e(ye,{modelValue:s(k).value.value,"onUpdate:modelValue":g[17]||(g[17]=d=>s(k).value.value=d),"error-messages":s(k).errorMessage.value,column:"",multiple:""},{default:t(()=>[(V(),L(Y,null,te(I,d=>e(be,{text:d,value:d,filter:"",density:"compact"},null,8,["text","value"])),64))]),_:1},8,["modelValue","error-messages"])]),e(se)]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(o,null,{default:t(()=>[ql,e(ye,{modelValue:s(l).value.value,"onUpdate:modelValue":g[18]||(g[18]=d=>s(l).value.value=d),"error-messages":s(l).errorMessage.value,column:"",multiple:""},{default:t(()=>[e(be,{value:"其他",text:"其他",filter:"",density:"compact"})]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(o,{cols:"12",md:"3",class:"text-center ps-6"},{default:t(()=>[Il]),_:1}),e(o,{cols:"12",md:"9"},{default:t(()=>[e(Ye,{style:{"white-space":"pre-line"},variant:"outlined",clearable:"",modelValue:s(f).value.value,"onUpdate:modelValue":g[19]||(g[19]=d=>s(f).value.value=d),"error-messages":s(f).errorMessage.value,"hide-details":""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(o,{class:"text-center"},{default:t(()=>[e(ne,{text:"修改",type:"submit",class:"b-1 bg-accent mb-8",onClick:He})]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])])]),_:1})]),_:1},8,["modelValue"])],64)}}},Al=S=>(Fe("data-v-f09eb7b7"),S=S(),De(),S),zl={key:0,class:"horizontal-drawer"},Bl={class:"d-flex flex-row h-100"},Fl={class:"mx-auto mb-5 rounded-lg"},Dl={class:"mx-auto mb-5 rounded-lg"},El={class:"mx-auto mb-5 rounded-lg"},Ll=Al(()=>n("h1",null,"暫無任何活動收藏",-1)),Rl={class:"mx-auto mb-5 rounded-lg"},jl={__name:"setting",setup(S){const{api:pe,apiAuth:F}=ve(),_=ge();r(null),r([]),r([]);const G=r([{title:"會員中心",disabled:!1,href:"/setting"},{title:"地標管理",disabled:!0}]),P=r([{title:"會員中心",disabled:!1,href:"/setting"},{title:"貼文管理",disabled:!0}]),h=r([{title:"會員中心",disabled:!1,href:"/setting"},{title:"活動收藏",disabled:!0}]),U=r([{title:"會員中心",disabled:!1,href:"/setting"},{title:"物資管理",disabled:!0}]),B=r("option-1"),I=r("true"),C=r([]),T=async()=>{try{const{data:m}=await F.get("/user/mark");C.value=m.map(v=>({...v,isFavorite:!0}))}catch(m){console.error("Failed to fetch favorite event details:",m)}},A=async m=>{try{await F.patch("/user/mark",{eventId:m}),C.value=C.value.filter(v=>v._id!==m),_({text:"取消收藏",snackbarProps:{color:"info"}})}catch(v){console.error("取消收藏失败",v),_({text:"取消收藏失败",snackbarProps:{color:"red"}})}};return st(()=>{T()}),(m,v)=>{const c=de("router-link");return V(),L(Y,null,[m.$vuetify.display.xs||m.$vuetify.display.sm?(V(),L("div",zl,[e(Ge,{modelValue:B.value,"onUpdate:modelValue":v[0]||(v[0]=p=>B.value=p),color:"teal-darken-4",direction:"horizontal","show-arrows":""},{default:t(()=>[e(re,{"prepend-icon":"mdi-account",text:"基本資料",value:"option-1"}),e(re,{"prepend-icon":"mdi-lock",text:"地標管理",value:"option-2"}),e(re,{"prepend-icon":"mdi-access-point",text:"貼文管理",value:"option-3"}),e(re,{"prepend-icon":"mdi-book-cog",text:"活動收藏",value:"option-4"}),e(re,{"prepend-icon":"mdi-package-variant-closed-check",text:"物資管理",value:"option-5"})]),_:1},8,["modelValue"])])):(V(),ce(ct,{key:1,class:"b-1 text-center bg-primary",width:m.$vuetify.display.xs?"100%":"250",permanent:""},{default:t(()=>[n("div",null,[e(Ge,{modelValue:B.value,"onUpdate:modelValue":v[1]||(v[1]=p=>B.value=p),color:"teal-darken-4",direction:"vertical","show-arrows":""},{default:t(()=>[e(re,{"prepend-icon":"mdi-account",text:"基本資料",value:"option-1",height:"100",class:"text-body-1 ms-1"}),e(re,{"prepend-icon":"mdi-lock",text:"地標管理",value:"option-2",height:"100",class:"text-body-1 ms-1"}),e(re,{"prepend-icon":"mdi-access-point",text:"貼文管理",value:"option-3",height:"100",class:"text-body-1 ms-1"}),e(re,{"prepend-icon":"mdi-book-cog",text:"活動收藏",value:"option-4",height:"100",class:"text-body-1 ms-1"}),e(re,{"prepend-icon":"mdi-package-variant-closed-check",text:"物資管理",value:"option-5",height:"100",class:"text-body-1 ms-1"})]),_:1},8,["modelValue"])])]),_:1},8,["width"])),e(me,{class:"h-100"},{default:t(()=>[n("div",Bl,[e(we,null,{default:t(()=>[e(it,{modelValue:B.value,"onUpdate:modelValue":v[2]||(v[2]=p=>B.value=p),class:"mt-10"},{default:t(()=>[e($e,{value:"option-1"},{default:t(()=>[e(tl)]),_:1}),e($e,{value:"option-2"},{default:t(()=>[e(Te,{items:G.value},{divider:t(()=>[e(Ie,{icon:"mdi-chevron-right"})]),_:1},8,["items"]),e(Tl)]),_:1}),e($e,{value:"option-3"},{default:t(()=>[e(Te,{items:P.value},{divider:t(()=>[e(Ie,{icon:"mdi-chevron-right"})]),_:1},8,["items"]),n("div",Fl,[e(Qt)]),n("div",Dl,[e(Dt)]),n("div",El,[e(Ut)])]),_:1}),e($e,{value:"option-4"},{default:t(()=>[e(Te,{items:h.value},{divider:t(()=>[e(Ie,{icon:"mdi-chevron-right"})]),_:1},8,["items"]),(V(!0),L(Y,null,te(C.value,p=>(V(),L("div",{class:"w-66 mx-auto rounded-lg my-5",style:{border:"1.2px solid #000"},key:p._id},[e(me,{variant:"flat",class:"rounded-lg",style:{"background-color":"#f7f2e9"}},{default:t(()=>[e(H,{class:"align-center my-4 ps-8"},{default:t(()=>[e(o,{cols:"3",class:"align-self-start"},{default:t(()=>[e(c,{to:"/event/"+p._id,style:{"text-decoration":"none"}},{default:t(()=>[e(ke,{src:p.image,class:"b-1 rounded-lg",width:"200px",height:"220px",cover:""},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024),e(o,{cols:"7",class:"align-self-start"},{default:t(()=>[e(Ve,{class:"text-h6 font-weight-black"},{default:t(()=>[R($(p.title),1)]),_:2},1024),e(We,{class:"text-body-1 font-weight-bold"},{default:t(()=>[R($(p.organizer),1)]),_:2},1024),e(We,{class:"text-body-1 font-weight-bold mt-2"},{default:t(()=>[R($(p.date),1)]),_:2},1024)]),_:2},1024),e(o,{cols:"2",class:"align-self-start mt-2"},{default:t(()=>[I.value?(V(),ce(X,{key:0,id:"btn",text:"取消收藏","prepend-icon":"mdi-bookmark",variant:"outlined",style:{"background-color":"#F5B4B4"},onClick:y=>A(p._id),class:"font-weight-black",width:"120",height:"35"},null,8,["onClick"])):Ne("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),C.value.length==0?(V(),ce(H,{key:0},{default:t(()=>[e(o,{class:"text-center mt-15",style:{color:"#bfbfbf"}},{default:t(()=>[Ll]),_:1})]),_:1})):Ne("",!0)]),_:1}),e($e,{value:"option-5"},{default:t(()=>[e(Te,{items:U.value},{divider:t(()=>[e(Ie,{icon:"mdi-chevron-right"})]),_:1},8,["items"]),n("div",Rl,[e(nl),e(cl)])]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})],64)}}},ia=qe(jl,[["__scopeId","data-v-f09eb7b7"]]);export{ia as default};
