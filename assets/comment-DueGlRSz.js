import{H as me,aa as ve,ab as fe,L as pe,_ as be,s as c,ac as Y,ad as he,a2 as ye,X as ge,O as _e,j as Z,b as e,F as V,B as ue,m as I,ae as ee,i as we,a3 as xe,n as S,t as ke,o as h,e as te,w as o,l as m,c as k,v as ae,af as ne,z as le,C as q,a as F,ag as Ve,x as Ie,f as Ce,g as B,p as $e,E as Pe,G as Ne}from"./index-Cu09DPhf.js";import{a as A}from"./VContainer-DNvbWgCk.js";import{b as De,c as ze,a as Se,u as Fe,V as Be}from"./index.esm-DbtNw748.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as M,V as K}from"./VRow-zsq4zUFh.js";import{V as se}from"./VTextarea-B7rFbkbh.js";import{b as Ae,V as Ee,a as oe,c as re}from"./_commonjsHelpers-cHHQvOu9.js";const Ue=me({controlVariant:{type:String,default:"default"},inset:Boolean,hideInput:Boolean,min:{type:Number,default:-1/0},max:{type:Number,default:1/0},step:{type:Number,default:1},...ve(fe(),["appendInnerIcon","prependInnerIcon"])},"VNumberInput"),rt=pe()({name:"VNumberInput",props:{...Ue()},emits:{"update:modelValue":a=>!0},setup(a,y){let{attrs:v,emit:H,slots:i}=y;const l=be(a,"modelValue"),E=c(()=>Y(a.step)),_=c(()=>l.value!=null?Y(l.value):0),f=he(),b=c(()=>a.disabled||a.readonly||(f==null?void 0:f.isReadonly.value)),C=c(()=>b.value?!1:l.value==null?!0:l.value+a.step<=a.max),$=c(()=>b.value?!1:l.value==null?!0:l.value-a.step>=a.min);ye(()=>{b.value||l.value!=null&&(l.value<a.min||l.value>a.max)&&(l.value=ge(l.value,a.min,a.max))});const d=c(()=>a.hideInput?"stacked":a.controlVariant),U=c(()=>d.value==="split"?"$plus":"$collapse"),g=c(()=>d.value==="split"?"$minus":"$expand"),P=c(()=>d.value==="split"?"default":"small"),w=c(()=>d.value==="stacked"?"auto":"100%"),j=c(()=>({click:T})),L=c(()=>({click:n}));function x(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(b.value)return;if(l.value==null){l.value=0;return}const R=Math.max(_.value,E.value);u?C.value&&(l.value=+(l.value+a.step).toFixed(R)):$.value&&(l.value=+(l.value-a.step).toFixed(R))}function T(u){u.stopPropagation(),x()}function n(u){u.stopPropagation(),x(!1)}function s(u){if(!(["Enter","ArrowLeft","ArrowRight","Backspace","Delete","Tab"].includes(u.key)||u.ctrlKey)){if(["ArrowDown"].includes(u.key)){u.preventDefault(),x(!1);return}if(["ArrowUp"].includes(u.key)){u.preventDefault(),x();return}/^[0-9\-+.]+$/.test(u.key)||u.preventDefault()}}function t(u){l.value=u?+u:void 0}function r(u){u.stopPropagation()}_e(()=>{const{modelValue:u,...R}=Z.filterProps(a);function G(){return i.increment?e(ee,{key:"increment-defaults",defaults:{VBtn:{disabled:!C.value,flat:!0,height:w.value,size:P.value,icon:U.value}}},{default:()=>[i.increment(j.value)]}):e(I,{disabled:!C.value,flat:!0,key:"increment-btn",height:w.value,name:"increment-btn",icon:U.value,onClick:T,onMousedown:r,size:P.value,tabindex:"-1"},null)}function O(){return i.decrement?e(ee,{key:"decrement-defaults",defaults:{VBtn:{disabled:!$.value,flat:!0,height:w.value,size:P.value,icon:g.value}}},{default:()=>[i.decrement(L.value)]}):e(I,{disabled:!$.value,flat:!0,key:"decrement-btn",height:w.value,name:"decrement-btn",icon:g.value,size:P.value,tabindex:"-1",onClick:n,onMousedown:r},null)}function X(){return e("div",{class:"v-number-input__control"},[O(),e(A,{vertical:d.value!=="stacked"},null),G()])}function J(){return!a.hideInput&&!a.inset?e(A,{vertical:!0},null):void 0}const Q=d.value==="split"?e("div",{class:"v-number-input__control"},[e(A,{vertical:!0},null),G()]):a.reverse?void 0:e(V,null,[J(),X()]),de=i["append-inner"]||Q,W=d.value==="split"?e("div",{class:"v-number-input__control"},[O(),e(A,{vertical:!0},null)]):a.reverse?e(V,null,[X(),J()]):void 0,ce=i["prepend-inner"]||W;return e(Z,ue({modelValue:l.value,"onUpdate:modelValue":t,onKeydown:s,class:["v-number-input",{"v-number-input--default":d.value==="default","v-number-input--hide-input":a.hideInput,"v-number-input--inset":a.inset,"v-number-input--reverse":a.reverse,"v-number-input--split":d.value==="split","v-number-input--stacked":d.value==="stacked"},a.class]},R,{style:a.style,inputmode:"decimal"}),{...i,"append-inner":de?function(){var z;for(var N=arguments.length,D=new Array(N),p=0;p<N;p++)D[p]=arguments[p];return e(V,null,[(z=i["append-inner"])==null?void 0:z.call(i,...D),Q])}:void 0,"prepend-inner":ce?function(){var z;for(var N=arguments.length,D=new Array(N),p=0;p<N;p++)D[p]=arguments[p];return e(V,null,[W,(z=i["prepend-inner"])==null?void 0:z.call(i,...D)])}:void 0})})}}),ie=a=>(Pe("data-v-b73f979c"),a=a(),Ne(),a),Le=ie(()=>m("div",{class:"b-1 info-margin text-center text-body-1 pa-1 pa-sm-2 bg-accent rounded-t-lg font-weight-bold comment-tag"},"留言板",-1)),Te={class:"b-1 pa-5 info-margin"},Re={class:"pa-1 pa-md-4"},Ke={class:"ml-1 font-weight-bold name-fz"},He={key:0},je={class:"mt-4 ml-4 ml-sm-16 info-fz",style:{"white-space":"pre-line","word-wrap":"break-word"}},qe={key:1,class:"w-100 h-100 mt-4"},Ge={style:{height:"35px"},class:"w-100 w-sm-75 w-md-100 pe-2 text-end"},Oe={key:0,class:"text-center text-body-2 mt-4 mx-auto"},Xe=ie(()=>m("h1",{style:{color:"#bfbfbf"},class:"mb-15"}," 目前暫無任何留言 ",-1)),Je=[Xe],Qe={class:"pa-1 pa-md-4"},We={class:"ml-1 font-weight-bold name-fz"},Ye={style:{height:"35px"},class:"pe-2 text-end w-100 w-sm-75 w-md-100"},Ze={__name:"comment",setup(a){const{apiAuth:y}=$e(),v=we(),H=xe(),i=S([]),l=S([]),E=S(null),_=S(null),f=S(""),b=De("comment"),C=ze({comment:Se().required("留言內容必填")}),{handleSubmit:$,isSubmitting:d,resetForm:U}=Fe({validationSchema:C,initialValues:{comment:""}}),g=async()=>{var n,s;try{const{data:t}=await y.get("/comment/"+H.params.id);i.value=t.result}catch(t){console.log(t),v({text:((s=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:s.message)||"無法獲取留言",snackbarProps:{color:"red"}})}};ke(()=>{g()}),(async()=>{var n,s;try{const{data:t}=await y.get("/user/profile");l.value=[t.result],E.value=l.value[0].id}catch(t){v({text:((s=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:s.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const w=$(async n=>{var s,t;try{const r={content:n.comment,materialId:H.params.id};await y.post("comment/",r),v({text:"新增成功",snackbarProps:{color:"green"}}),U(),g()}catch(r){console.log(r),v({text:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),j=(n,s)=>{_.value=n,f.value=s},L=()=>{_.value=null,f.value=""},x=async()=>{var n,s;try{await y.patch(`/comment/${_.value}`,{content:f.value}),v({text:"留言已更新",snackbarProps:{color:"green"}}),g(),L()}catch(t){v({text:((s=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:s.message)||"更新留言時出錯",snackbarProps:{color:"red"}})}},T=async n=>{var s,t;try{await y.delete(`/comment/${n}`),v({text:"留言已刪除",snackbarProps:{color:"green"}}),g()}catch(r){v({text:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||"刪除留言時出錯",snackbarProps:{color:"red"}})}};return(n,s)=>(h(),te(K,{class:"mt-10"},{default:o(()=>[e(M,null,{default:o(()=>[Le,m("div",Te,[(h(!0),k(V,null,ae(i.value,t=>(h(),te(K,{key:t._id},{default:o(()=>[e(M,{cols:"10",md:"9"},{default:o(()=>[m("div",Re,[m("div",null,[e(ne,{color:"primary b-1",class:"me-3",size:n.$vuetify.display.xs?"default":"large"},{default:o(()=>[e(le,{src:t.user.avatar},null,8,["src"])]),_:2},1032,["size"]),m("span",Ke,q(t.user.username),1)]),_.value!==t._id?(h(),k("div",He,[m("p",je,q(t.content),1)])):(h(),k("div",qe,[e(se,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=r=>f.value=r),placeholder:"請輸入新的留言內容",variant:"outlined",rows:n.$vuetify.display.xs?"3":"4",clearable:!n.$vuetify.display.xs,"hide-details":"",class:"ms-1 w-100 w-sm-75 w-md-100 px-3 pb-3","auto-grow":"",maxlength:"150",style:{"word-break":"break-word"}},null,8,["modelValue","rows","clearable"]),m("div",Ge,[e(I,{onClick:r=>x(t._id),variant:"text",class:"rounded-md b-1 bg-primary me-2 d-inline-block",height:n.$vuetify.display.xs?"25":"30"},{default:o(()=>[F("儲存")]),_:2},1032,["onClick","height"]),e(I,{onClick:L,variant:"text",class:"rounded-md b-1 bg-info d-inline-block",height:n.$vuetify.display.xs?"25":"30"},{default:o(()=>[F("取消")]),_:1},8,["height"])])]))])]),_:2},1024),e(M,{cols:"2",md:"3",class:"text-end"},{default:o(()=>[e(Ae,{location:"end",class:"cursor-pointer"},Ve({default:o(()=>[e(Ee,{density:"comfortable"},{default:o(()=>[e(oe,null,{default:o(()=>[e(re,{onClick:r=>j(t._id,t.content),variant:"text"},{default:o(()=>[F("編輯")]),_:2},1032,["onClick"])]),_:2},1024),e(oe,null,{default:o(()=>[e(re,{onClick:r=>T(t._id),variant:"text"},{default:o(()=>[F("刪除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},[t.user._id==E.value?{name:"activator",fn:o(({props:r})=>[e(I,ue({icon:"mdi-dots-vertical",variant:"plain",ref_for:!0},r,{size:n.$vuetify.display.xs?"small":"default"}),null,16,["size"])]),key:"0"}:void 0]),1024)]),_:2},1024)]),_:2},1024))),128)),e(K,{class:"mt-4 mt-sm-5 mt-md-8 mt-lg-10 mb-2"},{default:o(()=>[i.value.length===0?(h(),k("div",Oe,Je)):Ie("",!0),e(A)]),_:1}),e(K,{class:"my-2"},{default:o(()=>[e(M,{cols:"12"},{default:o(()=>[(h(!0),k(V,null,ae(l.value,t=>(h(),k("div",Qe,[m("div",null,[e(ne,{color:"primary b-1",class:"me-3",size:n.$vuetify.display.xs?"default":"large"},{default:o(()=>[e(le,{src:t.avatar},null,8,["src"])]),_:2},1032,["size"]),m("span",We,q(t.username),1)])]))),256))]),_:1}),e(M,{cols:"12",md:"9"},{default:o(()=>[e(Be,{onSubmit:Ce(B(w),["prevent"]),disabled:B(d)},{default:o(()=>[e(se,{ref:"commentInput",modelValue:B(b).value.value,"onUpdate:modelValue":s[1]||(s[1]=t=>B(b).value.value=t),"error-messages":B(b).errorMessage.value,placeholder:"請輸入您的留言或提問",variant:"outlined",maxlength:"150",counter:"",clearable:!n.$vuetify.display.xs,rows:n.$vuetify.display.xs?"4":"5","auto-grow":"",class:"ms-1 w-100 w-sm-75 w-md-100 px-3 pb-1"},null,8,["modelValue","error-messages","clearable","rows"]),m("div",Ye,[e(I,{type:"submit",variant:"text",class:"rounded-md b-1 bg-accent",density:"comfortable",ripple:!1},{default:o(()=>[F("送出")]),_:1})])]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})])]),_:1})]),_:1}))}},ut=Me(Ze,[["__scopeId","data-v-b73f979c"]]);export{ut as C,rt as V};
