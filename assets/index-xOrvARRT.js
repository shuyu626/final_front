import{_ as oe}from"./search-B5QVEKXf.js";import{i as te,n as i,P as X,t as Y,o as r,e as g,w as a,l as U,p as le,q as ne,Q as se,g as B,b as e,x as D,a as k,R as re,m as C,c as L,v as Q,F as $,V as ce,C as O}from"./index-Cmg5EJpm.js";import{l as s}from"./all.min-DCGWzDV8.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ae}from"./VContainer-rTUoaqtf.js";import{V as I,a as S}from"./VRow-C0U_Zj0G.js";import{V as j,a as q}from"./VToolbar-C6VO4OvV.js";import{V as J}from"./VSelect-DKdnXkFj.js";import{V as R,a as Z,b as H,c as W}from"./VExpansionPanels-BhcC3sNz.js";import{V as ie}from"./VAppBar-BxoQb38q.js";import{V as de}from"./VNavigationDrawer-Cy5UADmv.js";import{V as G}from"./VCheckbox-BH_diFur.js";import"./_commonjsHelpers-D9ffGxaA.js";import"./ssrBoot-tKZiGofa.js";import"./VSlideGroup-DBRkrNvd.js";const ue={id:"map",ref:"map"},pe={__name:"leafletMap",props:{searchQuery:{type:String,default:""},selectedCity:{type:String,default:null},selectedArea:{type:String,default:null},selectedSubcategories:{type:Array,default:()=>[]}},setup(N){const _=te(),d=i(null),m=i([]),b=i([]),{api:z}=le(),n=N,M=()=>{d.value=s.map("map").setView([25.049183268037577,121.51342818384893],12),d.value?(s.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(d.value),d.value.eachLayer(u=>{u instanceof s.Control.Locate&&d.value.removeControl(u)}),s.control.locate({position:"topleft",drawCircle:!0,drawMarker:!0,markerStyle:{color:"black",opacity:.8,weight:.8},locateOptions:{enableHighAccuracy:!0,maxZoom:16},icon:"fa fa-solid fa-crosshairs",onLocationError:function(u){console.error(u.message),_({text:u.message,snackbarProps:{color:"red"}})}}).addTo(d.value)):console.error("Map initialization failed.")},v={服務對象:s.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/2377/2377871.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),長期照顧:s.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/12264/12264430.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),身心障礙:s.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/17573/17573294.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),兒童及少年:s.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5759/5759522.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),心理衛生:s.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/4010/4010654.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),婦女:s.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/7457/7457069.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),社會救助:s.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/784/784791.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),綜合:s.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5153/5153858.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),其他:s.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/5672/5672993.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]})},V=async()=>{var u,t;try{const{data:c}=await z.get("/landmark");b.value=c.result.data,E()}catch(c){console.error("Error fetching data:",c),_({text:((t=(u=c==null?void 0:c.response)==null?void 0:u.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}},E=()=>{if(!d.value)return;m.value.forEach(t=>d.value.removeLayer(t)),m.value=[],b.value.filter(t=>{const c=!n.selectedCity||t.address.includes(n.selectedCity),p=!n.selectedArea||t.address.includes(n.selectedArea),x=!n.searchQuery||t.name.toLowerCase().includes(n.searchQuery.toLowerCase())||t.address.toLowerCase().includes(n.searchQuery.toLowerCase()),h=n.selectedSubcategories.length===0||t.categories.some(w=>n.selectedSubcategories.includes(w));return c&&p&&h&&x}).forEach(t=>{const c=parseFloat(t.lat),p=parseFloat(t.lng),x=t.cl,h=v[x]||v.綜合;if(isFinite(c)&&isFinite(p)){const w=s.marker([c,p],{icon:h}).addTo(d.value).bindPopup(`<h2 style="margin:5px 0 5px 0;text-decoration: underline;color:#1b3f63;">${t.name}</h2>
        <h3 style="margin: 2px 0 2px 0;color:gray;">地址：${t.address}</h3>
        <h3 style="margin: 2px 0 2px 0;color:gray;">電話：${t.tel}</h3>
        <span style="font-size: 1.17em;font-weight: bold;color:gray;">類別：</span><span style="font-size: 1.17em;font-weight: bold;margin: 2px 0 2px 0;color:#7b97a6;">${t.categories.join(" | ")}</span>
        <div><span style="font-size: 1.17em;font-weight: bold;color:gray;">簡介：</span><h4 style="margin: 2px 0 2px 0;color:gray;white-space: pre-line;">${t.description}</h4></div>`);m.value.push(w)}else console.warn(`Invalid coordinates for item: ${JSON.stringify(t)}`)})};return X(()=>[n.searchQuery,n.selectedCity,n.selectedArea,n.selectedSubcategories],E),Y(async()=>{M(),await V()}),(u,t)=>(r(),g(ae,{class:"pb-0"},{default:a(()=>[U("div",ue,null,512)]),_:1}))}},K=ee(pe,[["__scopeId","data-v-8f845648"]]),me={class:"text-right"},fe={id:"filter"},ge={__name:"index",setup(N){const{mobile:_}=ne(),d=i([{name:"服務對象",subcategories:["長期照顧","身心障礙","婦女","兒童及少年","心理衛生","社會救助","綜合","其他"]},{name:"長期照顧",subcategories:["日照中心","護理之家","居家服務","交通接送","家庭托顧"]},{name:"身心障礙",subcategories:["身心障礙者服務中心","輔具中心","職業重建中心","小作所","庇護工場"]},{name:"兒童及少年",subcategories:["少年福利服務中心","親子館","課後班"]},{name:"婦女",subcategories:["婦女福利服務中心","新住民家庭服務中心"]},{name:"社會救助",subcategories:["經濟補助","待用餐","基金會","社會福利中心"]},{name:"其他",subcategories:["其他"]}]),m=i([]),b=i([]),z=i([]),n=i([]),M=i({}),v=i(null),V=i(null),E=["台北市","新北市"],u=async()=>{try{const f=await se.get("https://gist.githubusercontent.com/Wcc723/ac712d2bb5c4e61df99d7c5b7f3746e1/raw/2ebe2f94c3bbbeec254159b7dfe71a007f1696cd/tw-zipcode.json");t(f.data)}catch(f){console.error("Error loading JSON file:",f)}},t=f=>{const o={},A=[];Object.keys(f).forEach(l=>{E.includes(l)&&(A.push(l),o[l]=Object.keys(f[l]))}),z.value=A,M.value=o},c=f=>{n.value=M.value[f]||[],V.value=null};X(v,f=>{c(f)}),Y(()=>{u()});const p=i(""),x=()=>{m.value=[],b.value=[],V.value=[],v.value=[],p.value=""},h=i(!1),w=()=>{h.value=!h.value};return(f,o)=>{const A=oe;return r(),g(I,{style:{height:"94vh"}},{default:a(()=>[B(_)?D("",!0):(r(),g(S,{key:0,cols:"12",md:"7",lg:"8",class:"map_col order-2 order-lg-1 order-md-1"},{default:a(()=>[e(K,{searchQuery:p.value,selectedCity:v.value,selectedArea:V.value,selectedSubcategories:m.value},null,8,["searchQuery","selectedCity","selectedArea","selectedSubcategories"])]),_:1})),B(_)?(r(),g(ae,{key:2,class:"pa-0 d-flex flex-column",style:{height:"100%"}},{default:a(()=>[e(ie,null,{default:a(()=>[e(I,{"no-gutters":""},{default:a(()=>[e(S,{cols:"10"},{default:a(()=>[e(A,{modelValue:p.value,"onUpdate:modelValue":o[6]||(o[6]=l=>p.value=l),label:"輸入資源地址",id:"search-xs",class:"ms-2",dense:"",width:"95%"},null,8,["modelValue"])]),_:1}),e(S,{cols:"1",class:"text-center my-auto"},{default:a(()=>[e(C,{id:"clear",type:"submit",variant:"plain",class:"rounded-md bb-1 bg-grey-lighten-4 d-none d-md-block",density:"comfortable",ripple:!1,height:"40",width:"60",onClick:o[7]||(o[7]=l=>x())},{default:a(()=>[k(" 清空條件 ")]),_:1}),e(C,{icon:"mdi-delete",class:"d-md-none",variant:"text",density:"comfortable",color:"black",onClick:o[8]||(o[8]=l=>x())})]),_:1}),e(S,{cols:"1",class:"text-center my-auto"},{default:a(()=>[e(C,{id:"clear",type:"submit",variant:"plain",class:"rounded-md bb-1 bg-grey-lighten-4 d-none d-md-block",density:"comfortable",ripple:!1,height:"40",width:"60",onClick:w},{default:a(()=>[k(" 篩選 ")]),_:1}),e(C,{icon:"mdi-filter",class:"d-md-none",variant:"text",density:"comfortable",color:"black",onClick:w})]),_:1})]),_:1})]),_:1}),h.value?(r(),g(de,{key:0,modelValue:h.value,"onUpdate:modelValue":o[11]||(o[11]=l=>h.value=l),temporary:"",width:"100vw",class:"bg-transparent",location:"top"},{default:a(()=>[e(R,{variant:"accordion"},{default:a(()=>[(r(!0),L($,null,Q(d.value,(l,P)=>(r(),g(Z,{key:P,modelValue:b.value,"onUpdate:modelValue":o[10]||(o[10]=y=>b.value=y)},{default:a(()=>[e(H,null,{default:a(()=>[k(O(l.name),1)]),_:2},1024),e(W,null,{default:a(()=>[(r(!0),L($,null,Q(l.subcategories,(y,T)=>(r(),g(G,{key:T,modelValue:m.value,"onUpdate:modelValue":o[9]||(o[9]=F=>m.value=F),label:y,value:y,"hide-details":""},null,8,["modelValue","label","value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue"]))),128))]),_:1})]),_:1},8,["modelValue"])):D("",!0),e(K,{searchQuery:p.value,selectedCity:v.value,selectedArea:V.value,selectedSubcategories:m.value,id:"map-xs",style:{"flex-grow":"1"}},null,8,["searchQuery","selectedCity","selectedArea","selectedSubcategories"])]),_:1})):(r(),g(S,{key:1,cols:"12",md:"5",lg:"4",class:"map_col order-1 order-lg-2 order-md-2"},{default:a(()=>[e(ce,{class:"find-resource",elevation:"0"},{default:a(()=>[e(j,{color:"secondary",prominent:"",class:"bb-1 d-none d-md-inline-block"},{default:a(()=>[e(q,null,{default:a(()=>[k(" 服務查詢 ")]),_:1})]),_:1}),e(re,null,{default:a(()=>[U("div",null,[U("div",me,[e(C,{id:"clear",type:"submit",variant:"plain",class:"rounded-md bb-1 mt-2 bg-grey-lighten-4 d-none d-md-block",density:"comfortable",ripple:!1,height:"40",width:"80",onClick:o[0]||(o[0]=l=>x())},{default:a(()=>[k(" 清空條件 ")]),_:1})]),e(A,{class:"my-5","max-width":"1000px",modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=l=>p.value=l),label:"輸入資源地址",id:"search"},null,8,["modelValue"])]),U("div",null,[e(J,{modelValue:v.value,"onUpdate:modelValue":o[2]||(o[2]=l=>v.value=l),items:z.value,"min-width":"145px",label:"縣市",class:"me-3 d-none d-sm-inline-block",style:{width:"48%"},density:"comfortable",variant:"outlined"},null,8,["modelValue","items"]),e(J,{modelValue:V.value,"onUpdate:modelValue":o[3]||(o[3]=l=>V.value=l),items:n.value,"min-width":"145px",label:"鄉鎮市區",class:"d-none d-sm-inline-block",style:{width:"48%"},density:"comfortable",variant:"outlined"},null,8,["modelValue","items"])]),U("div",fe,[e(j,{density:"compact",class:"d-none d-md-block"},{default:a(()=>[e(q,{class:"ms-5 text-body-1"},{default:a(()=>[k(" 服務類別 ")]),_:1})]),_:1}),e(R,{variant:"accordion"},{default:a(()=>[(r(!0),L($,null,Q(d.value,(l,P)=>(r(),g(Z,{key:P,modelValue:b.value,"onUpdate:modelValue":o[5]||(o[5]=y=>b.value=y)},{default:a(()=>[e(H,null,{default:a(()=>[k(O(l.name),1)]),_:2},1024),e(W,null,{default:a(()=>[(r(!0),L($,null,Q(l.subcategories,(y,T)=>(r(),g(G,{key:T,modelValue:m.value,"onUpdate:modelValue":o[4]||(o[4]=F=>m.value=F),label:y,value:y,"hide-details":""},null,8,["modelValue","label","value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue"]))),128))]),_:1})])]),_:1})]),_:1})]),_:1}))]),_:1})}}},Ee=ee(ge,[["__scopeId","data-v-2dc27407"]]);export{Ee as default};
